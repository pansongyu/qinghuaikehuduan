{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\hotupdate/assets\\script\\hotupdate\\HotUpdateMgr.js"],"names":["app","require","HotUpdateMgr","BaseClass","extend","Init","console","log","_updating","_storagePath","_canRetry","restarting","LocalVersion","UIRLFILE_root","Client","GetClientConfigProperty","cc","sys","isNative","jsb","fileUtils","getWritablePath","UIRLFILE","firstDown","isHallDownLoad","customManifestStr","JSON","stringify","versionCompareHandle","versionA","versionB","vA","split","vB","i","length","a","parseInt","b","_am","AssetsManager","setVerifyCallback","path","asset","compressed","expectedMD5","md5","relativePath","size","getState","State","UNINITED","manifest","Manifest","loadLocalManifest","os","OS_ANDROID","setMaxConcurrentTask","file","isFileExist","jsonString","getStringFromFile","indexOf","SaveManifest","path_Manifest","downFile2Local","url","fileName","self","downloader","Downloader","setOnFileTaskSuccess","RestartApp","setOnTaskError","createDownloadFileTask","getLocalVersion","getLocalManifest","getVersion","HotUpdate","setEventCallback","UpdateCb","bind","_failCount","update","event","needRestart","failed","getMessage","getEventCode","EventAssetsManager","ERROR_NO_LOCAL_MANIFEST","UPDATE_PROGRESSION","getDownloadedBytes","getTotalBytes","getPercent","getDownloadedFiles","getTotalFiles","msg","ERROR_DOWNLOAD_MANIFEST","ERROR_PARSE_MANIFEST","LoadLogin","ALREADY_UP_TO_DATE","UPDATE_FINISHED","SysNotifyManager","ShowSysMsg","ASSET_UPDATED","UPDATE_FAILED","downloadFailedAssets","ERROR_UPDATING","getAssetId","ERROR_DECOMPRESS","NEW_VERSION_FOUND","searchPaths","getSearchPaths","newPaths","Array","prototype","unshift","apply","localStorage","setItem","setSearchPaths","audioEngine","stopAll","game","restart","CheckUpdate","manifestUrl","nativeUrl","loader","md5Pipe","transformURL","isLoaded","CheckCb","checkUpdate","ForceUpdateMgr","Update","_checkListener","Destroy","g_HotUpdateMgr","exports","GetModel"],"mappings":"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","file":"HotUpdateMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\hotupdate","sourcesContent":["\n// Custom manifest removed the following assets:\n// 1. res/raw-assets/textures/UI/chat/button_orange.png\n// 2. res/raw-assets/textures/UI/chat/gb_inputbox.png\n// So when custom manifest used, you should be able to find them in downloaded remote assets\n /*\njsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST = 0;\njsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST = 1;\njsb.EventAssetsManager.ERROR_PARSE_MANIFEST = 2;\njsb.EventAssetsManager.NEW_VERSION_FOUND = 3;\njsb.EventAssetsManager.ALREADY_UP_TO_DATE = 4;\njsb.EventAssetsManager.UPDATE_PROGRESSION = 5;\njsb.EventAssetsManager.ASSET_UPDATED = 6;\njsb.EventAssetsManager.ERROR_UPDATING = 7;\njsb.EventAssetsManager.UPDATE_FINISHED = 8;\njsb.EventAssetsManager.UPDATE_FAILED = 9;\njsb.EventAssetsManager.ERROR_DECOMPRESS = 10;\n*/\nvar app = require('app');\nvar HotUpdateMgr = app.BaseClass.extend({\n    // use this for initialization\n    Init: function () {\n        console.log('HotUpdateMgr Init');\n        this._updating = false;\n        this._storagePath= '';\n        this._canRetry = false;\n        this.restarting=false;\n        this.LocalVersion = '';\n        this.UIRLFILE_root = app.Client.GetClientConfigProperty(\"UpdateUrl\");//演示\n\n        // Hot update is only available in Native build\n        if (!cc.sys.isNative){\n            console.log(\"cc.sys.inNavite exit,\",cc.sys.isNative);\n            return;\n        }\n    \n        this._storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'hall');\n\n        console.log('Storage path for remote asset : ' + this._storagePath);\n        /// 替换该地址\n        var UIRLFILE =null;\n        this.firstDown=false;\n        if(this.isHallDownLoad()==true){\n            UIRLFILE = this.UIRLFILE_root + \"hall_item/remote-assets/\";\n        }else{\n            //this.firstDown=true;\n            UIRLFILE = this.UIRLFILE_root + \"hall/remote-assets/\";\n        }\n        console.log('HotUpdateMgr this.firstDown:' + this.firstDown);\n        var customManifestStr = JSON.stringify({\n            'packageUrl': UIRLFILE,\n            'remoteManifestUrl': UIRLFILE + '/project.manifest',\n            'remoteVersionUrl': UIRLFILE + '/version.manifest',\n            'version': '0.0.1',\n            'assets': {},\n            'searchPaths': []\n        });\n        var versionCompareHandle = function (versionA, versionB) {\n            cc.log(\"JS Custom Version Compare: version A is \" + versionA + ', version B is ' + versionB);\n            var vA = versionA.split('.');\n            var vB = versionB.split('.');\n            for (var i = 0; i < vA.length; ++i) {\n                var a = parseInt(vA[i]);\n                var b = parseInt(vB[i] || 0);\n                if (a === b) {\n                    continue;\n                }\n                else {\n                    return a - b;\n                }\n            }\n            if (vB.length > vA.length) {\n                return -1;\n            }\n            else {\n                return 0;\n            }\n        };\n\n        // Init with empty manifest url for testing custom manifest\n        \n        this._am = new jsb.AssetsManager('', this._storagePath, versionCompareHandle);\n\n        // Setup the verification callback, but we don't have md5 check function yet, so only print some message\n        // Return true if the verification passed, otherwise return false\n        this._am.setVerifyCallback(function (path, asset) {\n            // When asset is compressed, we don't need to check its md5, because zip file have been deleted.\n            var compressed = asset.compressed;\n            // Retrieve the correct md5 value.\n            var expectedMD5 = asset.md5;\n            // asset.path is relative path and path is absolute.\n            var relativePath = asset.path;\n            // The size of asset file, but this value could be absent.\n            var size = asset.size;\n            if (compressed) {\n                return true;\n            }\n            else {\n                console.log(\"Verification passed : \" + relativePath + ' (' + expectedMD5 + ')');\n                return true;\n            }\n        });\n\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            var manifest = new jsb.Manifest(customManifestStr, this._storagePath);\n            this._am.loadLocalManifest(manifest, this._storagePath);\n        }\n\n        if (cc.sys.os === cc.sys.OS_ANDROID) {\n            this._am.setMaxConcurrentTask(2);\n        }\n    },\n    /**\n     * 判断子游戏是否已经下载\n     * @param {string} name - 游戏名\n     */\n    isHallDownLoad: function () {\n\n        return false;\n\n        let file = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'hall/project.manifest';\n        if (jsb.fileUtils.isFileExist(file)) {\n            let jsonString = jsb.fileUtils.getStringFromFile(file);\n            if (jsonString.indexOf(\"res.zip\") > -1) {\n                console.log(\"HotUpdateMgr isHallDownLoad Have res.zip,is not change project.manifest\");\n                return false;\n            }\n            console.log(\"HotUpdateMgr isHallDownLoad project.manifest exist\");\n            return true;\n        } else {\n            console.log(\"HotUpdateMgr isHallDownLoad project.manifest not exist\");\n            return false;\n        }\n    },\n    SaveManifest:function(){\n        console.log(\"SaveManifest begin\");\n        let path_Manifest=this.UIRLFILE_root+\"hall/remote-assets/project_item.manifest\";\n        let file = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'hall/project.manifest';\n        this.downFile2Local(path_Manifest,file);\n    },\n    downFile2Local:function(url, fileName){\n        let self=this;\n        var downloader = new jsb.Downloader();\n        downloader.setOnFileTaskSuccess(function(){\n            console.log(\"downFile2Local: project_item.manifest  is down success\");    \n            self.RestartApp();\n        });\n        downloader.setOnTaskError(function(){     \n            console.log(\"downFile2Local: project_item.manifest  is down error\");    \n            self.RestartApp();\n        });\n        downloader.createDownloadFileTask(url, fileName);//创建下载任务\n    },\n    \n    //获取本地版本\n    getLocalVersion:function(){\n        console.log(\"getLocalVersion version:\"+this.LocalVersion);\n        if (this.LocalVersion == '' && this._am && !this._updating) {\n            this.LocalVersion = this._am.getLocalManifest().getVersion();\n        }\n        return this.LocalVersion;\n    },\n\n    HotUpdate: function () {\n        if (this._am && !this._updating) {\n            this._am.setEventCallback(this.UpdateCb.bind(this));\n            this.LocalVersion = this._am.getLocalManifest().getVersion();\n            console.log(\"LocalVersion === \" + this.LocalVersion);\n            this._failCount = 0;\n            this._am.update();\n            this._updating = true;\n        }\n    },\n    \n   \n\n    UpdateCb: function (event) {\n        var needRestart = false;\n        var failed = false;\n        console.log(\"ResUpdate UpdateCb event:\", event.getMessage());\n        switch (event.getEventCode())\n        {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                console.log('No local manifest file found, hot update skipped.');\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                app[\"startCompress\"] = false;\n                //app[\"updatepercent\"]=parseInt(event.getPercentByFile() * 100);\n                app[\"updatepercent\"]=parseInt(event.getDownloadedBytes()/event.getTotalBytes()*100);\n                console.log(\"UpdateCb getPercent:\" + parseInt(event.getPercent()));\n                console.log(\"UpdateCb getDownloadedFiles:\" + event.getDownloadedFiles() + ' / ' + event.getTotalFiles());\n                console.log(\"UpdateCb getDownloadedBytes:\" + event.getDownloadedBytes() + ' / ' + event.getTotalBytes());\n                if (event.getDownloadedBytes() == event.getTotalBytes()) {\n                    console.log(\"资源下载完成\");\n                    //if(this.firstDown==true){\n                        app[\"startCompress\"] = true;\n                    //}\n                }\n                var msg = event.getMessage();\n                if (msg) {\n                    console.log('Updated file: ' + msg);\n                    console.log(event.getPercent()/100 + '% : ' + msg);\n                }\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                console.log('Fail to download manifest file, hot update skipped.');\n                app.Client.LoadLogin();\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                console.log('Already up to date with the latest remote version.');\n                app.Client.LoadLogin();\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                console.log('Update finished. ' + event.getMessage());\n                app.SysNotifyManager().ShowSysMsg(\"更新完成...\",[],3);\n                needRestart = true;\n                break;\n            case jsb.EventAssetsManager.ASSET_UPDATED:\n                /*needRestart = true;*/\n                console.log(\"资源下载完成\");\n                //if(this.firstDown==true){\n                    app[\"startCompress\"] = true;\n                //}\n                break;\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                this._updating = false;\n                this._canRetry = true;\n               // failed = true;\n                // console.log('downloadFailedAssets');\n                app.SysNotifyManager().ShowSysMsg(\"更新失败，重新更新...\",[],3);\n                this._am.downloadFailedAssets();\n                break;\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                console.log('Asset update error: ' + event.getAssetId() + ', ' + event.getMessage());\n                //needRestart = true;\n                break;\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                console.log(event.getMessage());\n\n                //needRestart = true;\n                break;\n            case  jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                //版本判断\n                // console.log(\"CheckCb getRemoteManifest:%s\", this._am.getRemoteManifest().getVersion());\n                // console.log(\"CheckCb hotUpdateVersion:%s\", app.Client.GetClientConfigProperty(\"hotUpdateVersion\"));\n                // if(this._am.getRemoteManifest().getVersion() <= app.Client.GetClientConfigProperty(\"hotUpdateVersion\")){\n                //     console.log(\"版本号已经足够高了\");\n                //     app.Client.LoadLogin();\n                //     this.Destroy();\n                //     return;\n                // }\n                break;\n            default:\n                break;\n        }\n\n        if (failed) {\n            this._am.setEventCallback(null);\n            this._updating = false;\n        }\n       // console.log('HotUpdateMgr needRestart', needRestart);\n\n        if (needRestart) {\n            this.RestartApp();\n            //刷新热更文件\n            /*if(this.firstDown==true){\n                console.log('HotUpdateMgr is firstDown');\n                this.SaveManifest();\n            }else{\n                //刷新热更文件\n                console.log('HotUpdateMgr needRestart begin');\n               this.RestartApp();\n            }*/\n        }else{\n            console.log('HotUpdateMgr not needRestart');\n        }\n    },\n    RestartApp:function(){\n        if(this.restarting==true){\n            //已经在重启，无需重启\n            return;\n        }\n        this.restarting=true;\n        this._am.setEventCallback(null);\n        var searchPaths = jsb.fileUtils.getSearchPaths();\n        var newPaths = this._am.getLocalManifest().getSearchPaths();\n         console.log(JSON.stringify(newPaths));\n        Array.prototype.unshift.apply(searchPaths, newPaths);\n                // This value will be retrieved and appended to the default search path during game startup,\n                // please refer to samples/js-tests/main.js for detailed usage.\n                // !!! Re-add the search paths in main.js is very important, otherwise, new scripts won't take effect.\n        cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\n        jsb.fileUtils.setSearchPaths(searchPaths);\n\n        cc.audioEngine.stopAll();\n        cc.game.restart();\n    },\n    CheckUpdate: function () {\n        if (this._updating) {\n            console.log(\"正在更新，无法检测...\");\n            app.SysNotifyManager().ShowSysMsg(\"正在更新，无法检测...\",[],3);\n            return;\n        }\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            // Resolve md5 url\n            app.SysNotifyManager().ShowSysMsg(\"热更状态错误...\",[],3);\n            var url = this.manifestUrl.nativeUrl;\n            if (cc.loader.md5Pipe) {\n                url = cc.loader.md5Pipe.transformURL(url);\n            }\n            this._am.loadLocalManifest(url);\n        }\n        if (!this._am.getLocalManifest() || !this._am.getLocalManifest().isLoaded()) {\n            console.log(\"加载本地Manifest失败...\");\n            app.SysNotifyManager().ShowSysMsg(\"加载本地Manifest失败...\",[],3);\n            return;\n        }\n        // this._checkListener = new jsb.EventListenerAssetsManager(this._am, this.CheckCb.bind(this));\n        // cc.eventManager.addListener(this._checkListener, 1);\n        this._am.setEventCallback(this.CheckCb.bind(this));\n        this._am.checkUpdate();\n        this._updating = true;\n    },\n\n    CheckCb: function (event) {\n        console.log('CheckCb begin');\n        cc.log('Code: ' + event.getEventCode());\n        // app.SysNotifyManager().ShowSysMsg(\"检测新版本状态 \"+event.getEventCode(),[],3);\n        switch (event.getEventCode())\n        {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                console.log(\"No local manifest file found, hot update skipped.\");\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                //this.panel.info.string = \"Fail to download manifest file, hot update skipped.\";\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                //this.panel.info`.string = \"Already up to date with the latest remote version.\";\n                break;\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                console.log('CheckCb NEW_VERSION_FOUND');\n                app.ForceUpdateMgr().Update();\n                break;\n            default:\n                return;\n        }\n        console.log('CheckCb end');\n        \n        this._am.setEventCallback(null);\n        this._checkListener = null;\n        this._updating = false;\n    },\n\n\n    Destroy: function () {\n         this._am.setEventCallback(null);\n    }\n});\n\nvar g_HotUpdateMgr = null;\n\nexports.GetModel = function(){\n    if(!g_HotUpdateMgr)\n        g_HotUpdateMgr = new HotUpdateMgr();\n    return g_HotUpdateMgr;\n\n}"]}