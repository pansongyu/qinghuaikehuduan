{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\PlayerPerDayThing/assets\\script\\dbmanager\\PlayerPerDayThing\\PlayerPerDayThingManager.js"],"names":["app","require","PlayerPerDayThingManager","BaseClass","extend","Init","JS_Name","NetManager","ServerTimeManager","PlayerPerDayThingIndexToProperty","AllowOffTick","TimeIntervalTick","Hero_DayEventID","OnReload","Log","dataInfo","lastTick","InitLoginData","dataList","count","length","index","eventID","SetPlayerPerDayThingProperty","property","value","ErrLog","hasOwnProperty","argDict","OnEventDay","OnPack_PerDayThingProperty","pack","Index","Value","KeyID","Client","OnEvent","GetPlayerPerDayThingInfo","GetPlayerPerDayThingProperty","g_PlayerPerDayThingManager","exports","GetModel"],"mappings":"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","file":"PlayerPerDayThingManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\PlayerPerDayThing","sourcesContent":["/*\n    玩家每日刷新管理器\n*/\nvar app = require('app');\n\nvar PlayerPerDayThingManager = app.BaseClass.extend({\n\n    Init:function(){\n        this.JS_Name = \"PlayerPerDayThingManager\";\n\n        this.NetManager = app.NetManager();\n        this.ServerTimeManager = app.ServerTimeManager();\n\n        this.PlayerPerDayThingIndexToProperty = {};\n\n        this.AllowOffTick = 1000;\n        this.TimeIntervalTick = 20*1000;\n        this.Hero_DayEventID = 1;\n\n        this.OnReload();\n\n\n        this.Log(\"Init\");\n    },\n\n    //切换账号\n    OnReload:function(){\n        this.dataInfo = {};\n        this.lastTick = 0;\n    },\n\n\n\n    //登陆初始化数据\n    InitLoginData:function(dataList){\n\n        if(!dataList){\n            return\n        }\n        \n        let count = dataList.length;\n        for(let index=0; index<count; index++){\n            let dataInfo = dataList[index];\n            let eventID = dataInfo[\"EventID\"];\n            this.dataInfo[eventID] = dataInfo;\n        }\n    },\n\n\n    /**\n     *  获取属性值\n     */\n    SetPlayerPerDayThingProperty:function(eventID, property, value){\n        let dataInfo = this.dataInfo[eventID];\n        if(!dataInfo){\n            this.ErrLog(\"SetPlayerPerDayThingProperty(%s,%s,%s) not find eventID\", eventID, property, value);\n            return \n        }\n        if(!dataInfo.hasOwnProperty(property)){\n            this.ErrLog(\"SetPlayerPerDayThingProperty(%s,%s,%s) property not find\", eventID, property, value);\n            return\n        }\n        dataInfo[property] = value;\n\n        let argDict = {\n\t\t\t            \"EventID\":eventID,\n\t\t\t            \"Property\":property,\n\t\t\t            \"Value\":value,\n\t\t\t        };\n\n        if(eventID == this.Hero_DayEventID){\n            this.OnEventDay();\n        }\n        //app.Client.OnEvent(\"PlayerPerDayThingProperty\", argDict);\n    },\n\n    //-----------------------回调接口------------------------\n     /**\n     * 属性字段变化\n     * @param {}\n     * @return {}\n     * @remarks {}\n     */\n    OnPack_PerDayThingProperty:function(pack){\n        let index = pack.Index;\n        let value = pack.Value;\n        let eventID = pack.KeyID;\n        if(!this.PlayerPerDayThingIndexToProperty.hasOwnProperty(index)){\n            this.ErrLog(\"OnPerDayThingProperty has not index{1}\",index)\n            return\n        }\n\n        let property = this.PlayerPerDayThingIndexToProperty[index];\n        this.SetPlayerPerDayThingProperty(eventID, property, value);\n    },\n\n\n \n\n    //天变化事件\n    OnEventDay:function(){\n        app.Client.OnEvent(\"EventDay\", {});\n    },\n\n    //---------------------获取接口---------------------------------\n\n    //获取天事件完整数据\n    GetPlayerPerDayThingInfo:function(eventID){\n        let dataInfo = this.dataInfo[eventID];\n        if(!dataInfo){\n            this.ErrLog(\"GetPlayerPerDayThingInfo not find:%s\", eventID);\n            return\n        }\n        return dataInfo\n    },\n\n    /**\n     *  获取属性值\n     */\n    GetPlayerPerDayThingProperty:function(eventID, property){\n\n        let dataInfo = this.dataInfo[eventID];\n        if(!dataInfo){\n            this.ErrLog(\"GetPlayerPerDayThingProperty(%s,%s) not find key\", eventID, property);\n            return \n        }\n        if(!dataInfo.hasOwnProperty(property)){\n            this.ErrLog(\"GetPlayerPerDayThingProperty(%s,%s) property not find\", eventID, property);\n            return\n        }\n        return dataInfo[property];\n    },\n\n});\n\n\nvar g_PlayerPerDayThingManager = null;\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n    if(!g_PlayerPerDayThingManager){\n        g_PlayerPerDayThingManager = new PlayerPerDayThingManager();\n    }\n    return g_PlayerPerDayThingManager;\n}"]}