{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\ui\\uiEffect/assets\\script\\ui\\uiEffect\\WeChatHeadImage.js"],"names":["app","require","cc","Class","extends","properties","OnLoad","heroID","getHeadTime","isGetHead","JS_Name","node","name","Client","RegEvent","Event_RefreshHeadImageSprite","event","heroIDList","InArray","spriteFrame","WeChatManager","GetHeroHeadSpriteFrame","getComponent","Sprite","OnReloadHeroHead","heroSex","ShowHeroHead","headImageUrl","that","indexOf","ControlManager","CreateLoadPromiseByUrl","then","texture","Texture2D","isValid","SpriteFrame","ErrLog","catch","error","stack","setTimeout"],"mappings":";;;;;;AAAA,IAAIA,MAAMC,QAAQ,KAAR,CAAV;;AAEAC,GAAGC,KAAH,CAAS;AACRC,UAASH,QAAQ,eAAR,CADD;;AAGRI,aAAY,EAHJ;;AAMR;AACAC,SAAQ,kBAAoB;AAAA,MAAVC,MAAU,uEAAH,CAAG;;AAC3B,OAAKA,MAAL,GAAcA,MAAd;AACA,OAAKC,WAAL,GAAiB,CAAjB;AACA,OAAKC,SAAL,GAAe,KAAf;AACA,OAAKC,OAAL,GAAe,KAAKC,IAAL,CAAUC,IAAV,GAAiB,kBAAhC;AACAZ,MAAIa,MAAJ,CAAWC,QAAX,CAAoB,wBAApB,EAA8C,KAAKC,4BAAnD,EAAiF,IAAjF;AACA,EAbO;;AAeR;;;;;;;;;AAUAA,+BAA6B,sCAASC,KAAT,EAAe;AAC3C,MAAIC,aAAaD,MAAM,YAAN,KAAqB,EAAtC;AACA,MAAGC,WAAWC,OAAX,CAAmB,KAAKX,MAAxB,CAAH,EAAmC;AAClC,OAAIY,cAAcnB,IAAIoB,aAAJ,GAAoBC,sBAApB,CAA2C,KAAKd,MAAhD,CAAlB;AACA,QAAKE,SAAL,GAAe,IAAf;AACA,QAAKE,IAAL,CAAUW,YAAV,CAAuBpB,GAAGqB,MAA1B,EAAkCJ,WAAlC,GAAgDA,WAAhD;AACA;AACD,EAhCO;AAiCRK,mBAAiB,0BAASjB,MAAT,EAA2B;AAAA,MAAVkB,OAAU,uEAAF,CAAE;AAE3C,EAnCO;AAoCR;AACAC,eAAa,sBAASnB,MAAT,EAAgBoB,YAAhB,EAAuC;AAAA,MAAVF,OAAU,uEAAF,CAAE;;AACnD,MAAG,KAAKhB,SAAL,IAAgB,IAAnB,EAAwB;AACvB;AACA;AACD,MAAImB,OAAO,IAAX;AACA,MAAG,KAAKpB,WAAL,GAAiB,CAApB,EAAsB;AACrB,OAAGmB,YAAH,EAAgB;AACf,QAAGA,aAAaE,OAAb,CAAqB,kBAArB,IAAyC,CAA5C,EAA8C;AAC7CF,oBAAaA,eAAa,QAA1B;AACA;AACD3B,QAAI8B,cAAJ,GAAqBC,sBAArB,CAA4CJ,YAA5C,EACkBK,IADlB,CACuB,UAASC,OAAT,EAAiB;AACnB,SAAGA,mBAAmB/B,GAAGgC,SAAzB,EAAmC;AAClC,UAAG,CAAChC,GAAGiC,OAAH,CAAWP,KAAKjB,IAAhB,CAAJ,EAA0B;AAC3C;AACA;AACDiB,WAAKnB,SAAL,GAAe,IAAf;AACqB,UAAIU,eAAc,IAAIjB,GAAGkC,WAAP,CAAmBH,OAAnB,CAAlB;AACAL,WAAKjB,IAAL,CAAUW,YAAV,CAAuBpB,GAAGqB,MAA1B,EAAkCJ,WAAlC,GAAgDA,YAAhD;AACH,MAPD,MAQI;AACAS,WAAKS,MAAL,CAAY,uBAAZ;AACH;AACJ,KAblB,EAccC,KAdd,CAcoB,UAASC,KAAT,EAAe;AAClBX,UAAKS,MAAL,CAAY,uCAAZ,EAAqDE,MAAMC,KAA3D;AACP,KAhBV;AAiBA;AACD;AACA;AACD,OAAKjC,MAAL,GAAcA,MAAd;AACA,MAAIY,cAAcnB,IAAIoB,aAAJ,GAAoBC,sBAApB,CAA2Cd,MAA3C,CAAlB;AACA,MAAGY,WAAH,EAAe;AACd,QAAKV,SAAL,GAAe,IAAf;AACA,QAAKE,IAAL,CAAUW,YAAV,CAAuBpB,GAAGqB,MAA1B,EAAkCJ,WAAlC,GAAgDA,WAAhD;AACA,GAHD,MAGK;AACJsB,cAAW,YAAU;AACTb,SAAKpB,WAAL;AACAoB,SAAKF,YAAL,CAAkBnB,MAAlB,EAAyBoB,YAAzB;AACF,IAHV,EAGW,GAHX;AAIA;AACD;AA9EO,CAAT","file":"WeChatHeadImage.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\ui\\uiEffect","sourcesContent":["var app = require(\"app\");\n\ncc.Class({\n\textends: require(\"BaseComponent\"),\n\n\tproperties: {\n\t},\n\n\t// use this for initialization\n\tOnLoad: function (heroID=0) {\n\t\tthis.heroID = heroID;\n\t\tthis.getHeadTime=0;\n\t\tthis.isGetHead=false;\n\t\tthis.JS_Name = this.node.name + \"_WeChatHeadImage\";\n\t\tapp.Client.RegEvent(\"RefreshHeadImageSprite\", this.Event_RefreshHeadImageSprite, this);\n\t},\n\n\t/*//显示\n\tonEnable:function(){\n\t\tapp.Client.RegEvent(\"RefreshHeadImageSprite\", this.Event_RefreshHeadImageSprite, this);\n\t},\n\n\t//关闭时\n\tonDisable:function(){\n\t\tapp.Client.UnRegTargetEvent(this);\n\t},\n*/\n\tEvent_RefreshHeadImageSprite:function(event){\n\t\tlet heroIDList = event[\"HeroIDList\"]||[];\n\t\tif(heroIDList.InArray(this.heroID)){\n\t\t\tlet spriteFrame = app.WeChatManager().GetHeroHeadSpriteFrame(this.heroID);\n\t\t\tthis.isGetHead=true;\n\t\t\tthis.node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t\t}\n\t},\n\tOnReloadHeroHead:function(heroID, heroSex=0){\n\n\t},\n\t//显示微信头像\n\tShowHeroHead:function(heroID,headImageUrl,heroSex=0){\n\t\tif(this.isGetHead==true){\n\t\t\treturn;\n\t\t}\n\t\tlet that = this;\n\t\tif(this.getHeadTime>3){\n\t\t\tif(headImageUrl){\n\t\t\t\tif(headImageUrl.indexOf('thirdwx.qlogo.cn')>0){\n\t\t\t\t\theadImageUrl=headImageUrl+\"?a.png\";\n\t\t\t\t}\n\t\t\t\tapp.ControlManager().CreateLoadPromiseByUrl(headImageUrl)\n\t                    .then(function(texture){\n\t                        if(texture instanceof cc.Texture2D){\n\t                        \tif(!cc.isValid(that.node)){\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthat.isGetHead=true;\n\t                            let spriteFrame = new cc.SpriteFrame(texture);\n\t                            that.node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t                        }\n\t                        else{\n\t                            that.ErrLog(\"texture not Texture2D\");\n\t                        }\n\t                    })\n\t                .catch(function(error){\n\t                    that.ErrLog(\"OnHttpPack_HeadImagePathInfo error:%s\", error.stack);\n\t            })\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tthis.heroID = heroID;\n\t\tlet spriteFrame = app.WeChatManager().GetHeroHeadSpriteFrame(heroID);\n\t\tif(spriteFrame){\n\t\t\tthis.isGetHead=true;\n\t\t\tthis.node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t\t}else{\n\t\t\tsetTimeout(function(){\n               that.getHeadTime++;\n               that.ShowHeroHead(heroID,headImageUrl);\n            },500);\n\t\t}\n\t},\n});\n"]}