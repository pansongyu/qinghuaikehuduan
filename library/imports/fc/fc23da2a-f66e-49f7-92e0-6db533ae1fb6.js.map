{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\sdk/assets\\script\\sdk\\WeChatManager.js"],"names":["app","require","WeChatManager","BaseClass","extend","Init","JS_Name","ShareDefine","SysDataManager","HeroAccountManager","NetManager","ControlManager","HeroManager","SysNotifyManager","wx","window","sdk","RegHttpNetPack","OnHttpPack_IsSubscribeWeChatMPResult","OnHttpPack_RequestWeChatSDKInitSignResult","OnHttpPack_HeadImagePathInfo","Client","RegEvent","OnEvent_PlayerLoginOK","dataInfo","heroHeadSpriteFrame","Log","OnReload","InitWeChatSDKParameter","code","ErrLog","serverPack","IsSubscribe","OnEvent","console","log","signature","Signature","config","AppId","Timestamp","NonceStr","ready","OnWeChatReady","bind","error","OnWeChatError","InitGameWeChatShare","result","ShowSysMsg","clientConfig","GetClientConfig","SetWeChatShareDataInfo","BeginShare","roomKey","title","desc","weChatShareImageUrl","GetClientConfigProperty","link","shareInfo","imgUrl","type","dataUrl","success","ShareSuccess","cancel","ShareCancel","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","SuccessTcnUrl","requestUrl","jsonStr","replace","ShareUrl","eval","url_short","ShareTitle","ShareDesc","FailTcnUrl","event","argDict","gameLoadUrl","gameID","mpID","GetHeroID","GetUrlStr","dataDict","argList","Object","keys","sort","count","length","urlSendStr","index","key","substring","GetSDK","GetSDKProperty","property","hasOwnProperty","heroID","headImageUrl","GetHeroProperty","InitHeroHeadImage","HeroIDGetHeadImgUrl","headSpriteFrameInfo","SetDefault","HeadImageUrl","cc","sys","isNative","dirpath","jsb","fileUtils","getWritablePath","headPathMd5","MD5","hex_md5","filepath","isFileExist","loader","load","err","tex","spriteFrame","SpriteFrame","Rect","width","height","headInfo","SendHttpLoadHeadImage","InitHeroHeadImageByDict","heroHeadInfo","sendPack","GetHttpSendPack","HeadInfo","GameID","SendHttpPack","resServerUrl","GetResServerHttpAddress","bluebirdList","headPathInfo","SaveHeadImgFile","push","CreateSpriteFrame","that","bluebird","all","then","heroIDList","catch","stack","headPath","url","join","loadEnd","CreateLoadPromiseByUrl","texture","Texture2D","saveFile","data","isDirectoryExist","createDirectory","writeDataToFile","Uint8Array","IsOpenVpn","xhr","XMLHttpRequest","onreadystatechange","readyState","status","response","responseType","open","send","targetPath","GetHeroHeadSpriteFrame","ReceivePrepayOrder","prepayOrderInfo","OnPayResult","chooseWXPay","ReceivePrepayQRCodeOrder","code_url","orderServerIP","orderServerPort","openURL","resultInfo","SysLog","JSON","stringify","Login","token","LoginAccountBySDK","SDKType_WeChat","CheckLoginBySDK","SendRequestWeChatSDKIntSign","location","href","split","MPID","Url","SendIsSubscribeWeChatMP","accountID","GetAccountProperty","AccountID","g_WeChatManager","exports","GetModel"],"mappings":"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","file":"WeChatManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\sdk","sourcesContent":["/*\n WeChatManager.js 微信sdk\n */\nvar app = require('app');\n\nvar WeChatManager = app.BaseClass.extend({\n\n\tInit:function(){\n\t\tthis.JS_Name = \"WeChatManager\";\n\n\t\tthis.ShareDefine = app.ShareDefine();\n\t\tthis.SysDataManager = app.SysDataManager();\n\t\tthis.HeroAccountManager = app.HeroAccountManager();\n\t\tthis.NetManager = app.NetManager();\n\t\tthis.ControlManager = app.ControlManager();\n\t\tthis.HeroManager = app.HeroManager();\n\t\tthis.SysNotifyManager = app.SysNotifyManager();\n\n\t\t//如果存在全局sdk对象\n\t\tthis.wx = window.wx;\n\t\tthis.sdk = null;\n\n\t\tthis.NetManager.RegHttpNetPack(0x0003, this.OnHttpPack_IsSubscribeWeChatMPResult, this);\n\t\tthis.NetManager.RegHttpNetPack(0x0004, this.OnHttpPack_RequestWeChatSDKInitSignResult, this);\n\t\tthis.NetManager.RegHttpNetPack(0x0007, this.OnHttpPack_HeadImagePathInfo, this);\n\n\t\tapp.Client.RegEvent(\"PlayerLoginOK\", this.OnEvent_PlayerLoginOK, this);\n\n\t\tthis.dataInfo = {};\n\n\t\t//玩家第3方头像spriteFrame缓存字典\n\t\t//{heroID:{\"HeadImageUrl\":\"XX\",\"SpriteFrame\":null}}\n\t\tthis.heroHeadSpriteFrame = {};\n\n\t\t//this.OnReload();\n\n\t\tthis.Log(\"Init\");\n\t},\n\n\tOnReload:function(){\n\t\t//这里不能reload，不然会导致登录不了，故直接return\n\t\treturn;\n\t\tthis.dataInfo[\"code\"] = null;\n\t\t\n\t},\n\n\t//授权参数初始化\n\tInitWeChatSDKParameter:function(dataInfo){\n\t\tlet code = dataInfo[\"code\"];\n\t\t//使用公众号登录授权启动没有携带code\n\t\tif(!code){\n\t\t\tthis.ErrLog(\"InitWeChatSDKParameter dataInfo not find code\", dataInfo);\n\t\t\treturn\n\t\t}\n\t\tthis.dataInfo = dataInfo;\n\t},\n\n\t//是否已经关注公众号\n\tOnHttpPack_IsSubscribeWeChatMPResult:function(serverPack){\n\t\tthis.dataInfo[\"IsSubscribe\"] = serverPack.IsSubscribe;\n\t\tapp.Client.OnEvent(\"IsSubscribeWeChatMPResult\", serverPack);\n\t},\n\n\t//申请微信sdk初始化签名\n\tOnHttpPack_RequestWeChatSDKInitSignResult:function(serverPack){\n\t\tconsole.log(\"OnHttpPack_RequestWeChatSDKInitSignResult :\",serverPack);\n\t\tif(!this.wx){\n\t\t\tthis.ErrLog(\"OnHttpPack_RequestWeChatSDKInitSignResult not find wx\");\n\t\t\treturn\n\t\t}\n\t\tlet signature = serverPack.Signature;\n\t\tif(!signature){\n\t\t\tthis.ErrLog(\"OnHttpPack_RequestWeChatSDKInitSignResult not find Signature :\", serverPack);\n\t\t\treturn\n\t\t}\n\n\t\tthis.wx.config({\n\t\t\t\"debug\":false,\n\t\t\t\"appId\":serverPack.AppId,\n\t\t\t\"timestamp\":serverPack.Timestamp,\n\t\t\t\"nonceStr\":serverPack.NonceStr,\n\t\t\t\"signature\":signature,\n\t\t\t\"jsApiList\":[\"onMenuShareTimeline\", \"onMenuShareAppMessage\", \"onMenuShareQQ\", \"onMenuShareWeibo\", \"onMenuShareQZone\", \"getNetworkType\", \"chooseWXPay\"],\n\t\t});\n\t\tthis.wx.ready(this.OnWeChatReady.bind(this));\n\t\tthis.wx.error(this.OnWeChatError.bind(this));\n\t},\n\n\t//初始化成功\n\tOnWeChatReady:function(){\n\t\tconsole.log(\"XiaoFu InitWeiXinShare OnWeChatReady2\");\n\t\tthis.sdk = this.wx;\n\n\t\tthis.InitGameWeChatShare();\n\t},\n\n\tOnWeChatError:function(result){\n\t\tthis.ErrLog(\"OnWeChatError :\", result);\n\t\tapp.SysNotifyManager().ShowSysMsg(\"CodeErrorMsg\", [\"公众号签名初始化失败\"])\n\t},\n\n\t//----------------分享接口------------------------\n\tInitGameWeChatShare:function(){\n\t\tif(!this.sdk){\n\t\t\treturn\n\t\t}\n\t\tlet clientConfig = app.Client.GetClientConfig();\n\t\tthis.SetWeChatShareDataInfo(clientConfig[\"WeChatShareTitle\"], clientConfig[\"WeChatShareDesc\"]);\n\t},\n\tBeginShare:function(roomKey,title,desc){\n        let weChatShareImageUrl = app.Client.GetClientConfigProperty(\"WeChatShareImageUrl\");\n        let link=\"http://fb.qicaiqh.com:88/room\"+roomKey;\n        let shareInfo = {\n\t\t\ttitle:title,\n\t\t\tdesc:desc,\n\t\t\tlink:link,\n\t\t\timgUrl:weChatShareImageUrl,\n\t\t\ttype:\"link\",\n\t\t\tdataUrl:\"\",\n\t\t\tsuccess:this.ShareSuccess.bind(this),\n\t\t\tcancel:this.ShareCancel.bind(this),\n\t\t}\n\t\tthis.sdk.onMenuShareTimeline(shareInfo);\n\t\tthis.sdk.onMenuShareAppMessage(shareInfo);\n\t\tthis.sdk.onMenuShareQQ(shareInfo);\n\t\tthis.sdk.onMenuShareWeibo(shareInfo);\n\t\tthis.sdk.onMenuShareQZone(shareInfo);\n\n\n\n    },\n    //微信分享获取短域名并且启动分享\n    SuccessTcnUrl:function(serverPack){\n        console.log(\"SuccessTcnUrl serverPack:\",serverPack);\n        if(typeof(serverPack.requestUrl)==\"undefined\"){\n            return;\n        }\n        let jsonStr=serverPack.requestUrl;\n        jsonStr=jsonStr.replace('[','');\n        jsonStr=jsonStr.replace(']','');\n        let ShareUrl=eval('(' + jsonStr + ')');\n        let url_short=ShareUrl.url_short;\n        let weChatShareImageUrl = app.Client.GetClientConfigProperty(\"WeChatShareImageUrl\");\n        let shareInfo = {\n\t\t\ttitle:this.ShareTitle,\n\t\t\tdesc:this.ShareDesc,\n\t\t\tlink:url_short,\n\t\t\timgUrl:weChatShareImageUrl,\n\t\t\ttype:\"link\",\n\t\t\tdataUrl:\"\",\n\t\t\tsuccess:this.ShareSuccess.bind(this),\n\t\t\tcancel:this.ShareCancel.bind(this),\n\t\t}\n\t\tthis.sdk.onMenuShareTimeline(shareInfo);\n\t\tthis.sdk.onMenuShareAppMessage(shareInfo);\n\t\tthis.sdk.onMenuShareQQ(shareInfo);\n\t\tthis.sdk.onMenuShareWeibo(shareInfo);\n\t\tthis.sdk.onMenuShareQZone(shareInfo);\n    },\n    //微信分享获取短域名失败分享\n    FailTcnUrl:function(event){\n\n    },\n\n\t//设置微信预分享数据\n\tSetWeChatShareDataInfo:function(title, desc, argDict){\n\t\tif(!this.sdk){\n\t\t\tthis.Log(\"SetWeChatShareDataInfo not init sdk\");\n\t\t\treturn\n\t\t}\n\t\tlet gameLoadUrl = app.Client.GetClientConfigProperty(\"GameLoadUrl\");\n\t\tlet weChatShareImageUrl = app.Client.GetClientConfigProperty(\"WeChatShareImageUrl\");\n\n\t\t//如果没有传递参数字典\n\t\tif(!argDict){\n\t\t\targDict = {};\n\t\t}\n\n\t\tlet gameID = app.Client.GetClientConfigProperty(\"GameID\");\n\t\tif(!gameID){\n\t\t\tthis.ErrLog(\"SetWeChatShareDataInfo not find GameID\");\n\t\t\treturn\n\t\t}\n\t\tlet mpID = app.Client.GetClientConfigProperty(\"MPID\");\n\t\tif(!mpID){\n\t\t\tthis.ErrLog(\"SetWeChatShareDataInfo not find MPID\");\n\t\t\treturn\n\t\t}\n\n\t\t//添加启动标示参数\n\t\targDict[\"ddmchannel\"] = \"wechat\";\n\t\targDict[\"ddmgameid\"] = gameID;\n\t\targDict[\"ddmmp\"] = mpID;\n\t\t//分享携带推广ID\n\t\targDict[\"popularizeID\"] = this.HeroManager.GetHeroID();\n\n\t\tgameLoadUrl += this.GetUrlStr(argDict);\n\n\t\tlet shareInfo = {\n\t\t\ttitle:title,\n\t\t\tdesc:desc,\n\t\t\tlink:gameLoadUrl,\n\t\t\timgUrl:weChatShareImageUrl,\n\t\t\ttype:\"link\",\n\t\t\tdataUrl:\"\",\n\t\t\tsuccess:this.ShareSuccess.bind(this),\n\t\t\tcancel:this.ShareCancel.bind(this),\n\t\t}\n\n\t\tthis.sdk.onMenuShareTimeline(shareInfo);\n\t\tthis.sdk.onMenuShareAppMessage(shareInfo);\n\t\tthis.sdk.onMenuShareQQ(shareInfo);\n\t\tthis.sdk.onMenuShareWeibo(shareInfo);\n\t\tthis.sdk.onMenuShareQZone(shareInfo);\n\t},\n\n\tGetUrlStr:function(dataDict){\n\n\t\tif(!dataDict){\n\t\t\treturn \"\"\n\t\t}\n\n\t\tvar argList = Object.keys(dataDict);\n\t\targList.sort();\n\t\tvar count = argList.length;\n\n\t\tvar urlSendStr = '?';\n\t\tfor(var index=0; index<count; index++){\n\t\t\tvar key = argList[index];\n\t\t\turlSendStr += key + '=' + dataDict[key] + '&';\n\t\t}\n\t\t//去掉最后一个&\n\t\turlSendStr = urlSendStr.substring(0, urlSendStr.length-1);\n\n\t\treturn urlSendStr;\n\t},\n\n\t//分享成功\n\tShareSuccess:function(){\n\t},\n\n\t//取消分享\n\tShareCancel:function(){\n\t},\n\n\tGetSDK:function(){\n\t\treturn this.sdk;\n\t},\n\n\tGetSDKProperty:function(property){\n\t\tif(!this.dataInfo.hasOwnProperty(property)){\n\t\t\tthis.ErrLog(\"GetSDKProperty not find property:%s\", property);\n\t\t\treturn\n\t\t}\n\n\t\treturn this.dataInfo[property];\n\t},\n\t//---------------微信头像-------------------------\n\n\t//玩家登陆完成\n\tOnEvent_PlayerLoginOK:function(){\n\t\tlet heroID = this.HeroManager.GetHeroID();\n\t\tlet headImageUrl = this.HeroManager.GetHeroProperty(\"headImageUrl\");\n\t\t//初始化第3方玩家头像贴图\n\t\tthis.InitHeroHeadImage(heroID, headImageUrl);\n\t},\n\n\tHeroIDGetHeadImgUrl:function(heroID){\n\t\tlet headSpriteFrameInfo =this.heroHeadSpriteFrame.SetDefault(heroID, {});\n\t\tif(typeof(headSpriteFrameInfo.HeadImageUrl)==\"undefined\"){\n\t\t\treturn \"\";\n\t\t}\n\t\treturn headSpriteFrameInfo.HeadImageUrl;\n\t},\n\n\t//------------头像贴图初始化-------------\n\t//通过玩家ID初始化玩家头像\n\tInitHeroHeadImage:function(heroID, headImageUrl){\n\t\tif(!headImageUrl){\n\t\t\treturn\n\t\t}\n\t\tlet headSpriteFrameInfo = this.heroHeadSpriteFrame.SetDefault(heroID, {});\n\t\t//如果缓存的url地址没有变化,并且已经存在spriteFrame对象了,则不用申请贴图数据\n\t\tif(headSpriteFrameInfo[\"HeadImageUrl\"] == headImageUrl && headSpriteFrameInfo[\"SpriteFrame\"]){\n\t\t\treturn\n\t\t}\n\t\t\n\t\t//如果本地有存了地址，直接写入缓存\n\t\tif(cc.sys.isNative){\n\t\t\tvar dirpath =  jsb.fileUtils.getWritablePath() + 'customHeadImage/';\n\t\t\tlet headPathMd5 = app.MD5.hex_md5(headImageUrl);\n\t        var filepath = dirpath + headPathMd5 + \".png\";\n\t        if(jsb.fileUtils.isFileExist(filepath)){\n\t            console.log('HeadImg is find:' + filepath);\n\t            cc.loader.load(filepath,function (err,tex) {\n\t                var spriteFrame = new cc.SpriteFrame(tex, cc.Rect(0, 0, tex.width, tex.height));\n\t                headSpriteFrameInfo[\"HeadImageUrl\"] = headImageUrl;\n\t\t\t\t\theadSpriteFrameInfo[\"SpriteFrame\"] = spriteFrame;\n\t            });\n        \t\treturn;\n        \t}\n        }\n        headSpriteFrameInfo[\"HeadImageUrl\"] = headImageUrl;\n\t\theadSpriteFrameInfo[\"SpriteFrame\"] = null;\n\n\t\tlet headInfo = {};\n\t\theadInfo[heroID] = headImageUrl;\n\n\t\tthis.SendHttpLoadHeadImage(headInfo);\n        \n\t},\n\n\t//通过字典初始化玩家头像\n\tInitHeroHeadImageByDict:function(heroHeadInfo){\n\t\tlet headInfo = {};\n\n\t\tfor(var heroID in heroHeadInfo){\n\t\t\tlet headImageUrl = heroHeadInfo[heroID];\n\t\t\tif(!headImageUrl){\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tlet headSpriteFrameInfo = this.heroHeadSpriteFrame.SetDefault(heroID, {});\n\t\t\t//如果缓存的url地址没有变化,并且已经存在spriteFrame对象了,则不用申请贴图数据\n\t\t\tif(headSpriteFrameInfo[\"HeadImageUrl\"] == headImageUrl && headSpriteFrameInfo[\"SpriteFrame\"]){\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\theadSpriteFrameInfo[\"HeadImageUrl\"] = headImageUrl;\n\t\t\theadSpriteFrameInfo[\"SpriteFrame\"] = null;\n\t\t\theadInfo[heroID] = headImageUrl;\n\t\t}\n\n\t\tif(Object.keys(headInfo).length){\n\t\t\tthis.SendHttpLoadHeadImage(headInfo);\n\t\t}\n\t},\n\n\t//发送封包请求\n\tSendHttpLoadHeadImage:function(headInfo){\n\n\t\tlet gameID = app.Client.GetClientConfigProperty(\"GameID\");\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF09);\n\t\tsendPack.HeadInfo = headInfo;\n\t\tsendPack.GameID = gameID;\n\t\tthis.NetManager.SendHttpPack(sendPack);\n\t},\n\n\t//接收到资源服务器下载资源回复\n\tOnHttpPack_HeadImagePathInfo:function(serverPack){\n\t\tlet resServerUrl = this.NetManager.GetResServerHttpAddress();\n\t\tif(!resServerUrl){\n\t\t\tthis.ErrLog(\"OnHttpPack_HeadImagePathInfo(%s,%s) not resServerUrl\");\n\t\t\treturn\n\t\t}\n\t\tlet bluebirdList = [];\n\t\tlet headPathInfo = serverPack[\"HeadPathInfo\"];\n\n\n\t\t//真机\n\t\tif(cc.sys.isNative) {\n\t\t\tfor(let heroID in headPathInfo){\n\t\t\t\tthis.SaveHeadImgFile(resServerUrl, heroID, headPathInfo[heroID]);\n\t\t\t}\n\t\t}else{\n\t\t //网页 \t\n\t\t\tfor(let heroID in headPathInfo){\n\t\t\t\tbluebirdList.push(this.CreateSpriteFrame(resServerUrl, heroID, headPathInfo[heroID]));\n\t\t\t}\n\t\t\tlet that = this;\n\t\t\tapp.bluebird.all(bluebirdList)\n\t\t\t.then(function(heroIDList){\n\t\t\t\tapp.Client.OnEvent(\"RefreshHeadImageSprite\", {\"HeroIDList\":heroIDList});\n\t\t\t})\n\t\t\t.catch(function(error){\n\t\t\t\tthat.ErrLog(\"OnHttpPack_HeadImagePathInfo:%s\", error.stack)\n\t\t\t})\n\t\t}\n\n\t},\n\n\t//从本地获取微信头像\n\tSaveHeadImgFile:function(resServerUrl, heroID, headPath){\n\t\tif (!cc.sys.isNative) {\n\t\t\treturn;\n\t\t}\n\t\tvar dirpath =  jsb.fileUtils.getWritablePath() + 'customHeadImage/';\n        let url = [resServerUrl, headPath].join(\"/\");\n        let headImageUrl=this.HeroIDGetHeadImgUrl(heroID);\n        if(headImageUrl==\"\"){\n        \treturn;\n        }\n        let headPathMd5 = app.MD5.hex_md5(headImageUrl);\n        var filepath = dirpath + headPathMd5 + \".png\";\n        console.log(\"filepath ->\",filepath);\n        let that = this;\n        function loadEnd(){\n        \treturn that.ControlManager.CreateLoadPromiseByUrl(filepath)\n\t\t\t\t\t.then(function(texture){\n\t\t\t\t\t\tif(texture instanceof cc.Texture2D){\n\t\t\t\t\t\t\tlet spriteFrame = new cc.SpriteFrame(texture);\n\t\t\t\t\t\t\tlet headSpriteFrameInfo = that.heroHeadSpriteFrame.SetDefault(heroID, {});\n\t\t\t\t\t\t\theadSpriteFrameInfo[\"SpriteFrame\"] = spriteFrame;\n\t\t\t\t\t\t\tlet heroIDList = [];\n\t\t\t\t\t\t\theroIDList.push(heroID);\n\t\t\t\t\t\t\tapp.Client.OnEvent(\"RefreshHeadImageSprite\", {\"HeroIDList\":heroIDList});\n\t\t\t\t\t\t\treturn heroID;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tthat.ErrLog(\"texture not Texture2D\");\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function(error){\n\t\t\t\t\t\tthat.ErrLog(\"OnHttpPack_HeadImagePathInfo error:%s\", error.stack);\n\t\t\t\t\t})\n        }\n\n        if( jsb.fileUtils.isFileExist(filepath) ){\n            console.log('HeadImg is find:' + filepath);\n            loadEnd();\n            return;\n        }\n\n        var saveFile = function(data){\n            if( typeof data !== 'undefined' && cc.sys.isNative){\n                if( !jsb.fileUtils.isDirectoryExist(dirpath) ){\n                    jsb.fileUtils.createDirectory(dirpath);\n                }else{\n                    // console.log(\"路径exist\");\n                }\n                // console.log(\"saveFile data:\"+data);\n                // console.log(\"saveFile Uint8Array data:\"+new Uint8Array(data));\n                // new Uint8Array(data) writeDataToFile  writeStringToFile\n                if( jsb.fileUtils.writeDataToFile( new Uint8Array(data) , filepath) ){\n                    console.log('HeadImg write file succeed.');\n                    loadEnd();\n                }else{\n                    console.log('HeadImg write file failed.');\n                }\n            }else{\n                console.log('HeadImg download file failed.');\n            }\n        };\n\t\tif (app.ControlManager().IsOpenVpn()) {\n            return;\n        }\n        var xhr = new XMLHttpRequest();\n\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4 ) {\n                if(xhr.status === 200){\n                    saveFile(xhr.response);\n                }else{\n                    saveFile(null);\n                }\n            }\n        }.bind(this);\n        //responseType一定要在外面设置\n        xhr.responseType = 'arraybuffer';\n        xhr.open(\"GET\", url, true);\n        xhr.send();\n    },\n\n\t//创建头像贴图对象\n\tCreateSpriteFrame:function(resServerUrl, heroID, headPath){\n\t\tlet that = this;\n\n\t\tlet targetPath = [resServerUrl, headPath].join(\"/\");\n\n\t\treturn this.ControlManager.CreateLoadPromiseByUrl(targetPath)\n\t\t\t.then(function(texture){\n\t\t\t\tif(texture instanceof cc.Texture2D){\n\t\t\t\t\tlet spriteFrame = new cc.SpriteFrame(texture);\n\t\t\t\t\tlet headSpriteFrameInfo = that.heroHeadSpriteFrame.SetDefault(heroID, {});\n\t\t\t\t\theadSpriteFrameInfo[\"SpriteFrame\"] = spriteFrame;\n\t\t\t\t\treturn heroID\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tthat.ErrLog(\"texture not Texture2D\");\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(function(error){\n\t\t\t\tthat.ErrLog(\"OnHttpPack_HeadImagePathInfo error:%s\", error.stack);\n\t\t\t})\n\t},\n\n\t//获取指定玩家的第3方头像贴图对象\n\tGetHeroHeadSpriteFrame:function(heroID){\n\t\tif(!this.heroHeadSpriteFrame){\n\t\t\tconsole.log(\"头像资源还未初始化...\")\n\t\t\treturn;\n\t\t}\n\t\tlet headSpriteFrameInfo = this.heroHeadSpriteFrame[heroID];\n\t\tif(!headSpriteFrameInfo){\n\t\t\treturn\n\t\t}\n\t\treturn headSpriteFrameInfo[\"SpriteFrame\"];\n\t},\n\n\t//---------------------订单接口---------------------\n\t//收到预订单信息\n\tReceivePrepayOrder:function(serverPack){\n\t\tlet prepayOrderInfo = serverPack[\"PrepayOrderInfo\"];\n\n\t\tlet argDict = prepayOrderInfo[\"ArgDict\"];\n\n\t\targDict[\"success\"] = this.OnPayResult.bind(this);\n\t\tthis.sdk.chooseWXPay(argDict);\n\t},\n\n\t//接收到扫描支付回调\n\tReceivePrepayQRCodeOrder:function(serverPack){\n\t\tlet code_url = serverPack[\"Code_url\"];\n\n\t\tlet orderServerIP = app.Client.GetClientConfigProperty(\"OrderServerIP\");\n\t\tlet orderServerPort = app.Client.GetClientConfigProperty(\"OrderServerPort\");\n\n\t\tcode_url = [\"http://\",orderServerIP, \":\", orderServerPort, \"/\", code_url].join(\"\");\n\n\t\t//打开扫描支付页面\n\t\tcc.sys.openURL(code_url);\n\t},\n\n\t//支付结果通知\n\tOnPayResult:function(resultInfo){\n\n\t\tthis.SysLog(\"OnPayResult:\", resultInfo);\n\n\t\t//{\n\t\t//\t\"errMsg\":\"chooseWXPay:ok\"\n\t\t//}\n\t\tif(resultInfo[\"errMsg\"] == \"chooseWXPay:ok\"){\n\t\t\tthis.SysLog(\"支付成功\");\n\t\t}\n\t\telse{\n\t\t\tthis.SysLog(\"支付失败\");\n\t\t\tapp.SysNotifyManager().ShowSysMsg(\"CodeErrorMsg\", [\"微信公众号支付失败:\" + JSON.stringify(resultInfo)]);\n\t\t}\n\t},\n\n\t//---------------授权接口--------------------\n\t//微信授权\n\tLogin:function(){\n\t\tconsole.log(\"WeChatManager Login\");\n\t\tlet token = this.dataInfo[\"code\"];\n\t\tif(!token){\n\t\t\tthis.ErrLog(\"Login dataInfo not find code :\", this.dataInfo);\n\t\t\treturn\n\t\t}\n\n\t\tlet mpID = app.Client.GetClientConfigProperty(\"MPID\");\n\t\tif(!mpID){\n\t\t\tthis.ErrLog(\"Login not find MPID\");\n\t\t\treturn\n\t\t}\n\n\t\tconsole.log(\"WeChatManager Login 2222222222222\");\n\n\t\tthis.HeroAccountManager.LoginAccountBySDK(this.ShareDefine.SDKType_WeChat, token, mpID);\n\t},\n\n\t//检查登录是否是短线重登\n\tCheckLoginBySDK:function(){\n\t\tlet token = this.dataInfo[\"code\"];\n\t\tif(!token){\n\t\t\tthis.ErrLog(\"Login dataInfo not find code :\", this.dataInfo);\n\t\t\treturn false;\n\t\t}\n\n\t\tlet mpID = app.Client.GetClientConfigProperty(\"MPID\");\n\t\tif(!mpID){\n\t\t\tthis.ErrLog(\"Login not find MPID\");\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\n\n\t//----------------发包接口------------------------\n\n\t//发送请求微信公众号sdk签名\n\tSendRequestWeChatSDKIntSign:function(){\n\n\t\tlet mpID = app.Client.GetClientConfigProperty(\"MPID\");\n\t\t//没有配置公众号,不需要分享功能\n\t\tif(!mpID){\n\t\t\tthis.Log(\"SendRequestWeChatSDKIntSign not mpID\");\n\t\t\treturn\n\t\t}\n\n\t\t//native版本不需要请求签名,H5才需要\n\t\tif(cc.sys.isNative){\n\t\t\treturn\n\t\t}\n\n\t\t//如果网页没有加载wxSDK\n\t\tif(!this.wx){\n\t\t\tthis.ErrLog(\"SendRequestWeChatSDKIntSign not find wx\");\n\t\t\treturn\n\t\t}\n\t\tlet url = window.location.href.split('#')[0];\n\t\tif(!url){\n\t\t\tthis.ErrLog(\"SendRequestWeChatSDKIntSign  window.location.href:%s\",  window.location.href)\n\t\t\treturn\n\t\t}\n\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF06);\n\t\tsendPack.MPID = mpID;\n\t\tsendPack.Url = url;\n\t\tthis.NetManager.SendHttpPack(sendPack);\n\t},\n\n\t//是否已经关注公众号\n\tSendIsSubscribeWeChatMP:function(){\n\n\t\tlet mpID = app.Client.GetClientConfigProperty(\"MPID\");\n\t\t//没有配置公众号,不需要验证是否关注公众号\n\t\tif(!mpID){\n\t\t\tthis.ErrLog(\"SendIsSubscribeWeChatMP not find MPID\");\n\t\t\treturn\n\t\t}\n\n\t\tlet accountID = this.HeroAccountManager.GetAccountProperty(\"AccountID\");\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF05);\n\t\tsendPack.AccountID = accountID;\n\t\tsendPack.MPID = mpID;\n\t\tthis.NetManager.SendHttpPack(sendPack);\n\t},\n});\n\nvar g_WeChatManager = null;\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n\tif(!g_WeChatManager){\n\t\tg_WeChatManager = new WeChatManager();\n\t}\n\treturn g_WeChatManager;\n}"]}