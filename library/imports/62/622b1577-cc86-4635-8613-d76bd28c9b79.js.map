{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\net/assets\\script\\net\\NetRequest.js"],"names":["app","require","NetRequest","BaseClass","extend","Init","JS_Name","Log","SendHttpRequest","serverUrl","argString","requestType","sendPack","timeout","successCb","failCb","timeoutCb","errorCb","_SendHttpRequest","SendHttpRequestPost","SendHttpRequestGet","ControlManager","IsOpenVpn","url","join","dataStr","JSON","stringify","timeOut","httpRequest","XMLHttpRequest","open","setRequestHeader","that","onerror","ErrLog","readyState","status","NetManager","OnConnectHttpFail","ontimeout","onreadystatechange","responseText","OnReceiveHttpPack","send","g_httpRequest","exports","GetModel"],"mappings":";;;;;;AAAA;;;;;;;;;;;;;;;AAeA,IAAIA,MAAMC,QAAQ,KAAR,CAAV;;AAEA;;;AAGA,IAAIC,aAAaF,IAAIG,SAAJ,CAAcC,MAAd,CAAqB;;AAErCC,OAAM,gBAAY;AACjB,OAAKC,OAAL,GAAe,YAAf;AACA,OAAKC,GAAL,CAAS,mBAAT;AACA,EALoC;;AAOrC;;;;;;;;;;;;;;;;;;;;;;;AA0BAC,kBAAiB,yBAAUC,SAAV,EAAqBC,SAArB,EAAgCC,WAAhC,EAA6CC,QAA7C,EAA2I;AAAA,MAApFC,OAAoF,uEAA1E,KAA0E;AAAA,MAAnEC,SAAmE,uEAAvD,IAAuD;AAAA,MAAjDC,MAAiD,uEAAxC,IAAwC;AAAA,MAAlCC,SAAkC,uEAAtB,IAAsB;AAAA,MAAhBC,OAAgB,uEAAN,IAAM;;AAC3J,OAAKC,gBAAL,CAAsBT,SAAtB,EAAiCC,SAAjC,EAA4CC,WAA5C,EAAyDC,QAAzD,EAAmEC,OAAnE,EAA4EC,SAA5E,EAAuFC,MAAvF,EAA+FC,SAA/F,EAA0GC,OAA1G;AACA,EAnCoC;;AAqCrC;;;AAGAE,sBAAqB,6BAAUV,SAAV,EAAqBC,SAArB,EAAgCE,QAAhC,EAA6H;AAAA,MAAnFC,OAAmF,uEAAzE,IAAyE;AAAA,MAAnEC,SAAmE,uEAAvD,IAAuD;AAAA,MAAjDC,MAAiD,uEAAxC,IAAwC;AAAA,MAAlCC,SAAkC,uEAAtB,IAAsB;AAAA,MAAhBC,OAAgB,uEAAN,IAAM;;AACjJ,OAAKC,gBAAL,CAAsBT,SAAtB,EAAiCC,SAAjC,EAA4C,MAA5C,EAAoDE,QAApD,EAA8DC,OAA9D,EAAuEC,SAAvE,EAAkFC,MAAlF,EAA0FC,SAA1F,EAAqGC,OAArG;AACA,EA1CoC;;AA4CrC;;;AAGAG,qBAAoB,4BAAUX,SAAV,EAAqBC,SAArB,EAAgCE,QAAhC,EAA6H;AAAA,MAAnFC,OAAmF,uEAAzE,IAAyE;AAAA,MAAnEC,SAAmE,uEAAvD,IAAuD;AAAA,MAAjDC,MAAiD,uEAAxC,IAAwC;AAAA,MAAlCC,SAAkC,uEAAtB,IAAsB;AAAA,MAAhBC,OAAgB,uEAAN,IAAM;;AAChJ,OAAKC,gBAAL,CAAsBT,SAAtB,EAAiCC,SAAjC,EAA4C,KAA5C,EAAmDE,QAAnD,EAA6DC,OAA7D,EAAsEC,SAAtE,EAAiFC,MAAjF,EAAyFC,SAAzF,EAAoGC,OAApG;AACA,EAjDoC;;AAmDrC;;;;;;;;;;;;AAYAC,mBAAkB,0BAAUT,SAAV,EAAqBC,SAArB,EAAgCC,WAAhC,EAA6CC,QAA7C,EAA0I;AAAA,MAAnFC,OAAmF,uEAAzE,IAAyE;AAAA,MAAnEC,SAAmE,uEAAvD,IAAuD;AAAA,MAAjDC,MAAiD,uEAAxC,IAAwC;AAAA,MAAlCC,SAAkC,uEAAtB,IAAsB;AAAA,MAAhBC,OAAgB,uEAAN,IAAM;;;AAE3J,MAAIjB,IAAIqB,cAAJ,GAAqBC,SAArB,EAAJ,EAAsC;AAC5B;AACH;;AAEP,MAAIC,MAAM,CAACd,SAAD,EAAYC,SAAZ,EAAuBc,IAAvB,CAA4B,EAA5B,CAAV;;AAEA;;AAEA,MAAIC,UAAUC,KAAKC,SAAL,CAAef,QAAf,CAAd;;AAEA;;AAEA,MAAIgB,UAAU,KAAd;AACA;AACA,MAAIC,cAAc,IAAIC,cAAJ,EAAlB;AACAD,cAAYhB,OAAZ,GAAsBA,OAAtB;AACAgB,cAAYE,IAAZ,CAAiBpB,WAAjB,EAA8BY,GAA9B,EAAmC,IAAnC;AACA;AACAM,cAAYG,gBAAZ,CAA6B,cAA7B,EAA6C,kBAA7C;;AAEA,MAAIC,OAAO,IAAX;AACAJ,cAAYK,OAAZ,GAAsB,YAAY;AACjCD,QAAKE,MAAL,CAAY,sBAAZ,EAAoCZ,GAApC;AACA,OAAI,CAAC,CAACN,OAAN,EAAe;AACdA,YAAQR,SAAR,EAAmBoB,YAAYO,UAA/B,EAA2CP,YAAYQ,MAAvD,EAA+DR,WAA/D;AACA,IAFD,MAEO;AACN7B,QAAIsC,UAAJ,GAAiBC,iBAAjB,CAAmC9B,SAAnC,EAA8CoB,YAAYO,UAA1D,EAAsEP,YAAYQ,MAAlF,EAA0FR,WAA1F;AACA;AACD,GAPD;AAQAA,cAAYW,SAAZ,GAAwB,YAAY;AACnCZ,aAAU,IAAV;AACA,OAAI,CAAC,CAACZ,SAAN,EAAiB;AAChBA,cAAUP,SAAV,EAAqBoB,YAAYO,UAAjC,EAA6CP,YAAYQ,MAAzD,EAAiER,WAAjE;AACA,IAFD,MAEO;AACN7B,QAAIsC,UAAJ,GAAiBC,iBAAjB,CAAmC9B,SAAnC,EAA8CoB,YAAYO,UAA1D,EAAsEP,YAAYQ,MAAlF,EAA0FR,WAA1F;AACA;AACD,GAPD;AAQAA,cAAYY,kBAAZ,GAAiC,YAAY;AAC5C,OAAIb,WAAW,IAAf,EAAqB;AACpB;AACA;AACD;AACA,OAAIC,YAAYQ,MAAZ,IAAsB,GAA1B,EAA+B;AAC9B,QAAIR,YAAYO,UAAZ,IAA0B,CAA9B,EAAiC;;AAEhC;;AAEA,SAAI,CAAC,CAACtB,SAAN,EAAiB;AAChBA,gBAAUL,SAAV,EAAqBoB,YAAYa,YAAjC,EAA+Cb,WAA/C;AACA,MAFD,MAEO;AACN7B,UAAIsC,UAAJ,GAAiBK,iBAAjB,CAAmClC,SAAnC,EAA8CoB,YAAYa,YAA1D,EAAwEb,WAAxE;AACA;AACD;AACD,IAXD,MAYK;AACJ,QAAI,CAAC,CAACd,MAAN,EAAc;AACbA,YAAON,SAAP,EAAkBoB,YAAYO,UAA9B,EAA0CP,YAAYQ,MAAtD,EAA8DR,WAA9D;AACA,KAFD,MAEO;AACN7B,SAAIsC,UAAJ,GAAiBC,iBAAjB,CAAmC9B,SAAnC,EAA8CoB,YAAYO,UAA1D,EAAsEP,YAAYQ,MAAlF,EAA0FR,WAA1F;AACA;AACDI,SAAKE,MAAL,CAAY,2BAAZ,EAAyCN,YAAYO,UAArD,EAAiEP,YAAYQ,MAA7E;AACA;AACD,GAzBD;AA0BAR,cAAYe,IAAZ,CAAiBnB,OAAjB;AACA;;AAjIoC,CAArB,CAAjB;;AAwIA;AACA,IAAIoB,gBAAgB,IAApB;;AAGA;;;AAGAC,QAAQC,QAAR,GAAmB,YAAY;AAC9B,KAAI,CAACF,aAAL,EAAoB;AACnBA,kBAAgB,IAAI3C,UAAJ,EAAhB;AACA;AACD,QAAO2C,aAAP;AACA,CALD","file":"NetRequest.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\net","sourcesContent":["/*\n *  ----------------------------------------------------------------------------------------------------\n *  @copyright: Copyright (c) 2004, 2010 Xiamen DDM Network Technology Co.,Ltd., All rights reserved.\n *  ----------------------------------------------------------------------------------------------------\n *  @package NetRequest.js\n *  @todo: 发送接收http\n *  \n *  @author hongdian\n *  @date 2014-10-30 16:04\n *  @version 1.0\n *  \n *  修改时间 修改人 修改内容\n *  -------------------------------------------------------------------------------\n *  \n */\nvar app = require('app');\n\n/**\n * 类方法定义\n */\nvar NetRequest = app.BaseClass.extend({\n\n\tInit: function () {\n\t\tthis.JS_Name = \"NetRequest\";\n\t\tthis.Log(\"create NetRequest\");\n\t},\n\n\t/**\n\t * 发送HTTP请求\n\t * * @param requestType POST or GET\n\t调用方式：\n\tapp.NetRequest().SendHttpRequest(serverUrl, argString, requestType, sendPack, 3000, \n            (serverUrl, responseText, httpRequest)=>{ // success\n\n            }, \n            (serverUrl, readyState, status, httpRequest)=>{ // fail\n                \n            },\n            (serverUrl, readyState, status, httpRequest)=>{ // timeout\n\n            }, \n            (serverUrl, readyState, status, httpRequest)=>{ // error\n\n            }\n        );\n    或\n        app.NetRequest().SendHttpRequest(serverUrl, argString, requestType, sendPack, 3000, \n            this.OnReceiveHttpPack.bind(this), \n            this.OnConnectHttpFail.bind(this),\n            this.OnConnectHttpTimeout.bind(this),\n            this.OnConnectHttpError.bind(this),\n\t\t);\n\t */\n\tSendHttpRequest: function (serverUrl, argString, requestType, sendPack, timeout = 15000, successCb = null, failCb = null, timeoutCb = null, errorCb = null) {\n\t\tthis._SendHttpRequest(serverUrl, argString, requestType, sendPack, timeout, successCb, failCb, timeoutCb, errorCb);\n\t},\n\n\t/**\n\t * 发送HTTP POST请求\n\t */\n\tSendHttpRequestPost: function (serverUrl, argString, sendPack, timeout = 3000, successCb = null, failCb = null, timeoutCb = null, errorCb = null) {\n\t\tthis._SendHttpRequest(serverUrl, argString, \"POST\", sendPack, timeout, successCb, failCb, timeoutCb, errorCb);\n\t},\n\n\t/**\n\t * 发送HTTP GET请求\n\t */\n\tSendHttpRequestGet: function (serverUrl, argString, sendPack, timeout = 3000, successCb = null, failCb = null, timeoutCb = null, errorCb = null) {\n\t\tthis._SendHttpRequest(serverUrl, argString, \"GET\", sendPack, timeout, successCb, failCb, timeoutCb, errorCb);\n\t},\n\n\t/**\n\t * 发送HTTP请求\n\t * @param {*} serverUrl \n\t * @param {*} argString \n\t * @param {*} requestType requestType POST or GET\n\t * @param {*} sendPack \n\t * @param {*} timeout \n\t * @param {*} successCb 默认回调app.NetManager().OnReceiveHttpPack(serverUrl, httpRequest.responseText);\n\t * @param {*} failCb 默认回调app.NetManager().OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status);\n\t * @param {*} timeoutCb 默认回调app.NetManager().OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status);\n\t * @param {*} errorCb 默认回调app.NetManager().OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status);\n\t */\n\t_SendHttpRequest: function (serverUrl, argString, requestType, sendPack, timeout = 3000, successCb = null, failCb = null, timeoutCb = null, errorCb = null) {\n\n\t\tif (app.ControlManager().IsOpenVpn()) {\n            return;\n        }\n\n\t\tvar url = [serverUrl, argString].join(\"\")\n\n\t\t// console.log(\"NetRequest _SendHttpRequest url: \",url);\n\n\t\tvar dataStr = JSON.stringify(sendPack);\n\n\t\t// console.log(\"NetRequest _SendHttpRequest dataStr: \",dataStr);\n\n\t\tlet timeOut = false;\n\t\t// 每次都实例化一个，否则会引起请求结束，实例被释放了\n\t\tvar httpRequest = new XMLHttpRequest();\n\t\thttpRequest.timeout = timeout;\n\t\thttpRequest.open(requestType, url, true);\n\t\t// 服务器json解码\n\t\thttpRequest.setRequestHeader(\"Content-Type\", \"application/json\");\n\n\t\tvar that = this;\n\t\thttpRequest.onerror = function () {\n\t\t\tthat.ErrLog(\"httpRequest.error:%s\", url);\n\t\t\tif (!!errorCb) {\n\t\t\t\terrorCb(serverUrl, httpRequest.readyState, httpRequest.status, httpRequest);\n\t\t\t} else {\n\t\t\t\tapp.NetManager().OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status, httpRequest);\n\t\t\t}\n\t\t};\n\t\thttpRequest.ontimeout = function () {\n\t\t\ttimeOut = true;\n\t\t\tif (!!timeoutCb) {\n\t\t\t\ttimeoutCb(serverUrl, httpRequest.readyState, httpRequest.status, httpRequest);\n\t\t\t} else {\n\t\t\t\tapp.NetManager().OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status, httpRequest);\n\t\t\t}\n\t\t};\n\t\thttpRequest.onreadystatechange = function () {\n\t\t\tif (timeOut == true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// 执行成功\n\t\t\tif (httpRequest.status == 200) {\n\t\t\t\tif (httpRequest.readyState == 4) {\n\t\t\t\t\t\n\t\t\t\t\t// console.log(\"NetRequest _SendHttpRequest responseText: \",httpRequest.responseText);\n\n\t\t\t\t\tif (!!successCb) {\n\t\t\t\t\t\tsuccessCb(serverUrl, httpRequest.responseText, httpRequest);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapp.NetManager().OnReceiveHttpPack(serverUrl, httpRequest.responseText, httpRequest);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!!failCb) {\n\t\t\t\t\tfailCb(serverUrl, httpRequest.readyState, httpRequest.status, httpRequest);\n\t\t\t\t} else {\n\t\t\t\t\tapp.NetManager().OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status, httpRequest);\n\t\t\t\t}\n\t\t\t\tthat.ErrLog(\"onreadystatechange(%s,%s)\", httpRequest.readyState, httpRequest.status);\n\t\t\t}\n\t\t};\n\t\thttpRequest.send(dataStr);\n\t},\n\n\n})\n\n\n\n//定义一个全局http\nvar g_httpRequest = null\n\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function () {\n\tif (!g_httpRequest) {\n\t\tg_httpRequest = new NetRequest();\n\t}\n\treturn g_httpRequest;\n}"]}