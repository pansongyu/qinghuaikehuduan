{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\ui\\uiEffect/assets\\script\\ui\\uiEffect\\SliderProgressBarParagraph.js"],"names":["app","require","cc","Class","extends","properties","ScrollThreshold","EventNode","Node","ProgressBar","OnLoad","JS_Name","node","name","ComTool","slider","getComponent","Slider","paragraphPositionDict","LocalDataManager","InitData","keyIDList","showDataList","isSendEvent","keyCount","length","ErrLog","push","offProgress","index","keyID","progress","minProgress","maxProgress","ShowBackgroundLabel","OnSliderEvent","backGroundNode","getChildByName","count","childName","StringAddNumSuffix","childPath","join","labelNode","find","childLabel","Label","string","ResetProgress","nowProgress","_dragging","emit","SetChooseKeyID","GetChooseKeyID"],"mappings":"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","file":"SliderProgressBarParagraph.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\ui\\uiEffect","sourcesContent":["/*\n SliderProgressBarParagraph.js 滑动进度分段带进度条显示\n */\n\nvar app = require(\"app\");\n\ncc.Class({\n\textends: require(\"BaseComponent\"),\n\n\tproperties: {\n\t\tScrollThreshold: 0.5,\n\t\tEventNode:cc.Node,\n\t\tProgressBar:cc.ProgressBar,\n\t},\n\n\t// use this for initialization\n\tOnLoad: function () {\n\t\tthis.JS_Name = this.node.name + \"_SliderProgressBarParagraph\";\n\n        this.ComTool = app.ComTool();\n\n\n\t\tthis.slider = this.node.getComponent(cc.Slider);\n\n\t\tthis.paragraphPositionDict = {};\n\n        this.LocalDataManager = app.LocalDataManager();\n\n\t},\n\n\tInitData:function(keyIDList, showDataList=[], isSendEvent=true){\n\t\tthis.paragraphPositionDict = {};\n\n\t\tlet keyCount = keyIDList.length;\n\t\tif(!keyCount){\n\t\t\tthis.ErrLog(\"InitData keyIDList empty\", keyIDList);\n\t\t\treturn\n\t\t}\n\t\t//如果只有一个则设置开始结束一样\n\t\telse if(keyCount == 1){\n\t\t\tkeyIDList.push(keyIDList[0]);\n\t\t\tkeyCount = keyIDList.length;\n\t\t}\n\n\t\tlet offProgress = this.ScrollThreshold*1/(keyCount-1);\n\n\t\tfor(let index=0; index<keyCount; index++){\n\n\t\t\tlet keyID = keyIDList[index];\n\t\t\tlet progress = index/(keyCount-1);\n\n\t\t\tlet minProgress = progress - offProgress;\n\t\t\tlet maxProgress = progress + offProgress;\n\n\t\t\tif(minProgress < 0){\n\t\t\t\tminProgress = 0;\n\t\t\t}\n\n\t\t\tif(maxProgress > 1){\n\t\t\t\tmaxProgress = 1;\n\t\t\t}\n\n\t\t\t//分段每个点的进度位置,最小最大进入范围\n\t\t\tthis.paragraphPositionDict[index] = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"KeyID\":keyID,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Progress\":progress,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"MinProgress\":minProgress,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"MaxProgress\":maxProgress,\n\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t}\n\n\t\tif(showDataList.length){\n            this.ShowBackgroundLabel(showDataList)\n        }\n\t\t//初始化默认从0开始\n\t\tthis.slider.progress = 0;\n\n\t\tif(isSendEvent){\n            this.OnSliderEvent(this.slider);\n        }\n\t},\n\n\tShowBackgroundLabel:function(showDataList){\n\n\t\tlet backGroundNode = this.node.getChildByName(\"Background\");\n\t\tlet count = showDataList.length;\n\n\t\tfor(let index=count; index>0; index--){\n\t\t\tlet childName = this.ComTool.StringAddNumSuffix(\"yuandian\",index,2);\n\t\t\tlet childPath = [childName, \"lb\"].join(\"/\");\n\t\t\tlet labelNode = cc.find(childPath, backGroundNode);\n\t\t\tif(!labelNode){\n\t\t\t\tthis.ErrLog(\"ShowBackgroundLabel not find:%s,%s\", childPath, this.node.name);\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tlet childLabel = labelNode.getComponent(cc.Label);\n\t\t\tchildLabel.string = showDataList[index-1];\n\t\t}\n\t},\n\n    OnSliderEvent:function(slider){\n        this.ResetProgress();\n\n        if(this.ProgressBar){\n            this.ProgressBar.progress = this.slider.progress;\n        }\n    },\n\n\tResetProgress:function(){\n\n\t\tlet nowProgress = this.slider.progress;\n\n\t\t//遍历所有的坐标进度点\n\t\tfor(let index in this.paragraphPositionDict){\n\t\t\tlet paragraphPositionDict = this.paragraphPositionDict[index];\n\t\t\t//查找当前进度位置停留值\n\t\t\tif(paragraphPositionDict[\"MinProgress\"] <= nowProgress && nowProgress <= paragraphPositionDict[\"MaxProgress\"]){\n\n\t\t\t\tlet progress = paragraphPositionDict[\"Progress\"];\n\t\t\t\t//如果正在滑动中跳出\n\t\t\t\tif( this.slider._dragging){\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tthis.slider.progress = progress;\n\t\t\t\t}\n\t\t\t\tif(this.EventNode){\n\t\t\t\t\tthis.EventNode.emit(\"SliderParagraph\",  {\"KeyID\":paragraphPositionDict[\"KeyID\"], \"Node\":this.node,\"Progress\":progress});\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t},\n\n\t//设置滑动到指定key位置\n\tSetChooseKeyID:function(keyID){\n\t\tfor(let index in this.paragraphPositionDict){\n\t\t\tlet paragraphPositionDict = this.paragraphPositionDict[index];\n\t\t\tif(paragraphPositionDict[\"KeyID\"] == keyID){\n\t\t\t\tthis.slider.progress = paragraphPositionDict[\"Progress\"];\n\t\t\t\tthis.OnSliderEvent(this.slider);\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t\tthis.ErrLog(\"SetChooseKeyID(%s) not find:\", keyID, this.paragraphPositionDict);\n\t},\n\n\t//获取当前选中的keyID\n\tGetChooseKeyID:function(){\n\t\tlet nowProgress = this.slider.progress;\n\n\t\tfor(let index in this.paragraphPositionDict){\n\t\t\tlet paragraphPositionDict = this.paragraphPositionDict[index];\n\t\t\t//查找当前进度位置停留值\n\t\t\tif(paragraphPositionDict[\"MinProgress\"] <= nowProgress && nowProgress <= paragraphPositionDict[\"MaxProgress\"]){\n\t\t\t\treturn paragraphPositionDict[\"KeyID\"]\n\t\t\t}\n\t\t}\n\t\tthis.ErrLog(\"GetChooseKeyID not find:%s\", nowProgress, this.paragraphPositionDict);\n\t\treturn 0\n\t},\n\n});\n"]}