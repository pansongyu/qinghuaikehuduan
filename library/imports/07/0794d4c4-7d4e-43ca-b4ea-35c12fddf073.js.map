{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\SysNotify/assets\\script\\dbmanager\\SysNotify\\SysNotifyManager.js"],"names":["app","require","SysNotifyManager","BaseClass","extend","Init","JS_Name","SysDataManager","NewSysMsg","GetTableDict","ComTool","ShareDefine","regExpDict","NetManager","RegNetPack","OnPack_ServerSysMsg","Log","serverPack","msgID","key","argList","p","count","length","msgArgList","index","data","push","ShowSysMsg","Client","OnEvent","GetSysMsgContentByMsgID","paramList","hasOwnProperty","SysLog","msgInfo","msgContent","TranslateMsgContent","param","argIndex","regExpObj","regKeyString","StringAddNumSuffix","indexOf","RegExp","replace","msgPos","console","log","ErrLog","FormManager","ShowForm","ConfirmOK","ConfirmManager","SetWaitForConfirmForm","OnConFirm","bind","ShowConfirm","ConfirmYN","clickType","backArgList","g_SysNotifyManager","exports","GetModel"],"mappings":"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","file":"SysNotifyManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\SysNotify","sourcesContent":["/*\n *  ----------------------------------------------------------------------------------------------------\n *  @copyright: Copyright (c) 2004, 2010 Xiamen DDM Network Technology Co.,Ltd., All rights reserved.\n *  ----------------------------------------------------------------------------------------------------\n *  @package SysNotifyManager.js\n *  @todo: 系统通知模块\n *  \n *  @author hongdian\n *  @date 2014-10-30 16:04\n *  @version 1.0\n *  \n *  修改时间 修改人 修改内容\n *  -------------------------------------------------------------------------------\n *  \n */\nvar app = require('app');\n\n/**\n * 类构造\n */\nvar SysNotifyManager = app.BaseClass.extend({\n\t\n\t/**\n\t * 初始化\n\t */\n\tInit:function(){\n\n\t\tthis.JS_Name = \"SysNotifyManager\";\n\t\t\n\t\tthis.SysDataManager = app.SysDataManager();\n\t\tthis.NewSysMsg = this.SysDataManager.GetTableDict(\"NewSysMsg\");\n\n\t\tthis.ComTool = app.ComTool();\n\t\tthis.ShareDefine = app.ShareDefine();\n\n\t\t//缓存的正则表达式字典\n\t\tthis.regExpDict = {};\n\n\t\tapp.NetManager().RegNetPack(\"S1010_SystemMessage\", this.OnPack_ServerSysMsg, this);\n\n\t\tthis.Log(\"create SysNotifyManager\");\n\t\t\n\t},\n\n\n\t//-----------------------回调函数-----------------------------\n\t/**\n\t * 接收封包\n\t */\n\tOnPack_ServerSysMsg:function(serverPack){\n\t\t//系统提示码\n\t\tlet msgID = serverPack.key;\n\t\tlet argList = serverPack.p||[];\n\n\t\tlet count = argList.length;\n\t\tlet msgArgList = [];\n\t\tfor(let index=0; index<count; index++){\n\n\t\t\tlet data = argList[index];\n\n\t\t\tif(data[\"StringValue\"]){\n\t\t\t\tmsgArgList.push(data[\"StringValue\"]);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tmsgArgList.push(data[\"IntValue\"]);\n\t\t\t}\n\t\t}\n\n\t\tthis.ShowSysMsg(msgID, msgArgList);\n\n\t\tapp.Client.OnEvent(\"ServerSysMsg\", {\"MsgID\":msgID, \"MsgArgList\":msgArgList});\n\t},\n\n\t//-----------------------获取函数-----------------------------\n\n\t//获取系统提示文本\n\tGetSysMsgContentByMsgID:function(msgID, paramList){\n\n\t\tif(!paramList){\n\t\t\tparamList = [];\n\t\t}\n\t\t//如果查找不到系统提示码,则为纯文本弹框提示直接播放不解码\n\t\tif(!this.NewSysMsg.hasOwnProperty(msgID)){\n\t\t\tthis.SysLog(\"GetSysMsgContentByMsgID(%s) NewSysMsg.txt not find\", msgID);\n\t\t\treturn msgID;\n\t\t}\n\t\tlet msgInfo = this.NewSysMsg[msgID];\n\t\tlet msgContent = msgInfo['Content'];\n\n\t\treturn this.TranslateMsgContent(msgContent, paramList);\n\n\t},\n\n\t/**\n\t * 替换消息文本\n\t * @param msgID 消息ID\n\t * @return 无返回值\n\t * @remarks \n\t */\n\tTranslateMsgContent:function(msgContent, paramList){\n\n\t\tlet count = paramList.length;\n\n\t\t// 替换文本\n\t\tfor(let index=0; index<=count; index++){\n\n\t\t\tlet param = paramList[index];\n\t\t\tlet argIndex = index + 1;\n\t\t\tlet regExpObj = null;\n\n\n\t\t\tlet regKeyString = this.ComTool.StringAddNumSuffix(\"S\", argIndex, 1);\n\t\t\tif(msgContent.indexOf(regKeyString) != -1){\n\n\t\t\t\tif(this.regExpDict.hasOwnProperty(regKeyString)){\n\t\t\t\t\tregExpObj = this.regExpDict[regKeyString];\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tregExpObj = new RegExp(\"{\" + regKeyString + \"}\", \"g\");\n\t\t\t\t\tthis.regExpDict[regKeyString] = regExpObj\n\t\t\t\t}\n\t\t\t\tmsgContent = msgContent.replace(regExpObj, param);\n\t\t\t}\n\t\t}\n\n\t\treturn msgContent\n\t},\n\t\n\t/**\n\t * 显示系统提示\n\t * @param msgID\n\t */\n\tShowSysMsg:function(msgID, msgArgList=[], msgPos = 4){\n\t\tif (typeof(msgID) == \"undefined\") {\n\t\t\tconsole.log(\"弹窗提示内容为空\");\n\t\t\treturn;\n\t\t}\n\t\tthis.Log(\"ShowSysMsg(%s):\", msgID, msgArgList);\n\n\t\tlet msgContent = \"\";\n\t\t//如果查找不到系统提示码,则为纯文本弹框提示直接播放不解码\n\t\tif(this.NewSysMsg.hasOwnProperty(msgID)){\n\t\t\tlet msgInfo = this.NewSysMsg[msgID];\n\t\t\tmsgPos = msgInfo[\"Pos\"];\n\n\t\t\tmsgContent = msgInfo['Content'];\n\t\t\tmsgContent = this.TranslateMsgContent(msgContent, msgArgList);\n\t\t}\n\t\telse{\n\t\t\t// msgPos = 4;\n\t\t\tmsgContent = msgID;\n\t\t}\n\n\n\t\t//出现位置 1系统广播(不允许主动调用这种类型,只能又聊天系统频道下发)\n\t\tif(msgPos == 1){\n\t\t\tthis.ErrLog(\"ShowSysMsg(%s) error\", msgID);\n\t\t}\n\t\t//只触发事件不显示提示,由事件自己决定(服务端下发客户端弹2次确认框等待点击)\n\t\telse if(msgPos == 2){\n\n\t\t}\n\t\t//浮动提示\n\t\telse if(msgPos == 3){\n\t\t\tapp.FormManager().ShowForm(\"UIMessage_Drift\", msgID, msgArgList, msgContent);\n\t\t}\n\t\t//\"确定\" 弹框提示\n\t\telse if(msgPos == 4){\n\t\t\tapp.FormManager().ShowForm(\"UIMessage\", \"OnSys\", this.ShareDefine.ConfirmOK, msgID, msgArgList, msgContent);\n\n\t\t}\n\t\t//\"是\",\"否\"\" 弹框提示\n\t\telse if(msgPos == 5){\n\t\t\tlet ConfirmManager = app.ConfirmManager();\n\t\t\tConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, []);\n\t\t\tConfirmManager.ShowConfirm(this.ShareDefine.ConfirmYN, msgID, msgArgList)\n\t\t}\n\t\telse{\n\t\t\tthis.ErrLog(\"ShowSysMsg(%s) msgPos(%s) error\", msgID, msgPos);\n\t\t}\n\t},\n\n    OnConFirm:function(clickType, msgID, backArgList){\n    \tif(clickType == \"Sure\"){\n    \t\tthis.Log(\"打开客服QQ\");\n    \t}\n    },\n\n})\n\n\nvar g_SysNotifyManager = null;\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n\tif(!g_SysNotifyManager)\n\t\tg_SysNotifyManager = new SysNotifyManager();\n\treturn g_SysNotifyManager;\n\t\n}\n"]}