{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\ui\\club/assets\\script\\ui\\club\\UIPromoterSetActiveDetail.js"],"names":["app","require","cc","Class","extends","properties","OnCreateInit","roomScrollView","node","getChildByName","getComponent","ScrollView","on","GetNextPage","OnShow","data","clubId","curPage","GetScorePercentList","isRefresh","sendPack","pid","pageNum","self","NetManager","SendPack","serverPack","UpdateScrollView","content","scrollToTop","DestroyAllChildren","demo","active","i","length","isExist","j","children","configId","child","instantiate","configInfo","roomNameStr","configName","ShareDefine","GametTypeID2Name","gameId","Label","string","size","EditBox","value","toString","addChild","GetAllRoomListCfg","list","temp","scorePercentStr","parseFloat","isNaN","ComTool","StrIsNum","push","SysNotifyManager","ShowSysMsg","OnClick","btnName","btnNode","promotionCalcActiveItemList","FormManager","GetFormComponentByFormName","ClickLeftBtn","CloseForm","ErrLog"],"mappings":"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","file":"UIPromoterSetActiveDetail.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\ui\\club","sourcesContent":["var app = require(\"app\");\ncc.Class({\n    extends: require(\"BaseForm\"),\n\n    properties: {\n\n    },\n\n    OnCreateInit: function () {\n        let roomScrollView = this.node.getChildByName(\"mark\").getComponent(cc.ScrollView);\n        roomScrollView.node.on('scroll-to-bottom',this.GetNextPage,this);\n    },\n    OnShow: function (data, clubId) {\n        this.data = data;\n        this.clubId = clubId;\n        this.curPage = 1;\n        this.GetScorePercentList(true);\n    },\n    GetNextPage:function(){\n        this.curPage++;\n        this.GetScorePercentList(false);\n    },\n    GetScorePercentList:function(isRefresh){\n        let sendPack = {};\n        sendPack.clubId = this.clubId;\n        sendPack.pid = this.data.pid;\n        sendPack.pageNum = this.curPage;\n        let self = this;\n        app.NetManager().SendPack(\"club.CClubPromotionCalcActiveList\",sendPack, function(serverPack){\n            self.UpdateScrollView(serverPack, isRefresh);\n        }, function(){\n\n        });\n    },\n    UpdateScrollView:function(serverPack, isRefresh){\n        let roomScrollView = this.node.getChildByName(\"mark\");\n        let content = roomScrollView.getChildByName(\"layout\");\n        if (isRefresh) {\n            roomScrollView.getComponent(cc.ScrollView).scrollToTop();\n            //content.removeAllChildren();\n            this.DestroyAllChildren(content);\n        }\n        let demo = this.node.getChildByName(\"demo\");\n        demo.active = false;\n        for (let i = 0; i < serverPack.length; i++) {\n            //先判断下是否已经存在\n            let isExist = false;\n            for (let j = 0; j < content.children.length; j++) {\n                if (content.children[j].configId == serverPack[i].configId) {\n                    isExist = true;\n                    break;\n                }\n            }\n            if (isExist) continue;\n            let child = cc.instantiate(demo);\n            child.configId = serverPack[i].configId;\n            child.configInfo = serverPack[i];\n            let roomNameStr = serverPack[i].configName;\n            if (typeof(roomNameStr) == \"undefined\" || roomNameStr == \"\") {\n                roomNameStr = app.ShareDefine().GametTypeID2Name[serverPack[i].gameId];\n            }\n            child.getChildByName(\"lb_roomName\").getComponent(cc.Label).string = roomNameStr;\n            child.getChildByName(\"lb_roomCount\").getComponent(cc.Label).string = serverPack[i].size;\n            child.getChildByName(\"scorePercentEditBox\").getComponent(cc.EditBox).string = serverPack[i].value.toString();\n            child.active = true;\n            content.addChild(child);\n        }\n    },\n    GetAllRoomListCfg:function(){\n        let roomScrollView = this.node.getChildByName(\"mark\");\n        let content = roomScrollView.getChildByName(\"layout\");\n        let list = [];\n        for (let i = 0; i < content.children.length; i++) {\n            let temp = {};\n            temp.configId = content.children[i].configId;\n            let scorePercentStr = content.children[i].getChildByName(\"scorePercentEditBox\").getComponent(cc.EditBox).string;\n            if (content.children[i].configInfo.value == parseFloat(scorePercentStr)) {\n                //没有修改不用上传\n                continue;\n            }\n            if (!isNaN(parseFloat(scorePercentStr)) && app.ComTool().StrIsNum(scorePercentStr) && parseFloat(scorePercentStr) >= 0) {\n                temp.value = parseFloat(scorePercentStr);\n                list.push(temp);\n            }else{\n                app.SysNotifyManager().ShowSysMsg(\"活跃计算值请输入大于等于0的数字\",[],3);\n                return [];\n            }\n        }\n        return list;\n    },\n    OnClick:function(btnName, btnNode){\n        if(btnName == \"btn_save\"){\n            let sendPack = {};\n            sendPack.clubId = this.clubId;\n            sendPack.pid = this.data.pid;\n            sendPack.promotionCalcActiveItemList = this.GetAllRoomListCfg();\n            if (sendPack.promotionCalcActiveItemList.length == 0) {\n                return;\n            }\n            let self = this;\n            app.NetManager().SendPack(\"club.CClubPromotionCalcActiveBatch\",sendPack, function(serverPack){\n                app.FormManager().GetFormComponentByFormName(\"ui/club/UIPromoterManager\").ClickLeftBtn(\"btn_PromoterList\");\n                app.SysNotifyManager().ShowSysMsg(\"保存成功\",[],3);\n                self.CloseForm();\n            }, function(){\n                // app.SysNotifyManager().ShowSysMsg(\"保存失败\",[],3);\n            });\n        }else if(btnName == \"btn_cancel\"){\n            this.CloseForm();\n        }else if(btnName == \"btn_close\"){\n            this.CloseForm();\n        }else{\n            this.ErrLog(\"OnClick(%s) not find\", btnName);\n        }\n    },\n\n});\n"]}