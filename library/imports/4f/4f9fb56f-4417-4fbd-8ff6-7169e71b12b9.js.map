{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\hotupdate/assets\\script\\hotupdate\\SubgameManager.js"],"names":["app","require","SubgameManager","_storagePath","UIRLFILE_root","_getfiles","name","type","downloadCallback","finishCallback","jsb","fileUtils","getWritablePath","_downloadCallback","_finishCallback","_fileName","length","Client","GetClientConfigProperty","UIRLFILE","files","console","log","customManifestStr","JSON","stringify","versionCompareHandle","versionA","versionB","vA","split","vB","i","a","parseInt","b","_am","AssetsManager","setVerifyCallback","path","asset","compressed","cc","sys","os","OS_ANDROID","setMaxConcurrentTask","setEventCallback","_updateCb","bind","_checkCb","_needUpdate","getState","State","UNINITED","manifest","Manifest","loadLocalManifest","update","_failCount","checkUpdate","_updating","event","failed","self","getMessage","getEventCode","EventAssetsManager","ERROR_NO_LOCAL_MANIFEST","ERROR_DOWNLOAD_MANIFEST","ERROR_PARSE_MANIFEST","NEW_VERSION_FOUND","ALREADY_UP_TO_DATE","UPDATE_PROGRESSION","getPercent","getDownloadedBytes","getTotalBytes","ASSET_UPDATED","ERROR_UPDATING","UPDATE_FINISHED","UPDATE_FAILED","downloadFailedAssets","ERROR_DECOMPRESS","downloadSubgame","progress","finish","enterSubgame","window","isSubgameDownLoad","isNative","file","isFileExist","needUpdateSubgame","isUpdateCallback","failCallback","module","exports"],"mappings":"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","file":"SubgameManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\hotupdate","sourcesContent":["var app = require(\"app\");\nconst SubgameManager = {\n    _storagePath: [],\n    UIRLFILE_root: \"\",//演示包\n\n    _getfiles: function(name, type, downloadCallback, finishCallback) {\n        this._storagePath[name] = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'ALLGame/' + name);\n        this._downloadCallback = downloadCallback;\n        this._finishCallback = finishCallback;\n        this._fileName = name;\n        if (this.UIRLFILE_root.length < 2) {\n            this.UIRLFILE_root = app.Client.GetClientConfigProperty(\"UpdateGame\")\n        }\n        var UIRLFILE = this.UIRLFILE_root + name + \"/remote-assets\";\n        var files = this._storagePath[name] + '/project.manifest';\n\n        console.log(\"SubgameManager._getfiles   UIRLFILE: \" + UIRLFILE);\n\n        var customManifestStr = JSON.stringify({\n            'packageUrl': UIRLFILE,\n            'remoteManifestUrl': UIRLFILE + '/project.manifest',\n            'remoteVersionUrl': UIRLFILE + '/version.manifest',\n            'version': '0.0.1',\n            'assets': {},\n            'searchPaths': []\n        });\n\n        var versionCompareHandle = function(versionA, versionB) {\n            var vA = versionA.split('.');\n            var vB = versionB.split('.');\n            for (var i = 0; i < vA.length; ++i) {\n                var a = parseInt(vA[i]);\n                var b = parseInt(vB[i] || 0);\n                if (a === b) {\n                    continue;\n                } else {\n                    return a - b;\n                }\n            }\n            if (vB.length > vA.length) {\n                return -1;\n            } else {\n                return 0;\n            }\n        };\n\n        this._am = new jsb.AssetsManager('', this._storagePath[name], versionCompareHandle);\n        this._am.setVerifyCallback(function(path, asset) {\n            var compressed = asset.compressed;\n            if (compressed) {\n                return true;\n            } else {\n                return true;\n            }\n        });\n\n\n        if (cc.sys.os === cc.sys.OS_ANDROID) {\n            this._am.setMaxConcurrentTask(2);\n        }\n\n        if (type === 1) {\n            this._am.setEventCallback(this._updateCb.bind(this));\n        } else if (type == 2) {\n            this._am.setEventCallback(this._checkCb.bind(this));\n        } else {\n            this._am.setEventCallback(this._needUpdate.bind(this));\n        }\n\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            var manifest = new jsb.Manifest(customManifestStr, this._storagePath[name]);\n            this._am.loadLocalManifest(manifest, this._storagePath[name]);\n        }\n\n        if (type === 1) {\n            this._am.update();\n            this._failCount = 0;\n        } else {\n            this._am.checkUpdate();\n        }\n        this._updating = true;\n        console.log('更新文件:' + files);\n    },\n\n    // type = 1\n    _updateCb: function(event) {\n        var failed = false;\n        let self = this;\n        console.log(\"gameUpdate UpdateCb event:\", event.getMessage());\n        console.log(\"gameUpdate UpdateCb event:\", event.getEventCode());\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                /*0 本地没有配置文件*/\n                cc.log('updateCb本地没有配置文件');\n                failed = true;\n                break;\n\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n                /*1下载配置文件错误*/\n                cc.log('updateCb下载配置文件错误');\n                failed = true;\n                break;\n\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                /*2 解析文件错误*/\n                cc.log('updateCb解析文件错误');\n                failed = true;\n                break;\n\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                /*3发现新的更新*/\n                cc.log('updateCb发现新的更新');\n                break;\n\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                /*4 已经是最新的*/\n                cc.log('updateCb已经是最新的');\n                failed = true;\n                break;\n\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                /*5 最新进展 */\n                self._downloadCallback && self._downloadCallback(event.getPercent(),event.getDownloadedBytes(),event.getTotalBytes());\n                break;\n\n\n            case jsb.EventAssetsManager.ASSET_UPDATED:\n                /*6需要更新*/\n                break;\n\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                /*7更新错误*/\n                cc.log('updateCb更新错误');\n                break;\n\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                /*8更新完成*/\n                self._finishCallback && self._finishCallback(true);\n                break;\n\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                /*9更新失败*/\n                self._failCount++;\n                if (self._failCount <= 3) {\n                    self._am.downloadFailedAssets();\n                    cc.log(('updateCb更新失败' + this._failCount + ' 次'));\n                } else {\n                    cc.log(('updateCb失败次数过多'));\n                    self._failCount = 0;\n                    failed = true;\n                    self._updating = false;\n                }\n                break;\n\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                /*10解压失败*/\n                cc.log('updateCb解压失败');\n                break;\n        }\n\n        if (failed) {\n            self._updating = false;\n            self._finishCallback && self._finishCallback(false);\n        }\n    },\n\n    // type = 2\n    _checkCb: function(event) {\n        var failed = false;\n        let self = this;\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                /*0 本地没有配置文件*/\n                cc.log('checkCb本地没有配置文件');\n                break;\n\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n                /*1下载配置文件错误*/\n                cc.log('checkCb下载配置文件错误');\n                failed = true;\n                break;\n\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                /*2 解析文件错误*/\n                cc.log('checkCb解析文件错误');\n                failed = true;\n                break;\n\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                /*3发现新的更新*/\n                self._getfiles(self._fileName, 1, self._downloadCallback, self._finishCallback);\n                break;\n\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                /*4 已经是最新的*/\n                cc.log('checkCb已经是最新的');\n                self._finishCallback && self._finishCallback(true);\n                break;\n\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                /*5 最新进展 */\n                break;\n\n            case jsb.EventAssetsManager.ASSET_UPDATED:\n                /*6需要更新*/\n                break;\n\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                /*7更新错误*/\n                cc.log('checkCb更新错误');\n                failed = true;\n                break;\n\n\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                /*8更新完成*/\n                cc.log('checkCb更新完成');\n                break;\n\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                /*9更新失败*/\n                cc.log('checkCb更新失败');\n                failed = true;\n                break;\n\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                /*10解压失败*/\n                cc.log('checkCb解压失败');\n                break;\n\n        }\n        this._updating = false;\n        if (failed) {\n            self._finishCallback && self._finishCallback(false);\n        }\n    },\n\n    // type = 3\n    _needUpdate: function(event) {\n        let self = this;\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                cc.log('子游戏已经是最新的，不需要更新');\n                self._finishCallback && self._finishCallback(false);\n                break;\n\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                cc.log('子游戏需要更新');\n                self._finishCallback && self._finishCallback(true);\n                break;\n\n            // 检查是否更新出错\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                self._downloadCallback();\n                break;\n        }\n    },\n\n    /**\n     * 下载子游戏\n     * @param {string} name - 游戏名\n     * @param progress - 下载进度回调\n     * @param finish - 完成回调\n     * @note finish 返回true表示下载成功，false表示下载失败\n     */\n    downloadSubgame: function(name, progress, finish) {\n        this._getfiles(name, 2, progress, finish);\n    },\n\n    /**\n     * 进入子游戏\n     * @param {string} name - 游戏名\n     */\n    enterSubgame: function(name) {\n        if (!this._storagePath[name]) {\n            this.downloadSubgame(name);\n            return;\n        }\n        console.log('enterSubgame ==== ' + this._storagePath[name]);\n        window.require(this._storagePath[name] + '/src/main.js');\n    },\n\n    /**\n     * 判断子游戏是否已经下载\n     * @param {string} name - 游戏名\n     */\n    isSubgameDownLoad: function (name) {\n        if (!cc.sys.isNative){\n            return;\n        }\n        let file = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'ALLGame/' + name + '/project.manifest';\n        if (jsb.fileUtils.isFileExist(file)) {\n            return true;\n        } else {\n            return false;\n        }\n    },\n\n    /**\n     * 判断子游戏是否需要更新\n     * @param {string} name - 游戏名\n     * @param isUpdateCallback - 是否需要更新回调\n     * @param failCallback - 错误回调\n     * @note isUpdateCallback 返回true表示需要更新，false表示不需要更新\n     */\n    needUpdateSubgame: function (name, isUpdateCallback, failCallback) {\n        if (typeof(app['isNeedCheckHotUpdate']) == \"undefined\" || app['isNeedCheckHotUpdate']) {\n            console.log(\"正常检测更新:\"+app['isNeedCheckHotUpdate']);\n            this._getfiles(name, 3, failCallback, isUpdateCallback);\n        }else{\n            console.log(\"无需检测更新:\"+app['isNeedCheckHotUpdate']);\n            isUpdateCallback(false);\n        }\n    },\n};\n\nmodule.exports = SubgameManager;"]}