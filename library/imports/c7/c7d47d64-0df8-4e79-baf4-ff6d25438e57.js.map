{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\HeroData/assets\\script\\dbmanager\\HeroData\\HeroManager.js"],"names":["app","require","HeroManager","BaseClass","extend","Init","JS_Name","SysDataManager","NetManager","ShareDefine","ComTool","selectCityConfig","GetTableDict","allSelectCityData","RegNetPack","OnPack_HeroProperty","OnReload","Log","dataInfo","heroID","InitLoginData","heroInfo","cc","sys","isNative","LocalDataManager","SetConfigProperty","localStorage","setItem","serverPack","count","length","index","property","SetHeroProperty","value","hasOwnProperty","ErrLog","argDict","Client","OnEvent","UpdateCity","cityId","GetHeroID","GetHeroInfo","GetHeroProperty","LogOutGame","GetCurSelectCityData","curType","curSelectData","county","city","province","push","g_HeroManager","exports","GetModel"],"mappings":"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","file":"HeroManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\HeroData","sourcesContent":["/*\n    玩家个人数据管理器\n*/\nvar app = require('app');\n\nvar HeroManager = app.BaseClass.extend({\n\n    Init:function(){\n    \tthis.JS_Name = \"HeroManager\";\n\n        let SysDataManager = app.SysDataManager();\n        this.NetManager = app.NetManager();\n        this.ShareDefine = app.ShareDefine();\n        this.ComTool = app.ComTool();\n\n        this.selectCityConfig = app.SysDataManager().GetTableDict(\"selectCity\");\n        this.allSelectCityData = [];\n\n        this.NetManager.RegNetPack(\"playerchanged\", this.OnPack_HeroProperty, this);\n\n        this.OnReload();\n\n    \tthis.Log(\"Init\");\n    },\n\n    //切换账号\n    OnReload:function(){\n        this.dataInfo = {};\n        this.heroID = 0;\n    },\n\n\n    //登陆初始化数据\n    InitLoginData:function(heroID, heroInfo){\n        this.dataInfo = heroInfo;\n        this.heroID = heroID;\n        //记录用户活跃度\n        if(!cc.sys.isNative){\n            heroInfo['vipExp']=0;\n        }\n        app.LocalDataManager().SetConfigProperty(\"Account\", \"AccountActive\",heroInfo['vipExp']);\n        if(heroInfo['cityId']){\n            //记录用户本地城市\n            cc.sys.localStorage.setItem(\"myCityID\",heroInfo['cityId']);\n        }\n    },\n\n    //-------------------封包函数--------------------------\n    //属性变化\n    OnPack_HeroProperty:function(serverPack){\n\n\t    let count = serverPack.length;\n\t    for(let index=0; index<count; index++){\n\t\t    let dataInfo = serverPack[index];\n\t\t    let property = dataInfo[\"name\"];\n\t\t    this.SetHeroProperty(property, dataInfo[\"value\"]);\n\t    }\n    },\n\n    //----------------设置接口---------------------------\n    //设置英雄属性\n    SetHeroProperty:function(property, value){\n        if(!this.dataInfo.hasOwnProperty(property)){\n            this.ErrLog(\"SetHeroProperty(%s,%s) error\", property, value);\n            return false\n        }\n        this.dataInfo[property] = value;\n\n        let argDict = {\n            \"Property\":property,\n            \"Value\":value,\n        };\n        app.Client.OnEvent(\"HeroProperty\", argDict);\n\n        return true\n    },\n    UpdateCity:function(cityId){\n        this.dataInfo[\"cityId\"]=cityId;\n    },\n    //----------------获取接口-----------------------------\n\n    //获取英雄ID\n    GetHeroID:function(){\n        return this.heroID;\n    },\n\n    GetHeroInfo:function(){\n        return this.dataInfo\n    },\n\n    //获取英雄属性值\n    GetHeroProperty:function(property){\n        if(!this.dataInfo.hasOwnProperty(property)){\n            this.ErrLog(\"GetHeroProperty(%s) error\", property);\n            if (\"cityId\" != property) {\n                app.Client.LogOutGame(1);\n            }\n            return;\n        }\n        return this.dataInfo[property];\n    },\n\n\n\n\n    //获取当前选择城市数据\n    GetCurSelectCityData:function(){\n        this.allSelectCityData = [];\n        let cityId = this.GetHeroProperty(\"cityId\");\n        if (cityId == 0 || cityId == null || typeof(cityId) == \"undefined\") {\n            return [];\n        }\n        if(typeof(this.selectCityConfig[cityId]) == \"undefined\" || this.selectCityConfig[cityId]==null || this.selectCityConfig[cityId]==\"\"){\n            return [];\n        }\n        if(typeof(this.selectCityConfig[cityId][\"Type\"]) == \"undefined\"){\n            return [];\n        }\n        let curType = this.selectCityConfig[cityId][\"Type\"];\n        let curSelectData = {\"selcetId\" : cityId};\n        if (curType == 1) {\n            //选择的是省\n            curSelectData.county = 0;\n            curSelectData.city = 0;\n            curSelectData.province = cityId;\n        }else if (curType == 2) {\n            //选择的是市\n            curSelectData.county = 0;\n            curSelectData.city = cityId;\n            curSelectData.province = this.selectCityConfig[cityId][\"Ascription\"];\n        }else{\n            //选择的是县\n            curSelectData.county = cityId;\n            curSelectData.city = this.selectCityConfig[cityId][\"Ascription\"];\n            curSelectData.province = this.selectCityConfig[curSelectData.city][\"Ascription\"];\n        }\n        this.allSelectCityData.push(curSelectData);\n        return this.allSelectCityData;\n    },\n\n    //随机角色名\n    // GetRandHeroName:function(){\n    //     let familyKeyList = Object.keys(this.FamilyName);\n    //     let nameKeyList = Object.keys(this.Name);\n\n    //     let familyName = this.FamilyName[this.ComTool.ListChoice(familyKeyList)][\"FamilyName\"];\n    //     let name = this.Name[this.ComTool.ListChoice(nameKeyList)][\"Name\"];\n\n    //     return [familyName, name].join(\"\");\n    // },\n\n    //-------------发包接口------------------------\n});\n\n\nvar g_HeroManager = null;\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n    if(!g_HeroManager){\n        g_HeroManager = new HeroManager();\n    }\n    return g_HeroManager;\n}"]}