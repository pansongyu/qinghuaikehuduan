{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\script\\ui\\uiGame\\ytmj/assets\\script\\ui\\uiGame\\ytmj\\ytmj_UIMJCard_ShowCard.js"],"names":["app","require","cc","Class","extends","properties","sp_in","Node","OnLoad","JS_Name","node","name","ComTool","SysDataManager","IntegrateImage","GetTableDict","ChildCount","HideAllChild","index","childName","StringAddNumSuffix","childNode","getChildByName","cardSprite","getComponent","Sprite","spriteFrame","ShowDownCard","cardIDList","handCard","jin1","jin2","imageString","ShowDownImg","ShowJinBg","cardID","room","RoomMgr","GetEnterRoom","roomSet","GetRoomSet","get_jin1","get_jin2","Math","floor","color","active","ShowAllDownCard","ErrLog","nodeParentName","parent","roomPosMgr","GetRoomPosMgr","pos","GameTyepStringUp","GetClientPos","GetClientDownPos","GetClientFacePos","GetClientUpPos","setPos","GetSetPosByPos","GetSetPosProperty","count","length","ShowImage","cardIndex","UserData","childSprite","imageName","join","imageInfo","Log","imagePath","that","ControlManager","CreateLoadPromise","SpriteFrame","then","catch","error","stack"],"mappings":"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","file":"ytmj_UIMJCard_ShowCard.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\script\\ui\\uiGame\\ytmj","sourcesContent":["/*\n UICard01-04 set结束摊牌\n */\n\nlet app = require(\"app\");\n\ncc.Class({\n\textends: require(\"BaseComponent\"),\n\n\tproperties: {\n\t\tsp_in:cc.Node,\n\t},\n\n\t// use this for initialization\n\tOnLoad: function () {\n\t\tthis.JS_Name = this.node.name + \"_UIMJCard_ShowCard\";\n\t\tthis.ComTool = app.ComTool();\n\t\tthis.SysDataManager = app.SysDataManager();\n\t\tthis.IntegrateImage = this.SysDataManager.GetTableDict(\"IntegrateImage\");\n\t\tthis.ChildCount = 16; //最多发16张牌\n\t\tthis.HideAllChild();\n\t},\n\n\tHideAllChild:function(){\n\t\tfor(let index=1; index <= this.ChildCount; index++){\n\t\t\tlet childName = this.ComTool.StringAddNumSuffix(\"card\", index, 2);\n\t\t\tlet childNode = this.node.getChildByName(childName);\n\t\t\tif(!childNode){\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tlet cardSprite = childNode.getComponent(cc.Sprite);\n\t\t\tcardSprite.spriteFrame = null;\n\t\t}\n\t\tthis.sp_in.getComponent(cc.Sprite).spriteFrame=null;\n\t},\n\tShowDownCard:function(cardIDList,handCard,jin1,jin2,imageString=\"EatCard_Self_\"){\n\t\tthis.ShowDownImg(cardIDList,handCard,imageString,jin1,jin2);\n\t},\n\tShowJinBg:function(cardID,childNode,jin1=0,jin2=0){\n\t\tif(jin1==0){\n\t\t\tlet room = this.RoomMgr.GetEnterRoom();\n\t\t\tlet roomSet = room.GetRoomSet();\n\t\t\tjin1=roomSet.get_jin1();\n\t\t\tjin2=roomSet.get_jin2();\n\t\t}\n\t\tif (Math.floor(cardID/100) == Math.floor(jin1/100) || Math.floor(cardID/100) == Math.floor(jin2/100)) {\n\t\t\tif (cardID != 0) {\n\t\t\t\tchildNode.color=cc.color(255,255,0);\n\t\t\t\tchildNode.getChildByName('da').active = true;\n\t\t\t} else {\n\t\t\t\tchildNode.color=cc.color(255,255,255);\n\t\t\t\tchildNode.getChildByName('da').active = false;\n\t\t\t}\n\t\t}else{\n\t\t\tchildNode.color=cc.color(255,255,255);\n\t\t\tchildNode.getChildByName('da').active = false;\n\t\t}\n\t},\n\t//显示底牌\n\tShowAllDownCard:function(){\n\t\tlet room = this.RoomMgr.GetEnterRoom();\n\t\tif(!room){\n\t\t\tthis.ErrLog(\"ShowAllDownCard not enter room\");\n\t\t\treturn\n\t\t}\n\t\t//UICard01\n\t\tlet nodeParentName = this.node.parent.name;\n\t\tlet roomPosMgr = room.GetRoomPosMgr();\n\t\tlet pos = 0;\n\t\t//需要获取当前本家位置ID\n\t\tlet imageString = \"\";\n\t\tif(nodeParentName == \"UI\"+this.GameTyepStringUp()+\"Card01\"){\n\t\t\tpos = roomPosMgr.GetClientPos();\n\t\t\timageString = \"EatCard_Self_\";\n\t\t}\n\t\telse if(nodeParentName == \"UI\"+this.GameTyepStringUp()+\"Card02\"){\n\t\t\tpos = roomPosMgr.GetClientDownPos();\n\t\t\timageString = \"EatCard_Down_\";\n\t\t}\n\t\telse if(nodeParentName == \"UI\"+this.GameTyepStringUp()+\"Card03\"){\n\t\t\tpos = roomPosMgr.GetClientFacePos();\n\t\t\timageString = \"EatCard_Self_\";\n\t\t}\n\t\telse{\n\t\t\tpos = roomPosMgr.GetClientUpPos();\n\t\t\timageString = \"EatCard_Up_\";\n\t\t}\n\t\tlet roomSet = room.GetRoomSet();\n\t\tlet setPos = roomSet.GetSetPosByPos(pos);\n\t\tif(!setPos){\n\t\t\tthis.ErrLog(\"ShowAllDownCard(%s) not find:%s\", nodeParentName, pos);\n\t\t\treturn\n\t\t}\n\t\tlet cardIDList = setPos.GetSetPosProperty(\"shouCard\");\n\t\tlet handCard = setPos.GetSetPosProperty(\"handCard\");\n\t\tthis.ShowDownImg(cardIDList,handCard,imageString,0,0);\n\t},\n\tShowDownImg:function(cardIDList,handCard=0,imageString,jin1=0,jin2=0){\n\t\tlet count=0;\n\t\tif(typeof(cardIDList)!=\"undefined\"){\n\t\t\tcount = cardIDList.length;\n\t\t}\n\t\tfor(let index=0; index<count; index++){\n\t\t\tlet cardID = cardIDList[index];\n\t\t\tlet childName = this.ComTool.StringAddNumSuffix(\"card\", index + 1, 2);\n\t\t\tlet childNode = this.node.getChildByName(childName);\n\t\t\tif(!childNode){\n\t\t\t\tthis.ErrLog(\"ShowAllDownCard not find childName:%s\", childName);\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tthis.ShowJinBg(cardID,childNode,jin1,jin2);\n\t\t\tchildNode.active = 1;\n\t\t\tthis.ShowImage(childNode, imageString, cardID,jin1,jin2);\n\t\t}\n\t\t//设置多余的卡牌位置空\n\t\tfor(let cardIndex=count+1; cardIndex <= this.ChildCount; cardIndex++){\n\t\t\tlet childName = this.ComTool.StringAddNumSuffix(\"card\", cardIndex, 2);\n\t\t\tlet childNode = this.node.getChildByName(childName);\n\t\t\tif(!childNode){\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tchildNode.active = 0;\n\t\t}\n\t\t//进卡不能控制显影只能设置空图片\n\t\tif (handCard > 0 && handCard != 5000) {\n\t\t\tthis.sp_in.active = true;\n\t\t\t// this.ShowJinBg(handCard, this.sp_in, jin1, jin2);\n\t\t\tthis.ShowImage(this.sp_in, imageString, handCard, jin1, jin2);\n\t\t\tif (Math.floor(handCard/100) == Math.floor(jin1/100) || Math.floor(handCard/100) == Math.floor(jin2/100)) {\n\t\t\t\tthis.sp_in.getChildByName('da').active = true;\n\t\t\t} else {\n\t\t\t\tthis.sp_in.getChildByName('da').active = false;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.sp_in.getComponent(cc.Sprite).spriteFrame = \"\";\n\t\t\tthis.sp_in.UserData = null;\n\t\t\tthis.sp_in.getChildByName('da').active = false;\n\t\t}\n\t},\n\tShowImage:function(childNode, imageString, cardID){\n\t\tlet childSprite = childNode.getComponent(cc.Sprite);\n\t\tif(!childSprite){\n\t\t\tthis.ErrLog(\"ShowOutCard(%s) not find cc.Sprite\", childNode.name);\n\t\t\treturn\n\t\t}\n\n\t\t//取卡牌ID的前2位\n\t\tlet imageName = [imageString, Math.floor(cardID/100)].join(\"\");\n\t\tlet imageInfo = this.IntegrateImage[imageName];\n\t\tif(!imageInfo){\n\t\t\tthis.ErrLog(\"fuck ShowImage IntegrateImage.txt not find:%s\", imageName);\n\t\t\treturn\n\t\t}\n\t\t//图片没有变化\n\t\tif(childNode.UserData == imageName){\n\n\t\t\tthis.Log(\"UserData:%s\", imageName);\n\t\t\treturn\n\t\t}\n\t\tlet imagePath = imageInfo[\"FilePath\"];\n\t\tif(app['majiang_'+imageName]){\n\t\t\tchildSprite.spriteFrame = app['majiang_'+imageName];\n\t\t\tchildNode.UserData = imageName;\n\t\t}else{\n\t\t\tlet that = this;\n\t\t\tapp.ControlManager().CreateLoadPromise(imagePath, cc.SpriteFrame)\n\t\t\t\t.then(function(spriteFrame){\n\t\t\t\t\tif(!spriteFrame){\n\t\t\t\t\t\tthat.ErrLog(\"OpenPoker(%s) load spriteFrame fail\", imagePath);\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\t//记录精灵图片对象\n\t\t\t\t\tchildSprite.spriteFrame = spriteFrame;\n\t\t\t\t\tchildNode.UserData = imageName;\n\t\t\t\t\tapp['majiang_' + imageName] = spriteFrame;\n\t\t\t\t})\n\t\t\t\t.catch(function(error){\n\t\t\t\t\tthat.ErrLog(\"OpenPoker(%s) error:%s\", imagePath, error.stack);\n\t\t\t\t});\n\t\t}\n\t},\n});"]}