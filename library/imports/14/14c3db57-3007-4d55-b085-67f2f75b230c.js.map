{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\ui\\club/assets\\script\\ui\\club\\UIClubStore.js"],"names":["app","require","cc","Class","extends","properties","right_layout","Node","quankaDemo","OnCreateInit","storeList","active","OnShow","nowCLubID","clubName","DestroyAllChildren","ClubManager","SendReqClubData","nowClubID","nowClubName","ShowStore","length","SendHttpRequest","ShowStoreData","i","nodePrefab","instantiate","AppID","name","getChildByName","getComponent","Label","string","DiamondNum","AppPrice","addChild","serverUrl","argString","requestType","sendPack","NetRequest","OnReceiveHttpPack","bind","OnConnectHttpFail","OnConnectHttpError","httpResText","serverPack","JSON","parse","data","push","id","money","roomcard","error","readyState","status","SetWaitForConfirm","msgID","type","msgArg","cbArg","ConfirmManager","SetWaitForConfirmForm","OnConFirm","ShowConfirm","clickType","backArgList","sys","openURL","HeroManager","GetHeroProperty","OnClick","btnName","btnNode","FormManager","ShowForm","startsWith","clubId","RefreshLeft","IsFormShow","CloseForm","ShareDefine","Confirm"],"mappings":"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","file":"UIClubStore.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\ui\\club","sourcesContent":["var app = require(\"app\");\ncc.Class({\n    extends: require(\"BaseForm\"),\n\n    properties: {\n        right_layout:cc.Node,\n        quankaDemo:cc.Node,\n\n        // store_icon:[cc.SpriteFrame],\n    },\n    OnCreateInit: function () {\n        this.storeList=[];\n        this.quankaDemo.active=false;\n    },\n    //-----------------显示函数------------------\n    OnShow: function (nowCLubID=-1,clubName='') {\n        this.quankaDemo.active=false;\n        //this.right_layout.removeAllChildren();\n        this.DestroyAllChildren(this.right_layout);\n        app.ClubManager().SendReqClubData();\n        //app.ClubManager().SendGetAllRoom();\n        if(nowCLubID>0){\n            this.nowClubID=nowCLubID;\n            this.nowClubName=clubName;\n            this.ShowStore();\n        }else{\n            this.nowClubID=-1;\n            this.nowClubName='';\n        }\n    },\n    ShowStore:function(){\n        if(this.storeList.length==0){\n            this.SendHttpRequest('http://fb.qicaiqh.com/index.php?module=WxPay&action=GetGoodsID', \"&gamename=qinghuai&goodstype=3\", \"GET\",{});\n        }else{\n            this.ShowStoreData();\n        }\n    },\n    ShowStoreData:function(){\n        //this.right_layout.removeAllChildren();\n        this.DestroyAllChildren(this.right_layout);\n        let storeList=this.storeList;\n        for(let i=0;i<storeList.length;i++){\n            let nodePrefab = cc.instantiate(this.quankaDemo);\n            nodePrefab.AppID=storeList[i].AppID;\n\n            nodePrefab.name='btn_store_buy';\n            nodePrefab.getChildByName('title').getComponent(cc.Label).string=storeList[i].DiamondNum+'张';\n            nodePrefab.getChildByName('num').getComponent(cc.Label).string=storeList[i].AppPrice + '元';\n            // nodePrefab.getChildByName('sendNum').getComponent(cc.Label).string=\"多送\";\n            // nodePrefab.getChildByName('icon').getComponent(cc.Sprite).spriteFrame=this.store_icon[i];\n            nodePrefab.active=true;\n\n            this.right_layout.addChild(nodePrefab);\n        }\n    },\n    SendHttpRequest:function(serverUrl, argString, requestType, sendPack){\n        app.NetRequest().SendHttpRequest(serverUrl, argString, requestType, sendPack, 2000, \n            this.OnReceiveHttpPack.bind(this), \n            this.OnConnectHttpFail.bind(this),\n            null,\n            this.OnConnectHttpError.bind(this),\n\t\t);\n        // var url = [serverUrl, argString].join(\"\")\n\n        // var dataStr = JSON.stringify(sendPack);\n\n        // //每次都实例化一个，否则会引起请求结束，实例被释放了\n        // var httpRequest = new XMLHttpRequest();\n\n        // httpRequest.timeout = 2000;\n\n\n        // httpRequest.open(requestType, url, true);\n        // //服务器json解码\n        // httpRequest.setRequestHeader(\"Content-Type\", \"application/json\");\n        // var that = this;\n        // httpRequest.onerror = function(){\n        //     that.ErrLog(\"httpRequest.error:%s\", url);\n        //     that.OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status);\n        // };\n        // httpRequest.ontimeout = function(){\n            \n        // };\n        // httpRequest.onreadystatechange = function(){\n        //     //执行成功\n        //     if (httpRequest.status == 200){\n        //         if(httpRequest.readyState == 4){\n        //             that.OnReceiveHttpPack(serverUrl, httpRequest.responseText);\n        //         }\n        //     }\n        //     else{\n        //         that.OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status);\n        //         that.ErrLog(\"onreadystatechange(%s,%s)\", httpRequest.readyState, httpRequest.status);\n        //     }\n        // };\n        // httpRequest.send(dataStr);\n\n    },\n     /*\n    *AppID  AppName AppPrice    DiamondNum  ExtraReward ImageName   goodsType   channelType\n       12     房卡     29          320000       3002    icon_card6       1           2\n    */\n    OnReceiveHttpPack:function(serverUrl, httpResText){\n        try{\n            let serverPack = JSON.parse(httpResText);\n            for(let i=0;i<serverPack.data.length;i++){\n                let data=serverPack.data[i];\n                let push=[];\n                push['AppID']=data.id;\n                push['AppName']='圈卡';\n                push['AppPrice']=data.money/100;\n                push['DiamondNum']=data.roomcard;\n                push['ImageName']='icon_card'+(i+1);\n                this.storeList.push(push);\n            }\n            this.ShowStoreData();\n        }\n        catch (error){\n            \n        }\n    },\n    OnConnectHttpFail:function(serverUrl, readyState, status){\n        \n    },\n    \n\n    /**\n     * 2次确认点击回调\n     * @param curEventType\n     * @param curArgList\n     */\n    SetWaitForConfirm:function(msgID,type,msgArg=[],cbArg=[]){\n        let ConfirmManager = app.ConfirmManager();\n        ConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, cbArg);\n        ConfirmManager.ShowConfirm(type, msgID, msgArg);\n    },\n    OnConFirm:function(clickType, msgID, backArgList){\n        if(clickType != \"Sure\"){\n            return\n        }\n        if('MSG_CLUB_Store' == msgID){\n            cc.sys.openURL(\"http://fb.qicaiqh.com/index.php?module=WxPay&action=MWEB_Pay&goodsID=\"+this.AppID+\"&playerID=\"+app.HeroManager().GetHeroProperty(\"pid\")+\"&clubId=\"+this.nowClubID);\n        }\n    },\n\n\n    OnClick:function(btnName, btnNode){\n        if('btn_join' == btnName){\n            this.FormManager.ShowForm('ui/club/UIJoinClub');\n        }else if(btnName.startsWith(\"btn_club_\")){\n            let clubId=btnNode.clubId;\n            this.nowClubID=clubId;\n            this.nowClubName=btnNode.clubName;\n            this.RefreshLeft();\n        }else if(btnName==\"btn_back\"){\n            if(this.FormManager.IsFormShow(\"ui/club/UIClubMain\")){\n                this.FormManager.CloseForm(\"bottom\");\n            }else{\n                this.FormManager.ShowForm(\"bottom\");\n            }\n            this.CloseForm();\n        }else if('btn_store_buy'==btnName){\n            this.AppID=btnNode.AppID;\n            this.SetWaitForConfirm(\"MSG_CLUB_Store\",this.ShareDefine.Confirm,[this.nowClubName]);\n        }\n    },\n});"]}