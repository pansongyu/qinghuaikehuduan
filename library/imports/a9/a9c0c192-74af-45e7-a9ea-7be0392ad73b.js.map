{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\script\\ui\\club\\promoterChildren/assets\\script\\ui\\club\\promoterChildren\\btn_PromoterXiaShuListNode.js"],"names":["app","require","cc","Class","extends","Component","properties","hehuoist_scrollView","ScrollView","hehuolist_layout","Node","hehuolist_demo","lb_search","EditBox","onLoad","Client","RegEvent","Event_ClubPromotionChange","event","ShowHeHuoList","InitData","clubId","unionId","unionPostType","myisminister","myisPartner","partnerPid","HeroManager","GetHeroID","ClubManager","Club_MINISTER_CREATER","node","getChildByName","active","memberPage","isSearch","self","lb_searchStr","ComTool","GetBeiZhuID","string","NetManager","SendPack","serverPack","length","DestroyAllChildren","i","instantiate","addChild","data","heroID","headImageUrl","getComponent","Label","GetBeiZhuName","name","GetPid","curActiveValue","WeChatHeadImage","WeChatManager","InitHeroHeadImage","OnLoad","ShowHeroHead","heroName","error","OnClick_BtnWnd","eventTouch","eventData","SoundManager","PlaySound","btnNode","currentTarget","btnName","OnClick","console","log","stack","FormManager","ShowForm","parent","ErrLog","SetWaitForConfirm","msgID","type","msgArg","cbArg","ConfirmManager","SetWaitForConfirmForm","OnConFirm","bind","ShowConfirm","clickType","backArgList","destroy","ShowSysMsg","children","child","removeFromParent"],"mappings":"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","file":"btn_PromoterXiaShuListNode.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\script\\ui\\club\\promoterChildren","sourcesContent":["var app = require(\"app\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        hehuoist_scrollView:cc.ScrollView,\n        hehuolist_layout:cc.Node,\n        hehuolist_demo:cc.Node,\n        lb_search:cc.EditBox,\n    },\n    onLoad:function(){\n        app.Client.RegEvent(\"OnClubPromotionChange\", this.Event_ClubPromotionChange, this);\n    },\n    Event_ClubPromotionChange:function(event){\n        this.ShowHeHuoList();\n    },\n    InitData:function (clubId, unionId, unionPostType, myisminister, myisPartner){\n        this.clubId = clubId;\n        this.unionId = unionId;\n        this.unionPostType = unionPostType;\n        this.partnerPid = app.HeroManager().GetHeroID();\n        this.myisminister = myisminister;\n        this.myisPartner = myisPartner;\n        //如果是创建者打开\n        if (this.myisminister == app.ClubManager().Club_MINISTER_CREATER) {\n            this.node.getChildByName(\"bottom\").getChildByName(\"btn_hehuo_yaoqing\").active = false;\n        }else{\n            this.node.getChildByName(\"bottom\").getChildByName(\"btn_hehuo_yaoqing\").active = true;\n        }\n        this.hehuolist_demo.active = false;\n        this.memberPage = 1;\n        this.ShowHeHuoList();\n    },\n\n    ShowHeHuoList:function(isSearch = false){\n        let self=this;\n        let lb_searchStr = \"\";\n        if (isSearch) {\n            lb_searchStr =app.ComTool().GetBeiZhuID(this.lb_search.string);\n        }\n        app.NetManager().SendPack('club.CClubSubordinateList',{'clubId':this.clubId,\"pageNum\":this.memberPage,\"query\":lb_searchStr},function(serverPack){\n            if (serverPack.length > 0) {\n                self.DestroyAllChildren(self.hehuolist_layout);\n            }\n            for(let i=0;i<serverPack.length;i++){\n                let node=cc.instantiate(self.hehuolist_demo);\n                node.active=true;\n                self.hehuolist_layout.addChild(node);\n \n                let data=serverPack[i];\n                let heroID = data[\"pid\"];\n                let headImageUrl = data[\"iconUrl\"];\n                node.getChildByName('name').getComponent(cc.Label).string=app.ComTool().GetBeiZhuName(heroID,data.name);\n                node.getChildByName('id').getComponent(cc.Label).string=app.ComTool().GetPid(heroID)\n                node.getChildByName('lb_active').getComponent(cc.Label).string=data.curActiveValue;\n                node.heroID=heroID;\n                let WeChatHeadImage = node.getChildByName('head').getComponent(\"WeChatHeadImage\");\n                 //用户头像创建\n                if(heroID && headImageUrl){\n                    app.WeChatManager().InitHeroHeadImage(heroID, headImageUrl);\n                }\n                WeChatHeadImage.OnLoad();\n                        WeChatHeadImage.ShowHeroHead(heroID,headImageUrl);\n\n                if (heroID == self.partnerPid) {\n                    node.getChildByName('btn_hehuo_xiugai').active = false;\n                }else{\n                    node.getChildByName('btn_hehuo_xiugai').active = true;\n                }\n\n                node.getChildByName('btn_hehuo_xiugai').heroID=heroID;\n                node.getChildByName('btn_hehuo_xiugai').heroName=data.name;\n            }\n        },function(error){\n\n        });\n    },\n    //控件点击回调\n    OnClick_BtnWnd:function(eventTouch, eventData){\n        try{\n            app.SoundManager().PlaySound(\"BtnClick\");\n            let btnNode = eventTouch.currentTarget;\n            let btnName = btnNode.name;\n            this.OnClick(btnName, btnNode);\n        }\n        catch (error){\n            console.log(\"OnClick_BtnWnd:\"+error.stack);\n        }\n    },\n    OnClick:function(btnName, btnNode){\n        if('btn_next'==btnName){\n            this.memberPage=this.memberPage+1;\n            this.ShowHeHuoList();\n        }else if('btn_last'==btnName){\n            if(this.memberPage<=1){\n                return;\n            }\n            this.memberPage=this.memberPage-1;\n            this.ShowHeHuoList();\n        }else if('btn_hehuo_xiugai'==btnName){\n            app.FormManager().ShowForm('ui/club/UIPromoterSet',this.clubId,btnNode.heroID,btnNode.heroName);\n        }else if('btn_hehuo_zhanji'==btnName){\n            app.FormManager().ShowForm('ui/club/UIPromoterRecordUser',this.clubId,btnNode.parent.heroID,this.partnerPid);\n        }else if ('btn_hehuo_yaoqing'==btnName) {\n            app.FormManager().ShowForm(\"ui/club/UIYaoQing\",this.clubId, this.partnerPid);\n        }else if ('btn_search'==btnName) {\n            this.memberPage=1;\n            this.ShowHeHuoList(true);\n        }else{\n            this.ErrLog(\"OnClick:%s not find\", btnName);\n        }\n    },\n\n    //---------点击函数---------------------\n    /**\n     * 2次确认点击回调\n     * @param curEventType\n     * @param curArgList\n     */\n    SetWaitForConfirm:function(msgID,type,msgArg=[],cbArg=[]){\n        let ConfirmManager = app.ConfirmManager();\n        ConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, cbArg);\n        ConfirmManager.ShowConfirm(type, msgID, msgArg);\n    },\n    OnConFirm:function(clickType, msgID, backArgList){\n        if(clickType != \"Sure\"){\n            return\n        }\n        let self = this;\n        if('MSG_CLUB_DelHeHuoXiaShu' == msgID){\n            let btnNode = backArgList[0];\n            //下属本家可以去除下属\n            app.NetManager().SendPack('club.CClubPartnerChange',{\"clubId\":this.clubId,'pid':btnNode.heroID,\"partnerPid\":0},function(serverPack){\n                btnNode.parent.destroy();\n            },function(error){\n                self.ShowSysMsg('删除失败，请联系亲友圈创建者');\n            });\n        }\n    },\n    //手动释放内存\n    DestroyAllChildren:function(node){\n        let i=node.children.length-1;\n        for(;i>=0;i--) {\n            let child=node.children[i];\n            child.removeFromParent();\n            child.destroy();\n        }\n    },\n});"]}