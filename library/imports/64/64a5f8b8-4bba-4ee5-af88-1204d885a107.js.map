{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\ui\\club/assets\\script\\ui\\club\\UIUserSetPercentDetail.js"],"names":["app","require","cc","Class","extends","properties","OnCreateInit","roomScrollView","node","getChildByName","getComponent","ScrollView","on","GetNextPage","OnShow","data","type","curPage","shareFixedValue","shareValue","GetScorePercentList","isRefresh","sendPack","ClubManager","GetUnionSendPackHead","opClubId","opPid","pageNum","self","NetManager","SendPack","serverPack","UpdateScrollView","SysNotifyManager","ShowSysMsg","content","scrollToTop","DestroyAllChildren","demo","active","i","length","isExist","j","children","configId","child","instantiate","configInfo","Label","string","configName","size","changeFlag","EditBox","scorePercent","toString","addChild","GetAllRoomListCfg","list","temp","scorePercentStr","parseFloat","push","OnClick","btnName","btnNode","unionScorePercentItemList","CloseForm","ErrLog"],"mappings":"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","file":"UIUserSetPercentDetail.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\ui\\club","sourcesContent":["var app = require(\"app\");\ncc.Class({\n    extends: require(\"BaseForm\"),\n\n    properties: {\n\n    },\n\n    OnCreateInit: function () {\n        let roomScrollView = this.node.getChildByName(\"mark\").getComponent(cc.ScrollView);\n        roomScrollView.node.on('scroll-to-bottom',this.GetNextPage,this);\n    },\n    OnShow: function (data, type) {\n        this.data = data;\n        this.curPage = 1;\n        this.type = type;\n        if (type == 1) {\n            this.shareFixedValue=data.shareFixedValue;\n            this.shareValue=0;\n        }else if (type == 0) {\n            this.shareValue=data.shareValue;\n            this.shareFixedValue=0;\n        }\n        this.GetScorePercentList(true);\n    },\n    GetNextPage:function(){\n        this.curPage++;\n        this.GetScorePercentList(false);\n    },\n    GetScorePercentList:function(isRefresh){\n        let sendPack = app.ClubManager().GetUnionSendPackHead();\n        sendPack.opClubId = this.data.opClubId;\n        sendPack.opPid = this.data.opPid;\n        sendPack.pageNum = this.curPage;\n        sendPack.type = this.type;\n        let self = this;\n        app.NetManager().SendPack(\"union.CUnionScorePercentList\",sendPack, function(serverPack){\n            self.UpdateScrollView(serverPack, isRefresh);\n        }, function(){\n            app.SysNotifyManager().ShowSysMsg(\"获取房间活跃计算列表失败\",[],3);\n        });\n    },\n    UpdateScrollView:function(serverPack, isRefresh){\n        let roomScrollView = this.node.getChildByName(\"mark\");\n        let content = roomScrollView.getChildByName(\"layout\");\n        if (isRefresh) {\n            roomScrollView.getComponent(cc.ScrollView).scrollToTop();\n            //content.removeAllChildren();\n            this.DestroyAllChildren(content);\n        }\n        let demo = this.node.getChildByName(\"demo\");\n        demo.active = false;\n        for (let i = 0; i < serverPack.length; i++) {\n            //先判断下是否已经存在\n            let isExist = false;\n            for (let j = 0; j < content.children.length; j++) {\n                if (content.children[j].configId == serverPack[i].configId) {\n                    isExist = true;\n                    break;\n                }\n            }\n            if (isExist) continue;\n            let child = cc.instantiate(demo);\n            child.configId = serverPack[i].configId;\n            child.configInfo = serverPack[i];\n            child.getChildByName(\"lb_roomName\").getComponent(cc.Label).string = serverPack[i].configName;\n            child.getChildByName(\"lb_roomCount\").getComponent(cc.Label).string = serverPack[i].size;\n            if(serverPack[i].changeFlag==true){\n                child.getChildByName(\"scorePercentEditBox\").getComponent(cc.EditBox).string = serverPack[i].scorePercent.toString();\n            }else{\n                if (this.type == 1) {\n                    child.getChildByName(\"scorePercentEditBox\").getComponent(cc.EditBox).string = this.shareFixedValue;\n                }else if (this.type == 0) {\n                    child.getChildByName(\"scorePercentEditBox\").getComponent(cc.EditBox).string = this.shareValue;\n                }\n            }\n\n            child.active = true;\n            content.addChild(child);\n        }\n    },\n    GetAllRoomListCfg:function(){\n        let roomScrollView = this.node.getChildByName(\"mark\");\n        let content = roomScrollView.getChildByName(\"layout\");\n        let list = [];\n        for (let i = 0; i < content.children.length; i++) {\n            let temp = {};\n            temp.configId = content.children[i].configId;\n            let scorePercentStr = content.children[i].getChildByName(\"scorePercentEditBox\").getComponent(cc.EditBox).string;\n            if (content.children[i].configInfo.scorePercent == parseFloat(scorePercentStr)) {\n                //没有修改不用上传\n                continue;\n            }\n            if (parseFloat(scorePercentStr) != null && parseFloat(scorePercentStr) >= 0) {\n                temp.scorePercent = parseFloat(scorePercentStr);\n                list.push(temp);\n            }else{\n                app.SysNotifyManager().ShowSysMsg(\"活跃计算值请输入大于等于0的数字\",[],3);\n                return [];\n            }\n        }\n        return list;\n    },\n    OnClick:function(btnName, btnNode){\n        if(btnName == \"btn_save\"){\n            let sendPack = app.ClubManager().GetUnionSendPackHead();\n            sendPack.opClubId = this.data.opClubId;\n            sendPack.opPid = this.data.opPid;\n            sendPack.type = this.type;\n            sendPack.unionScorePercentItemList = this.GetAllRoomListCfg();\n            if (sendPack.unionScorePercentItemList.length == 0) {\n                return;\n            }\n            let self = this;\n            app.NetManager().SendPack(\"union.CUnionScorePercentBatchUpdate\",sendPack, function(serverPack){\n                app.SysNotifyManager().ShowSysMsg(\"保存成功\",[],3);\n                self.CloseForm();\n            }, function(){\n                app.SysNotifyManager().ShowSysMsg(\"保存失败\",[],3);\n            });\n        }else if(btnName == \"btn_cancel\"){\n            this.CloseForm();\n        }else if(btnName == \"btn_close\"){\n            this.CloseForm();\n        }else{\n            this.ErrLog(\"OnClick(%s) not find\", btnName);\n        }\n    },\n\n});\n"]}