{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\common/assets\\script\\common\\LocationOnStartMgr.js"],"names":["app","require","LocationOnStartMgr","BaseClass","extend","extends","cc","Component","properties","Init","Log","JS_Name","GetLocation_Success","GetLocation_Error","isAllowCallLocation","SendGetLocation","isGetError","NetManager","SendPack","MyAddress","MyLatitudeEx","MyLongitudeEx","OnGetLocationCallBack","serverPack","console","log","toString","Client","OnEvent","SysLog","OnGetLocation","sys","isNative","SendDefaultLocation","that","setTimeout","NativeManager","CallToNative","num1","Math","floor","random","num2","GetLocationForBaiduMap","OnGetLocationForBaiduMapCallBack","g_LocationOnStartMgr","exports","GetModel"],"mappings":"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","file":"LocationOnStartMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/**\n * 定位服务类\n */\nvar app = require(\"app\");\n\nvar LocationOnStartMgr = app.BaseClass.extend({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    Init: function () {\n        this.Log(\"LocationOnStartMgr Init\");\n        this.JS_Name = \"LocationOnStartMgr\";\n        this.GetLocation_Success = 0;                        //获取位置成功\n        this.GetLocation_Error = 1;                        //获取位置失败\n        //this.isSendAddress=false;  //是否已经发送位置,3秒内只能发一次\n        this.isAllowCallLocation = false;  // 5秒内只能触发一次底层\n        // this.callCount = 0;\n    },\n    //发送请求玩家定位服务\n    SendGetLocation: function (isGetError) {\n        /*//启动5秒不发送机制\n        if(this.isSendAddress==true){\n            return;\n        }\n        this.isSendAddress=true;\n        let that=this;\n        setTimeout(function(){\n            that.isSendAddress = false;\n        },5000);*/\n        app.NetManager().SendPack(\"game.CGetLocationEx\", { \"Address\": this.MyAddress, \"Latitude\": this.MyLatitudeEx, \"Longitude\": this.MyLongitudeEx, \"isGetError\": isGetError });\n    },\n    //获取定位\n    OnGetLocationCallBack: function (serverPack) {\n        console.log(\"OnGetLocationCallBack LocationOnStartMgr serverPack:%s\", serverPack.toString());\n        let isGetError = false;\n        this.MyAddress = '';\n\n        // console.log(`>>>>>>>>>>location： 假定模拟高德定位失败！`);\n        // serverPack[\"state\"] = this.GetLocation_Error;\n\n        if (serverPack[\"state\"] == this.GetLocation_Error) {\n            console.log(\"定位失败\");\n            app.Client.OnEvent(\"EVT_DingWei\", { \"state\": 1 });\n            isGetError = true;\n            this.MyAddress = \"\";\n            this.MyLatitudeEx = 0;\n            this.MyLongitudeEx = 0;\n            this.SendGetLocation(isGetError);\n            // 高德定位失败, 调用百度定位。\n            console.log(`>>>>>>>>>> hall _NativeNotify： baiduMap start location！`);\n            //this.GetLocationForBaiduMap();\n            return;\n        }\n\n        console.log(\"定位成功\");\n        app.Client.OnEvent(\"EVT_DingWei\", { \"state\": 0 });\n        this.MyLatitudeEx = serverPack[\"Latitude\"];\n        this.MyLongitudeEx = serverPack[\"Longitude\"];\n        this.MyAddress = serverPack[\"City\"] + serverPack[\"District\"];\n        this.SysLog(\"OnGetLocationCallBack MyAddRess City:%s\", serverPack[\"City\"]);\n        this.SysLog(\"OnGetLocationCallBack MyAddRess District:%s\", serverPack[\"District\"]);\n        this.SysLog(\"OnGetLocationCallBack MyAddRess Street:%s\", serverPack[\"Street\"]);\n        this.SendGetLocation(isGetError);\n    },\n\n    //获取定位\n    OnGetLocation: function () {\n        console.log(\"OnGetLocation  00\");\n        if (!cc.sys.isNative) {\n            this.SendDefaultLocation();\n            return;\n        } else {\n            // 启动3秒机制\n            if (this.isAllowCallLocation == true) {\n                console.log(\"3秒内只能调用一次定位\");\n                return;\n            }\n\n            this.isAllowCallLocation = true;\n            let that = this;\n            setTimeout(function () {\n                that.isAllowCallLocation = false;\n            }, 3000);\n\n            // 记录调用次数\n            // if (!this.callCount) this.callCount = 0;\n            // console.log(\"OnGetLocation\", ++this.callCount);\n            // 定位\n            console.log(\"高德:OnGetLocation NativeManager\");\n            app.NativeManager().CallToNative(\"GetLocation\", []);\n        }\n    },\n\n    // 默认定位\n    SendDefaultLocation: function () {\n        var num1 = Math.floor(Math.random() * 10 + 1);\n        var num2 = Math.floor(Math.random() * 10 + 1);\n        //网页测试随机发送定位上去\n        let isGetError = false;\n        if (num1 > 9) {\n            //    isGetError = true;\n        }\n        this.MyAddress = \"福建省厦门市思明区软件园二期望海路35号\";\n        this.MyLatitudeEx = 24.48591905381944 + num1;\n        this.MyLongitudeEx = 118.1971853298611 - num2;\n        this.SendGetLocation(isGetError);\n    },\n\n    // ================= 百度地图 ==========================\n    //百度地图获取定位\n    GetLocationForBaiduMap: function () {\n        this.SysLog(\"GetLocationForBaiduMap  00\");\n        if (!cc.sys.isNative) {\n            this.SendDefaultLocation();\n            return;\n        } else {\n            return;//不使用百度地图\n            //手机调用gprs调用上去\n            app.NativeManager().CallToNative(\"GetLocationForBaiduMap\", []);\n        }\n    },\n\n    // 百度地图获取定位结果\n    OnGetLocationForBaiduMapCallBack: function (serverPack) {\n        this.SysLog(\"OnGetLocationForBaiduMapCallBack LocationOnStartMgr serverPack:%s\", serverPack.toString());\n        app.NativeManager().CallToNative(\"StopLocationForBaiduMap\", []);// 停止定位。\n        let isGetError = false;\n        this.MyAddress = '';\n        // :GETLOCATION,eventDataString:{\"state\":1,\"error\":\"\",\"mapType\":\"gaodeMap\",\"subGameName\":\"hall\"}\n        // {\"time\":\"2020-07-10 17:49:42\",\"locType\":62,\"locTypeDescription\":\"Location failed beacuse we can not get any loc information!\",// 百度定位失败（手机关闭定位）\n        // \"Latitude\":4.9E-324,\"Longitude\":4.9E-324,\"mapType\":\"baiduMap\",\"subGameName\":\"hall\"}\n\n        if (serverPack[\"state\"] == this.GetLocation_Error ||\n            serverPack[\"mapType\"] == \"baiduMap\" && typeof (serverPack[\"Address\"]) == \"undefined\") {// 百度定位失败（手机关闭定位）\n            app.Client.OnEvent(\"EVT_DingWei\", { \"state\": 1 });\n            isGetError = true;\n            this.MyAddress = \"\";\n            this.MyLatitudeEx = 0;\n            this.MyLongitudeEx = 0;\n            this.SendGetLocation(isGetError);\n            return;\n        }\n\n        app.Client.OnEvent(\"EVT_DingWei\", { \"state\": 0 });\n        this.MyLatitudeEx = serverPack[\"Latitude\"];\n        this.MyLongitudeEx = serverPack[\"Longitude\"];\n        this.MyAddress = serverPack[\"City\"] + serverPack[\"District\"];\n        this.SysLog(\"OnGetLocationForBaiduMapCallBack MyAddRess City:%s\", serverPack[\"City\"]);\n        this.SysLog(\"OnGetLocationForBaiduMapCallBack MyAddRess District:%s\", serverPack[\"District\"]);\n        this.SysLog(\"OnGetLocationForBaiduMapCallBack MyAddRess Street:%s\", serverPack[\"Street\"]);\n        this.SendGetLocation(isGetError);\n    }\n\n});\n\n\nvar g_LocationOnStartMgr = null;\n/**\n...\n*/\nexports.GetModel = function () {\n    if (!g_LocationOnStartMgr) {\n        g_LocationOnStartMgr = new LocationOnStartMgr();\n    }\n    return g_LocationOnStartMgr;\n}"]}