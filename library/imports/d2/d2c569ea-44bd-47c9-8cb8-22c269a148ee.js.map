{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\Family/assets\\script\\dbmanager\\Family\\FamilyManager.js"],"names":["app","require","FamilyManager","BaseClass","extend","Init","JS_Name","NetManager","OnReload","RegNetPack","OnPack_InitData","OnPack_FamilyNewBest","Log","dataInfo","familyContentInfo","messageList","thumbsUpList","ClearFamilyInfo","serverPack","publicCardListString","publicCardList","JSON","parse","error","ErrLog","stack","pid","headImageUrl","WeChatManager","InitHeroHeadImage","SendRequestFamilyContent","Client","OnEvent","OnPack_FamilyContent","messageInfoList","headImageDict","count","length","i","messageInfo","text","push","InitHeroHeadImageByDict","Update","SetFamilyProperty","property","value","hasOwnProperty","HavePlayerClickLikeNumber","HavePlayerClickLike","playerID","InArray","HavePlayerMessage","GetFamilyProperty","GetFamilyDataInfo","GetFamilyContentInfo","SendGetFamilyInfo","SendPack","SendAddFamilyContent","likeID","content","g_FamilyManager","exports","GetModel"],"mappings":"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","file":"FamilyManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\Family","sourcesContent":["/*\n FamilyManager 工会管理器\n */\nvar app = require('app');\n\nvar FamilyManager = app.BaseClass.extend({\n\n\tInit:function(){\n\t\tthis.JS_Name = \"FamilyManager\";\n\n\t\tthis.NetManager = app.NetManager();\n\n\t\tthis.OnReload();\n\n\t\tthis.NetManager.RegNetPack(\"family.C2117InitFamily\", this.OnPack_InitData, this);\n\n\t\t//评论初始化工会最佳留言\n\t\t//this.NetManager.RegNetPack(\"family.C2118AddFamilyContent\", this.OnPack_FamilyContent, this);\n\t\t//this.NetManager.RegNetPack(\"family.C2121InitFamilyContent\", this.OnPack_FamilyContent, this);\n\n\t\t//服务器推送\n\t\tthis.NetManager.RegNetPack(\"S2120_FamilyNewBest\", this.OnPack_FamilyNewBest, this);\n\n\t\tthis.Log(\"Init\");\n\t},\n\n\t//切换账号\n\tOnReload:function(){\n\n\t\t//{\n\t\t//\t\"familyID\":1000,\n\t\t//\t\"createTime\":1000,\n\t\t//\t...\n\t\t//}\n\t\tthis.dataInfo = {}\n\t\tthis.familyContentInfo = {}\n\n\t\tthis.messageList = [];\n\t\tthis.thumbsUpList = [];\n\t},\n\n\t//清除工会数据\n\tClearFamilyInfo:function(){\n\t\tthis.OnReload();\n\t},\n\n\t//------------封包函数------------------\n\tOnPack_InitData:function(serverPack){\n\n\t\tlet publicCardListString = serverPack[\"yDayPublicCardListString\"];\n\n\t\tlet publicCardList = [];\n\n\t\tif(publicCardListString){\n\t\t\ttry{\n\t\t\t\tpublicCardList = JSON.parse(publicCardListString);\n\t\t\t}\n\t\t\tcatch (error){\n\t\t\t\tthis.ErrLog(\"OnPack_InitData error:%s\", error.stack);\n\t\t\t\tpublicCardList = [];\n\t\t\t}\n\t\t}\n\n\t\tserverPack[\"yDayPublicCardList\"] = publicCardList;\n\t\tthis.dataInfo = serverPack;\n\n\t\tlet pid = serverPack[\"yDayPid\"];\n\t\tlet headImageUrl = serverPack[\"yDayHeadImageUrl\"];\n\t\tapp.WeChatManager().InitHeroHeadImage(pid, headImageUrl);\n\n\t\t//收到工会信息请求工会最佳留言\n\t\tthis.SendRequestFamilyContent();\n\n\t\tapp.Client.OnEvent(\"GetFamilyInfo\", {});\n\t},\n\n\tOnPack_FamilyContent:function(serverPack){\n        let messageInfoList = serverPack[\"messageInfoList\"];\n        this.messageList = [];\n        this.thumbsUpList = [];\n\t\tthis.familyContentInfo = {};\n\t\tlet headImageDict = {};\n\t\tif(messageInfoList!==\"\"){\n        let count = messageInfoList.length;\n        for(let i = 0; i < count; i++){\n\t        let messageInfo = messageInfoList[i];\n            let text = messageInfo[\"content\"];\n            let pid = messageInfo[\"pid\"];\n            let headImageUrl = messageInfo[\"headImageUrl\"];\n            if(text){\n                this.messageList.push(pid);\n            }\n            else{\n                this.thumbsUpList.push(pid);\n            }\n\n\t        this.familyContentInfo[messageInfo[\"keyID\"]] = messageInfo;\n\n\t        headImageDict[pid] = headImageUrl;\n        }\n    \t}\n\t\tapp.WeChatManager().InitHeroHeadImageByDict(headImageDict);\n\n\t\tapp.Client.OnEvent(\"FamilyContent\", {});\n\t},\n\n\tOnPack_FamilyNewBest:function(serverPack){\n\t\tif(this.dataInfo[\"familyID\"] != serverPack[\"familyID\"]){\n\t\t\tthis.ErrLog(\"OnPack_FamilyNewBest familyID error:\", serverPack);\n\t\t\treturn\n\t\t}\n\t\t//清空留言\n\t\tthis.familyContentInfo = {};\n\t\tthis.messageList = [];\n\t\tthis.thumbsUpList = [];\n\n\t\tlet publicCardListString = serverPack[\"yDayPublicCardListString\"];\n\t\tlet publicCardList = [];\n\t\tif(publicCardListString){\n\t\t\ttry{\n\t\t\t\tpublicCardList = JSON.parse(publicCardListString);\n\t\t\t}\n\t\t\tcatch (error){\n\t\t\t\tthis.ErrLog(\"OnPack_FamilyNewBest error:%s\", error.stack);\n\t\t\t\tpublicCardList = [];\n\t\t\t}\n\t\t}\n\t\tserverPack[\"yDayPublicCardList\"] = publicCardList;\n\n\t\tthis.dataInfo.Update(serverPack);\n\n\t\tlet pid = serverPack[\"yDayPid\"];\n\t\tlet headImageUrl = serverPack[\"yDayHeadImageUrl\"];\n\t\tapp.WeChatManager().InitHeroHeadImage(pid, headImageUrl);\n\n\t\tapp.Client.OnEvent(\"FamilyNewBest\", {});\n\t},\n    \n\t//-------------设置接口---------------------\n\tSetFamilyProperty:function(property, value){\n\t\tif(!this.dataInfo.hasOwnProperty(property)){\n\t\t\tthis.ErrLog(\"SetFamilyProperty not find:%s\",property);\n\t\t\treturn\n\t\t}\n\t\tthis.dataInfo[property] = value;\n\t},\n\t//--------------获取接口------------------------\n\t//获取点赞玩家人数\n    HavePlayerClickLikeNumber:function () {\n\t\treturn this.thumbsUpList.length;\n    },\n\n\tHavePlayerClickLike:function(playerID){\n\t\treturn this.thumbsUpList.InArray(playerID);\n\t},\n\n\tHavePlayerMessage:function(playerID){\n\t\treturn this.messageList.InArray(playerID);\n\t},\n\tGetFamilyProperty:function(property){\n\t\tif(!this.dataInfo.hasOwnProperty(property)){\n\t\t\tthis.ErrLog(\"GetFamilyProperty not find:%s\",property);\n\t\t\treturn\n\t\t}\n\t\treturn this.dataInfo[property];\n\t},\n\tGetFamilyDataInfo:function () {\n        return this.dataInfo;\n    },\n\n\t//获取工会留言\n\tGetFamilyContentInfo:function(){\n\t\treturn this.familyContentInfo\n\t},\n\n\t//---------------发包接口------------------------\n\n\n\t//获取工会数据\n\tSendGetFamilyInfo:function(){\n\t\t//this.NetManager.SendPack(\"family.C2117InitFamily\", {});\n\t},\n\n\tSendRequestFamilyContent:function(){\n\t\tthis.NetManager.SendPack(\"family.C2121InitFamilyContent\", {});\n\t},\n\n\t//发送留言\n\tSendAddFamilyContent:function(likeID, content){\n\t\tthis.NetManager.SendPack(\"family.C2118AddFamilyContent\", {\"likeID\":likeID, \"content\":content});\n\t},\n\n});\n\n\nvar g_FamilyManager = null;\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n\tif(!g_FamilyManager){\n\t\tg_FamilyManager = new FamilyManager();\n\t}\n\treturn g_FamilyManager;\n}"]}