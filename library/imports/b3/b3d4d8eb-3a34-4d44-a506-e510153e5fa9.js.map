{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\sdk/assets\\script\\sdk\\WeChatAppManager.js"],"names":["app","require","WeChatAppManager","BaseClass","extend","Init","JS_Name","ShareDefine","HeroAccountManager","NetManager","LocalDataManager","ComTool","dataInfo","OnReload","ReceivePrepayOrder","serverPack","prepayOrderInfo","argDict","argList","JSON","stringify","error","ErrLog","stack","SDKManager","CheckIsAppCheck","NativeManager","CallToNative","ProductID","Login","accessTokenInfo","GetConfigProperty","sdkToken","sdkAccountID","console","log","SendLoginByWeChatAuthorization","CheckLoginBySDK","ShareText","title","flag","Share","description","urlStr","ShareImage","imagePath","ShareScreen","shareType","cc","sys","isNative","filePath","Capture","GetSDKProperty","property","hasOwnProperty","GetSDK","OnNativeNotifyWXLogin","dataDict","errCode","code","IsDoLogining","SysLog","setTimeout","SysNotifyManager","ShowSysMsg","OnNativeNotifyWXShare","FormManager","CloseForm","isShow","IsFormShow","GetFormComponentByFormName","Event_ShareSuccess","Client","OnEvent","OnNativeNotifyWXPay","token","mpID","GetClientConfigProperty","LoginAccountBySDK","SDKType_WeChatApp","node","Node","parent","director","getScene","camera","addComponent","Camera","x","winSize","width","y","height","cullingMask","texture","RenderTexture","gl","game","_renderContext","initWithSize","STENCIL_INDEX8","targetTexture","render","data","readPixels","Math","floor","picData","Uint8Array","rowBytes","row","srow","start","reStart","i","CC_JSB","name","Date","now","jsb","fileUtils","getWritablePath","success","saveImageData","destroy","g_WeChatAppManager","exports","GetModel"],"mappings":";;;;;;AAAA;;;AAGA;;;AAGA,IAAIA,MAAMC,QAAQ,KAAR,CAAV;;AAEA,IAAIC,mBAAmBF,IAAIG,SAAJ,CAAcC,MAAd,CAAqB;AACxCC,OAAK,gBAAW;AACZ,OAAKC,OAAL,GAAe,kBAAf;;AAEA,OAAKC,WAAL,GAAmBP,IAAIO,WAAJ,EAAnB;AACA,OAAKC,kBAAL,GAA0BR,IAAIQ,kBAAJ,EAA1B;AACA,OAAKC,UAAL,GAAkBT,IAAIS,UAAJ,EAAlB;AACA,OAAKC,gBAAL,GAAwBV,IAAIU,gBAAJ,EAAxB;AACA,OAAKC,OAAL,GAAeX,IAAIW,OAAJ,EAAf;;AAEH,OAAKC,QAAL,GAAgB,EAAhB;;AAEA;AACA,EAbuC;;AAe3CC,WAAS,oBAAU,CAClB,CAhB0C;;AAkB3C;AACA;AACAC,qBAAmB,4BAASC,UAAT,EAAoB;AACtC,MAAIC,kBAAkBD,WAAW,iBAAX,CAAtB;;AAEA,MAAIE,UAAUD,gBAAgB,SAAhB,CAAd;AACA,MAAIE,UAAU,EAAd;AACA,MAAG;AACFA,aAAU,CAAC,EAAC,QAAO,WAAR,EAAqB,SAAQC,KAAKC,SAAL,CAAeH,OAAf,CAA7B,EAAD,CAAV;AACA,GAFD,CAEC,OAAOI,KAAP,EAAa;AACb,QAAKC,MAAL,CAAY,6BAAZ,EAA2CD,MAAME,KAAjD;AACA;AACA;AACD,MAAIvB,IAAIwB,UAAJ,GAAiBC,eAAjB,EAAJ,EAAyC;AACxCzB,OAAI0B,aAAJ,GAAoBC,YAApB,CAAiC,iBAAjC,EAAoD,CAAC,EAAC,QAAO,SAAR,EAAmB,SAAQX,gBAAgBY,SAAhB,GAA0B,CAArD,EAAD,CAApD;AACA,GAFD,MAEO;AACN5B,OAAI0B,aAAJ,GAAoBC,YAApB,CAAiC,aAAjC,EAAgDT,OAAhD;AACA;AACD,EApC0C;;AAsC3C;AACA;AACAW,QAAM,iBAAU;;AAEf;AACA,MAAIC,kBAAkB,KAAKpB,gBAAL,CAAsBqB,iBAAtB,CAAwC,SAAxC,EAAmD,iBAAnD,CAAtB;AACA,MAAIC,WAAW,EAAf;AACA,MAAIC,eAAe,CAAnB;AACA;AACA,MAAGH,eAAH,EAAmB;AAClBE,cAAWF,gBAAgB,UAAhB,CAAX;AACAG,kBAAeH,gBAAgB,WAAhB,CAAf;AACA;;AAED,MAAGG,gBAAgBD,QAAnB,EAA4B;AAC3B;AACAE,WAAQC,GAAR,CAAY,eAAZ;AACAD,WAAQC,GAAR,CAAY,0BAAZ,EAAwCF,YAAxC;AACA,QAAKG,8BAAL,CAAoCJ,QAApC,EAA8CC,YAA9C;AACA,GALD,MAMI;AACHC,WAAQC,GAAR,CAAY,qBAAZ;AACAnC,OAAI0B,aAAJ,GAAoBC,YAApB,CAAiC,eAAjC,EAAkD,EAAlD;AACA;AAED,EA/D0C;;AAiE3C;AACAU,kBAAgB,2BAAU;AACzB;AACA,MAAIP,kBAAkB,KAAKpB,gBAAL,CAAsBqB,iBAAtB,CAAwC,SAAxC,EAAmD,iBAAnD,CAAtB;AACA,MAAIC,WAAW,EAAf;AACA,MAAIC,eAAe,CAAnB;AACA;AACA,MAAGH,eAAH,EAAmB;AAClBE,cAAWF,gBAAgB,UAAhB,CAAX;AACAG,kBAAeH,gBAAgB,WAAhB,CAAf;AACA;;AAED,MAAGG,gBAAgBD,QAAnB,EAA4B;AAC3B,QAAKV,MAAL,CAAY,gDAAZ;AACA,UAAO,IAAP;AACA;AACD,OAAKA,MAAL,CAAY,oDAAZ;AACA,SAAO,KAAP;AACA,EAnF0C;AAoF3CgB,YAAU,mBAASC,KAAT,EAAeC,IAAf,EAAoB;AAC7B,MAAItB,UAAU,CAAC,EAAC,QAAO,MAAR,EAAe,SAAQqB,KAAvB,EAAD,EAA+B,EAAC,QAAO,MAAR,EAAe,SAAQC,IAAvB,EAA/B,CAAd;AACAxC,MAAI0B,aAAJ,GAAoBC,YAApB,CAAiC,mBAAjC,EAAqDT,OAArD;AACA,EAvF0C;AAwF3C;AACAuB,QAAM,eAASF,KAAT,EAAgBG,WAAhB,EAA6BC,MAA7B,EAAqCH,IAArC,EAA2CvB,OAA3C,EAAmD;AACxD,MAAG,CAACA,OAAJ,EAAY;AACXA,aAAU,EAAV;AACA;AACD,MAAIC,UAAU,CAAC,EAAC,QAAO,OAAR,EAAgB,SAAQqB,KAAxB,EAAD,EAAgC,EAAC,QAAO,aAAR,EAAsB,SAAQG,WAA9B,EAAhC,EAA2E,EAAC,QAAO,KAAR,EAAc,SAAQC,MAAtB,EAA3E,EAAyG,EAAC,QAAO,MAAR,EAAe,SAAQH,IAAvB,EAAzG,CAAd;AACAxC,MAAI0B,aAAJ,GAAoBC,YAApB,CAAiC,eAAjC,EAAkDT,OAAlD;AACA,EA/F0C;;AAiG3C0B,aAAW,oBAASC,SAAT,EAAoBL,IAApB,EAAyB;AACnC,MAAItB,UAAU,CAAC,EAAC,QAAO,WAAR,EAAoB,SAAQ2B,SAA5B,EAAD,EAAwC,EAAC,QAAO,MAAR,EAAe,SAAQL,IAAvB,EAAxC,CAAd;AACA;AACAxC,MAAI0B,aAAJ,GAAoBC,YAApB,CAAiC,oBAAjC,EAAuDT,OAAvD;AACA,EArG0C;;AAuG3C;AACA4B,cAAY,qBAASC,SAAT,EAAmB;AAC9B;AACA;AACA,MAAG,CAACA,SAAJ,EAAc;AACbA,eAAY,GAAZ;AACA;;AAED,MAAG,CAACC,GAAGC,GAAH,CAAOC,QAAX,EAAoB;AACnB,QAAK5B,MAAL,CAAY,wBAAZ;AACA;AACA;AACD,MAAI6B,WAAW,KAAKC,OAAL,EAAf;AACM,MAAID,YAAY,EAAhB,EAAoB;AACnB,QAAKP,UAAL,CAAgBO,QAAhB,EAA0BJ,SAA1B;AACA;AACP,EAvH0C;;AAyH3C;;AAEAM,iBAAe,wBAASC,QAAT,EAAkB;AAChC,MAAG,CAAC,KAAK1C,QAAL,CAAc2C,cAAd,CAA6BD,QAA7B,CAAJ,EAA2C;AAC1C,QAAKhC,MAAL,CAAY,qCAAZ,EAAmDgC,QAAnD;AACA;AACA;AACD,SAAO,KAAK1C,QAAL,CAAc0C,QAAd,CAAP;AACA,EAjI0C;;AAmI3CE,SAAO,kBAAU;AAChB,SAAO,EAAP;AACA,EArI0C;;AAuI3C;;AAEG;AACHC,wBAAsB,+BAASC,QAAT,EAAkB;AACjC,MAAIC,UAAUD,SAAS,SAAT,CAAd;;AAEN;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAGC,WAAW,CAAd,EAAgB;AACf,QAAK/C,QAAL,GAAgB8C,QAAhB;AACA,OAAIE,OAAO,KAAKhD,QAAL,CAAc,MAAd,CAAX;AACA,OAAG,CAACgD,IAAJ,EAAS;AACR,SAAKtC,MAAL,CAAY,+CAAZ,EAA6D,KAAKV,QAAlE;AACA,SAAKJ,kBAAL,CAAwBqD,YAAxB,CAAqC,KAArC;AACA;AACA;AACD3B,WAAQC,GAAR,CAAY,gBAAZ;AACA,QAAKC,8BAAL,CAAoCwB,IAApC,EAA0C,CAA1C;AACA,GAVD,MAWK,IAAGD,WAAW,CAAC,CAAf,EAAiB;AACrB,QAAKG,MAAL,CAAY,8BAAZ;AACAC,cAAW,YAAU;AACpB/D,QAAIgE,gBAAJ,GAAuBC,UAAvB,CAAkC,cAAlC,EAAkD,CAAC,QAAD,CAAlD;AACA,IAFD,EAEE,GAFF;;AAIA,QAAKzD,kBAAL,CAAwBqD,YAAxB,CAAqC,KAArC;AACA,GAPI,MAQD;AACH,QAAKvC,MAAL,CAAY,iCAAZ,EAA+CoC,QAA/C;AACAK,cAAW,YAAU;AACpB/D,QAAIgE,gBAAJ,GAAuBC,UAAvB,CAAkC,cAAlC,EAAkD,CAAC,QAAD,CAAlD;AACA,IAFD,EAEE,GAFF;;AAIA,QAAKzD,kBAAL,CAAwBqD,YAAxB,CAAqC,KAArC;AACA;AAEE,EAhLuC;;AAkLxC;AACAK,wBAAsB,+BAASR,QAAT,EAAkB;AACvCxB,UAAQC,GAAR,CAAY,wBAAZ,EAAqCuB,QAArC;AACA,OAAKI,MAAL,CAAY,oCAAkCJ,QAA9C;AACG,MAAIC,UAAUD,SAAS,SAAT,CAAd;AACH;AACA;AACA;AACA;AACA;AACA;AACA,OAAKI,MAAL,CAAY,mCAAiCH,OAA7C;AACA,MAAGA,WAAW,CAAd,EAAgB;AACZ;AACH;AACA3D,OAAImE,WAAJ,GAAkBC,SAAlB,CAA4B,0CAA5B;AACA,OAAIC,SAAOrE,IAAImE,WAAJ,GAAkBG,UAAlB,CAA6B,2CAA7B,CAAX;AACA,QAAKR,MAAL,CAAY,uDAAqDO,MAAjE;AACA,OAAGA,MAAH,EAAU;AACT,SAAKP,MAAL,CAAY,+DAAZ;AACA9D,QAAImE,WAAJ,GAAkBI,0BAAlB,CAA6C,2CAA7C,EAA0FC,kBAA1F,CAA6G,KAA7G;AACA;AACG;AACJxE,OAAIyE,MAAJ,CAAWC,OAAX,CAAmB,cAAnB,EAAkC,EAAlC;AACA1E,OAAIyE,MAAJ,CAAWC,OAAX,CAAmB,uBAAnB,EAA2C,EAA3C;AACA;AACD;AAdA,OAeK,IAAGf,WAAW,CAAC,CAAf,EAAiB;AACxB,SAAKG,MAAL,CAAY,8BAAZ;AACG,IAFI,MAGD;AACH,SAAKxC,MAAL,CAAY,wBAAZ,EAAsCoC,QAAtC;AACA1D,QAAIgE,gBAAJ,GAAuBC,UAAvB,CAAkC,cAAlC,EAAkD,CAAC,YAAYN,OAAb,CAAlD;AACA;AACD,EApNuC;;AAsNxC;AACAgB,sBAAoB,6BAASjB,QAAT,EAAkB;;AAElC,MAAIC,UAAUD,SAAS,SAAT,CAAd;AACH;AACA,MAAGC,WAAW,CAAd,EAAgB,CAEf,CAFD,MAGK,IAAGA,WAAW,CAAC,CAAf,EAAiB;AACrB,QAAKG,MAAL,CAAY,4BAAZ;AACA,GAFI,MAGD;AACH,QAAKxC,MAAL,CAAY,sBAAZ,EAAoCoC,QAApC;AACA1D,OAAIgE,gBAAJ,GAAuBC,UAAvB,CAAkC,cAAlC,EAAkD,CAAC,UAAUN,OAAX,CAAlD;AACA;AACD,EArOuC;;AAuOxC;AACH;AACGvB,iCAA+B,wCAASwC,KAAT,EAAgB3C,YAAhB,EAA6B;AAC3DC,UAAQC,GAAR,CAAY,UAAZ;AACA,MAAI0C,OAAO7E,IAAIyE,MAAJ,CAAWK,uBAAX,CAAmC,MAAnC,CAAX;AACA,MAAG,CAACD,IAAJ,EAAS;AACR,QAAKvD,MAAL,CAAY,8CAAZ;AACA;AACA;AACJY,UAAQC,GAAR,CAAY,gEAAZ;AACM,OAAK3B,kBAAL,CAAwBuE,iBAAxB,CAA0C,KAAKxE,WAAL,CAAiByE,iBAA3D,EAA8EJ,KAA9E,EAAqFC,IAArF,EAA2F5C,YAA3F;AACH,EAlPuC;;AAoPxC;AACAmB,UAAQ,mBAAU;AACjB,MAAI6B,OAAO,IAAIjC,GAAGkC,IAAP,EAAX;AACHD,OAAKE,MAAL,GAAcnC,GAAGoC,QAAH,CAAYC,QAAZ,EAAd;AACA,MAAIC,SAASL,KAAKM,YAAL,CAAkBvC,GAAGwC,MAArB,CAAb;;AAEAP,OAAKQ,CAAL,GAASzC,GAAG0C,OAAH,CAAWC,KAAX,GAAmB,CAA5B;AACAV,OAAKW,CAAL,GAAS5C,GAAG0C,OAAH,CAAWG,MAAX,GAAoB,CAA7B;;AAEA;AACAP,SAAOQ,WAAP,GAAqB,UAArB;;AAEA;AACA,MAAIC,UAAU,IAAI/C,GAAGgD,aAAP,EAAd;AACA,MAAIC,KAAKjD,GAAGkD,IAAH,CAAQC,cAAjB;AACA;AACAJ,UAAQK,YAAR,CAAqBpD,GAAG0C,OAAH,CAAWC,KAAhC,EAAuC3C,GAAG0C,OAAH,CAAWG,MAAlD,EAA0DI,GAAGI,cAA7D;AACAf,SAAOgB,aAAP,GAAuBP,OAAvB;;AAEA;AACAT,SAAOiB,MAAP;;AAEA;AACA,MAAIC,OAAOT,QAAQU,UAAR,EAAX;;AAEA;AACA,MAAId,QAAQe,KAAKC,KAAL,CAAW3D,GAAG0C,OAAH,CAAWC,KAAtB,CAAZ;AACM,MAAIE,SAASa,KAAKC,KAAL,CAAW3D,GAAG0C,OAAH,CAAWG,MAAtB,CAAb;AACA3D,UAAQC,GAAR,CAAY,eAAewD,KAAf,GAAuB,cAAvB,GAAwCE,MAApD;AACA,MAAIe,UAAU,IAAIC,UAAJ,CAAelB,QAAQE,MAAR,GAAiB,CAAhC,CAAd;AACA,MAAIiB,WAAWnB,QAAQ,CAAvB;AACA,OAAK,IAAIoB,MAAM,CAAf,EAAkBA,MAAMlB,MAAxB,EAAgCkB,KAAhC,EAAuC;AACnC,OAAIC,OAAOnB,SAAS,CAAT,GAAakB,GAAxB;AACA,OAAIE,QAAQP,KAAKC,KAAL,CAAWK,OAAOrB,KAAP,GAAe,CAA1B,CAAZ;AACA,OAAIuB,UAAUH,MAAMpB,KAAN,GAAc,CAA5B;AACA;AACA,QAAK,IAAIwB,IAAI,CAAb,EAAgBA,IAAIL,QAApB,EAA8BK,GAA9B,EAAmC;AAC/BP,YAAQM,UAAUC,CAAlB,IAAuBX,KAAKS,QAAQE,CAAb,CAAvB;AACH;AACJ;AACP;AACA,MAAIC,MAAJ,EAAY;AACX,OAAIC,OAASX,KAAKC,KAAL,CAAWW,KAAKC,GAAL,EAAX,IAA0B,MAAvC;AACA,OAAIpE,WAAWqE,IAAIC,SAAJ,CAAcC,eAAd,KAAkCL,IAAjD;AACA,OAAIM,UAAUH,IAAII,aAAJ,CAAkBhB,OAAlB,EAA2BjB,KAA3B,EAAkCE,MAAlC,EAA0C1C,QAA1C,CAAd;AACA8B,QAAK4C,OAAL;AACA,OAAIF,OAAJ,EAAa;AACHzF,YAAQC,GAAR,CAAY,0BAAZ,EAAuCgB,QAAvC;AACT,WAAOA,QAAP;AACM,IAHP,MAIW;AACDjB,YAAQC,GAAR,CAAY,yBAAZ;AACA,WAAO,EAAP;AACH;AACP;AACE;AA3SuC,CAArB,CAAvB;;AA+SA,IAAI2F,qBAAqB,IAAzB;;AAEA;;;AAGAC,QAAQC,QAAR,GAAmB,YAAU;AACzB,KAAG,CAACF,kBAAJ,EAAuB;AACnBA,uBAAqB,IAAI5H,gBAAJ,EAArB;AACH;AACD,QAAO4H,kBAAP;AACH,CALD","file":"WeChatAppManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\sdk","sourcesContent":["/**\n * Created by guoliangxuan on 2017/3/16.\n */\n/**\n * WeChatAppManager.js 微信appSDK.\n */\nvar app = require('app');\n\nvar WeChatAppManager = app.BaseClass.extend({\n    Init:function() {\n        this.JS_Name = \"WeChatAppManager\";\n\n        this.ShareDefine = app.ShareDefine();\n        this.HeroAccountManager = app.HeroAccountManager();\n        this.NetManager = app.NetManager();\n        this.LocalDataManager = app.LocalDataManager();\n        this.ComTool = app.ComTool();\n\n\t    this.dataInfo = {};\n\n\t    //this.OnReload();\n    },\n\n\tOnReload:function(){\n\t},\n\n\t//---------------接收函数-------------------\n\t//收到预订单信息\n\tReceivePrepayOrder:function(serverPack){\n\t\tlet prepayOrderInfo = serverPack[\"PrepayOrderInfo\"];\n\n\t\tlet argDict = prepayOrderInfo[\"ArgDict\"];\n\t\tlet argList = [];\n\t\ttry{\n\t\t\targList = [{\"Name\":\"OrderJson\", \"Value\":JSON.stringify(argDict)}];\n\t\t}catch (error){\n\t\t\tthis.ErrLog(\"ReceivePrepayOrder error:%s\", error.stack);\n\t\t\treturn\n\t\t}\n\t\tif (app.SDKManager().CheckIsAppCheck())  {\n\t\t\tapp.NativeManager().CallToNative(\"BuyAppStoreShop\", [{\"Name\":\"BuyType\", \"Value\":prepayOrderInfo.ProductID-1}]);\n\t\t} else {\n\t\t\tapp.NativeManager().CallToNative(\"OnWeChatPay\", argList);\n\t\t}\n\t},\n\n\t//------------调用接口---------------\n\t//微信授权\n\tLogin:function(){\n\n\t\t//如果本地缓存了accessToken\n\t\tlet accessTokenInfo = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccessTokenInfo\");\n\t\tlet sdkToken = \"\";\n\t\tlet sdkAccountID = 0;\n\t\t//直接登录服务器\n\t\tif(accessTokenInfo){\n\t\t\tsdkToken = accessTokenInfo[\"SDKToken\"];\n\t\t\tsdkAccountID = accessTokenInfo[\"AccountID\"];\n\t\t}\n\n\t\tif(sdkAccountID && sdkToken){\n\t\t\t//使用上次的授权缓存token\n\t\t\tconsole.log(\"缓存了token，直接验证\");\n\t\t\tconsole.log(\"WeChatAppManager Login: \", sdkAccountID);\n\t\t\tthis.SendLoginByWeChatAuthorization(sdkToken, sdkAccountID);\n\t\t}\n\t\telse{\n\t\t\tconsole.log(\"本地无微信token缓存,需要请求微信\");\n\t\t\tapp.NativeManager().CallToNative(\"OnWeChatLogin\", []);\n\t\t}\n\n\t},\n\n\t//检查登录是否是短线重登\n\tCheckLoginBySDK:function(){\n\t\t//如果本地缓存了accessToken\n\t\tlet accessTokenInfo = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccessTokenInfo\");\n\t\tlet sdkToken = \"\";\n\t\tlet sdkAccountID = 0;\n\t\t//直接登录服务器\n\t\tif(accessTokenInfo){\n\t\t\tsdkToken = accessTokenInfo[\"SDKToken\"];\n\t\t\tsdkAccountID = accessTokenInfo[\"AccountID\"];\n\t\t}\n\n\t\tif(sdkAccountID && sdkToken){\n\t\t\tthis.ErrLog(\"CheckLoginBySDK sdkaccountid and sdktoken have\");\n\t\t\treturn true;\n\t\t}\n\t\tthis.ErrLog(\"CheckLoginBySDK sdkaccountid and sdktoken not have\");\n\t\treturn false;\n\t},\n\tShareText:function(title,flag){\n\t\tlet argList = [{\"Name\":\"Text\",\"Value\":title},{\"Name\":\"Flag\",\"Value\":flag}];\n\t\tapp.NativeManager().CallToNative(\"OnWeChatShareText\",argList);\n\t},\n\t//微信分享\n\tShare:function(title, description, urlStr, flag, argDict){\n\t\tif(!argDict){\n\t\t\targDict = {};\n\t\t}\n\t\tlet argList = [{\"Name\":\"Title\",\"Value\":title},{\"Name\":\"Description\",\"Value\":description},{\"Name\":\"URL\",\"Value\":urlStr},{\"Name\":\"Type\",\"Value\":flag}];\n\t\tapp.NativeManager().CallToNative(\"OnWeChatShare\", argList);\n\t},\n\n\tShareImage:function(imagePath, flag){\n\t\tlet argList = [{\"Name\":\"ImagePath\",\"Value\":imagePath},{\"Name\":\"Type\",\"Value\":flag}];\n\t\t//app.NativeManager().CallToNative(\"OnWeChatShare\", argList);\n\t\tapp.NativeManager().CallToNative(\"OnWeChatShareImage\", argList);\n\t},\n\n\t//全屏分享(0:分享到微信好友，1：分享到微信朋友圈 shareType：字符串)\n\tShareScreen:function(shareType){\n\t\t//this.SysLog(\"ShareScreen  00000\");\n\t\t//默认发给朋友\n\t\tif(!shareType){\n\t\t\tshareType = \"0\";\n\t\t}\n\n\t\tif(!cc.sys.isNative){\n\t\t\tthis.ErrLog(\"ShareScreen not native\");\n\t\t\treturn\n\t\t}\n\t\tlet filePath = this.Capture();\n        if (filePath != \"\") {\n        \tthis.ShareImage(filePath, shareType);\n        }\n\t},\n\n\t//----------------获取接口------------------------\n\n\tGetSDKProperty:function(property){\n\t\tif(!this.dataInfo.hasOwnProperty(property)){\n\t\t\tthis.ErrLog(\"GetSDKProperty not find property:%s\", property);\n\t\t\treturn\n\t\t}\n\t\treturn this.dataInfo[property];\n\t},\n\n\tGetSDK:function(){\n\t\treturn {};\n\t},\n\n\t//--------------回调接口-----------------------------\n\n    //微信登录\n\tOnNativeNotifyWXLogin:function(dataDict){\n        let errCode = dataDict[\"ErrCode\"];\n\n\t\t//0:成功\n\t\t//-1:普通错误类型,\n\t\t//-2:用户点击取消并返回\n\t\t//-3:发送失败\n\t\t//-4:授权失败\n\t\t//-5:微信不支持\n\n\t\tif(errCode == 0){\n\t\t\tthis.dataInfo = dataDict;\n\t\t\tlet code = this.dataInfo[\"Code\"];\n\t\t\tif(!code){\n\t\t\t\tthis.ErrLog(\"SendLoginByWeChatAuthorization not find Code:\", this.dataInfo);\n\t\t\t\tthis.HeroAccountManager.IsDoLogining(false);\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconsole.log(\"授权了新token，直接验证\");\n\t\t\tthis.SendLoginByWeChatAuthorization(code, 0);\n\t\t}\n\t\telse if(errCode == -2){\n\t\t\tthis.SysLog(\"OnNativeNotifyWXLogin Cancel\");\n\t\t\tsetTimeout(function(){\n\t\t\t\tapp.SysNotifyManager().ShowSysMsg(\"CodeErrorMsg\", [\"微信授权失败\"]);\n\t\t\t},100);\n\t\t\t\n\t\t\tthis.HeroAccountManager.IsDoLogining(false);\n\t\t}\n\t\telse{\n\t\t\tthis.ErrLog(\"OnNativeNotifyWXLogin dataDict:\", dataDict);\n\t\t\tsetTimeout(function(){\n\t\t\t\tapp.SysNotifyManager().ShowSysMsg(\"CodeErrorMsg\", [\"微信授权失败\"]);\n\t\t\t},100);\n\t\t\t\n\t\t\tthis.HeroAccountManager.IsDoLogining(false);\n\t\t}\n\n    },\n\n    //微信分享\n    OnNativeNotifyWXShare:function(dataDict){\n    \tconsole.log(\"OnNativeNotifyWXShare:\",dataDict);\n    \tthis.SysLog(\"OnNativeNotifyWXShare dataDict:\"+dataDict);\n        let errCode = dataDict[\"ErrCode\"];\n\t    //0:分享成功\n\t    //-1:普通错误类型,\n\t    //-2:用户点击取消并返回\n\t    //-3:发送失败,\n\t    //-4:授权失败,\n\t    //-5:微信不支持,\n\t    this.SysLog(\"OnNativeNotifyWXShare errCode:\"+errCode);\n\t    if(errCode == 0){\n\t        //this.SysLog(\"OnNativeNotifyWXShare Request:CPlayerReceiveShare\");\n\t    \t//app.NetManager().SendPack(\"game.CPlayerReceiveShare\",{});\n\t    \tapp.FormManager().CloseForm('game/base/ui/majiang/UIMJSharePaiXingMax');\n\t    \tlet isShow=app.FormManager().IsFormShow('game/base/ui/majiang/UIMJSharePaiXingMini');\n\t    \tthis.SysLog(\"OnNativeNotifyWXShare UIMJSharePaiXingMini isShow:\"+isShow);\n\t    \tif(isShow){\n\t    \t\tthis.SysLog(\"OnNativeNotifyWXShare UIMJSharePaiXingMini Event_ShareSuccess\");\n\t    \t\tapp.FormManager().GetFormComponentByFormName(\"game/base/ui/majiang/UIMJSharePaiXingMini\").Event_ShareSuccess(false);\n\t    \t\treturn;\n        \t}\n\t    \tapp.Client.OnEvent(\"ShareSuccess\",\"\");\n\t    \tapp.Client.OnEvent(\"ChouJiangShareSuccess\",\"\"); \n\t    }\n\t    //用户点击取消并返回\n\t    else if(errCode == -2){\n\t\t\tthis.SysLog(\"OnNativeNotifyWXShare Cancel\");\n\t    }\n\t    else{\n\t\t    this.ErrLog(\"OnNativeNotifyWXShare:\", dataDict);\n\t\t    app.SysNotifyManager().ShowSysMsg(\"CodeErrorMsg\", [\"微信分享失败:\" + errCode]);\n\t    }\n    },\n\n    //微信支付\n    OnNativeNotifyWXPay:function(dataDict){\n\n        let errCode = dataDict[\"ErrCode\"];\n\t    //0:支付成功\n\t    if(errCode == 0){\n\n\t    }\n\t    else if(errCode == -2){\n\t\t    this.SysLog(\"OnNativeNotifyWXPay Cancel\");\n\t    }\n\t    else{\n\t\t    this.ErrLog(\"OnNativeNotifyWXPay:\", dataDict);\n\t\t    app.SysNotifyManager().ShowSysMsg(\"CodeErrorMsg\", [\"支付失败:\" + errCode]);\n\t    }\n    },\n\n    //----------------发包接口------------------------\n\t//发送授权登录\n    SendLoginByWeChatAuthorization:function(token, sdkAccountID){\n    \tconsole.log(\"开始发送授权登录\");\n\t    let mpID = app.Client.GetClientConfigProperty(\"MPID\");\n\t    if(!mpID){\n\t\t    this.ErrLog(\"SendLoginByWeChatAuthorization not find MPID\");\n\t\t    return\n\t    }\n\t\tconsole.log(\"WeChatAppManager SendLoginByWeChatAuthorization 11111111111111\");\n        this.HeroAccountManager.LoginAccountBySDK(this.ShareDefine.SDKType_WeChatApp, token, mpID, sdkAccountID);\n    },\n\n    //截屏保存方法\n    Capture:function(){\n    \tlet node = new cc.Node();\n\t\tnode.parent = cc.director.getScene();\n\t\tlet camera = node.addComponent(cc.Camera);\n\n\t\tnode.x = cc.winSize.width / 2;\n\t\tnode.y = cc.winSize.height / 2;\n\n\t\t// 设置你想要的截图内容的 cullingMask\n\t\tcamera.cullingMask = 0xffffffff;\n\n\t\t// 新建一个 RenderTexture，并且设置 camera 的 targetTexture 为新建的 RenderTexture，这样 camera 的内容将会渲染到新建的 RenderTexture 中。\n\t\tlet texture = new cc.RenderTexture();\n\t\tlet gl = cc.game._renderContext;\n\t\t// 如果截图内容中不包含 Mask 组件，可以不用传递第三个参数 gl.STENCIL_INDEX8\n\t\ttexture.initWithSize(cc.winSize.width, cc.winSize.height, gl.STENCIL_INDEX8);\n\t\tcamera.targetTexture = texture;\n\n\t\t// 渲染一次摄像机，即更新一次内容到 RenderTexture 中\n\t\tcamera.render();\n\n\t\t// 这样我们就能从 RenderTexture 中获取到数据了\n\t\tlet data = texture.readPixels();\n\n\t\t//以下代码将截图后默认倒置的图片回正\n\t\tlet width = Math.floor(cc.winSize.width);\n        let height = Math.floor(cc.winSize.height);\n        console.log(\"width === \" + width + \",height === \" + height);\n        let picData = new Uint8Array(width * height * 4);\n        let rowBytes = width * 4;\n        for (let row = 0; row < height; row++) {\n            let srow = height - 1 - row;\n            let start = Math.floor(srow * width * 4);\n            let reStart = row * width * 4;\n            // save the piexls data\n            for (let i = 0; i < rowBytes; i++) {\n                picData[reStart + i] = data[start + i];\n            }\n        }\n\t\t// 接下来就可以对这些数据进行操作了\n\t\tif (CC_JSB) {\n\t\t\tlet name =   Math.floor(Date.now())  + '.png';\n\t\t\tvar filePath = jsb.fileUtils.getWritablePath() + name;\n\t\t\tlet success = jsb.saveImageData(picData, width, height, filePath);\n\t\t\tnode.destroy();\n\t\t\tif (success) {\n\t            console.log(\"ShareScreen imagePath=%s\",filePath);\n\t\t\t\treturn filePath;\n\t        }\n\t        else {\n\t            console.log(\"save image data failed!\");\n\t            return \"\";\n\t        }\n\t\t}\n    },\n});\n\n\nvar g_WeChatAppManager = null;\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n    if(!g_WeChatAppManager){\n        g_WeChatAppManager = new WeChatAppManager();\n    }\n    return g_WeChatAppManager;\n};\n"]}