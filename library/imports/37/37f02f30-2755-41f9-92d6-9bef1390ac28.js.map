{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\ui/assets\\script\\ui\\UIShiMing.js"],"names":["app","require","cc","Class","extends","properties","EditBoxName","EditBox","EditBoxIDCard","btn_tijiao","Node","tip1","Label","tip2","layout","sp_tag","OnCreateInit","NetManager","RegNetPack","OnPack_ShiMing","HeroManager","AuthUrl","OnShow","appName","sys","localStorage","getItem","SysNotifyManager","ShowSysMsg","CloseForm","playerID","GetHeroProperty","realNumber","realName","active","Btn_tjjiao","name","string","idcard","length","WaitForConfirm","ShareDefine","ConfirmOK","isChn","isCardNo","date","Date","year","getFullYear","month","getMonth","day","getDate","signString","toString","sign","MD5","hex_md5","SendHttpRequest","encodeURI","OnReceiveHttpPack","serverUrl","httpResText","serverPack","JSON","parse","code","SendPack","error","OnConnectHttpFail","readyState","status","console","log","SetHeroProperty","card","reg","test","str","OnConFirm","clickType","msgID","backArgList"],"mappings":"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","file":"UIShiMing.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["var app = require(\"app\");\ncc.Class({\n    extends: require(\"BaseForm\"),\n\n    properties: {\n\t\tEditBoxName:cc.EditBox,\n\t\tEditBoxIDCard:cc.EditBox,\n\t\tbtn_tijiao:cc.Node,\n\t\ttip1:cc.Label,\n\t\ttip2:cc.Label,\n\t\tlayout:cc.Node,\n\t\tsp_tag:cc.Node,\n    },\n\n    OnCreateInit: function () {\n        this.NetManager = app.NetManager();\n        this.NetManager.RegNetPack(\"game.cplayerrealauthen\", this.OnPack_ShiMing, this);\n\t\tthis.HeroManager = app.HeroManager();\n\t\tthis.AuthUrl=\"http://qh.qinghuaimajiang.com/verify_id_name\";\n    },\n\n    OnShow: function () {\n    \tlet appName=cc.sys.localStorage.getItem('appName');\n        if (appName==\"baodao\") {\n        \tapp.SysNotifyManager().ShowSysMsg('实名未开启');\n            this.CloseForm();\n            return;\n        }\n\t\tthis.playerID = app.HeroManager().GetHeroProperty(\"pid\"); \n        let realNumber=app.HeroManager().GetHeroProperty(\"realNumber\"); \n        let realName=app.HeroManager().GetHeroProperty(\"realName\"); \n\t\tif(realNumber && realName){\n\t\t    this.layout.active = false;\n\t\t    this.btn_tijiao.active = false;\n\t\t    this.sp_tag.active = true;\n\t\t}else{\n\t\t\tthis.layout.active = true;\n\t\t    this.btn_tijiao.active = true;\n\t\t\tthis.sp_tag.active = false;\n\t\t}\n    },\n    Btn_tjjiao:function(){\n\t\tlet name=this.EditBoxName.string;\n\t\tlet idcard=this.EditBoxIDCard.string;\n\t\tif(name.length<2){\n\t\t\tthis.WaitForConfirm(\"UISHIMING_INFO_ERROR\", [], [], this.ShareDefine.ConfirmOK);\n\t    \t//this.tip1.string='*姓名输入错误';\n\t    \tthis.EditBoxName.string = \"\";\n\t\t\treturn;    \n\t\t}\n\t\tif(idcard.length<2){\n\t\t\tthis.WaitForConfirm(\"UISHIMING_INFO_ERROR\", [], [], this.ShareDefine.ConfirmOK);\n\t    \t//this.tip2.string='*身份证输入错误';\n\t    \tthis.EditBoxIDCard.string = \"\";\n\t\t\treturn;\n\t\t}\n\t\tif(this.isChn(name)===false){\n\t\t\tthis.WaitForConfirm(\"UISHIMING_INFO_ERROR\", [], [], this.ShareDefine.ConfirmOK);\n\t\t\t//this.tip1.string='*姓名输入错误';\n\t\t\tthis.EditBoxName.string = \"\";\n\t\t\treturn;\n\t\t}else{\n\t\t\tthis.tip1.string='';\n\t\t}\n\n\t\tif(this.isCardNo(idcard)===false){\n\t\t\tthis.WaitForConfirm(\"UISHIMING_INFO_ERROR\", [], [], this.ShareDefine.ConfirmOK);\n\t\t\t//this.tip2.string='*身份证输入错误';\n\t\t\tthis.EditBoxIDCard.string = \"\";\n\t\t\treturn;\n\t\t}else{\n\t\t\tthis.tip2.string='';\n\t\t}\n\n\t\t//找后台验证实名信息是否合法\n\t\tvar date = new Date();\n\t\tlet year=date.getFullYear();\n\t\tlet month=date.getMonth()+1;\n\t\tlet day=date.getDate();\n\t\tif(month<10){\n\t\t\tmonth=\"0\"+month;\n\t\t}\n\t\tif(day<10){\n\t\t\tday=\"0\"+day;\n\t\t}\n\n\t\tlet signString = idcard.toString() +this.playerID.toString()+\"wanzi\"+year.toString()+month.toString()+day.toString();\n        let sign = app.MD5.hex_md5(signString);\n\t\tthis.SendHttpRequest(this.AuthUrl, \"?is_number=\"+idcard+\"&name=\"+encodeURI(name)+\"&playerid=\"+this.playerID+\"&sign=\"+sign, \"GET\",{});\n\t\t//this.NetManager.SendPack(\"game.CPlayerRealAuthen\", {\"playerId\":this.playerID, \"realName\":name,\"realNumber\":idcard});\n\t\t\n\t},\n\tOnReceiveHttpPack:function(serverUrl, httpResText){\n        try{\n            let serverPack = JSON.parse(httpResText);\n            if(serverUrl==this.AuthUrl){\n               if(serverPack.code==200){\n               \t  //认证成功\n               \t  let name=this.EditBoxName.string;\n\t\t\t\t  let idcard=this.EditBoxIDCard.string;\n               \t  this.NetManager.SendPack(\"game.CPlayerRealAuthen\", {\"playerId\":this.playerID, \"realName\":name,\"realNumber\":idcard});\n               }else if(serverPack.code==300){\n               \t   this.ShowSysMsg(\"名字和身份号码不匹配\");\n               \t   return;\n               }else if(serverPack.code==301){\n               \t   this.ShowSysMsg(\"身份证号，姓名缺一不可\");\n               \t   return;\n               }else if(serverPack.code==302){\n               \t   this.ShowSysMsg(\"无效链接\");\n               \t   return;\n               }else if(serverPack.code==304){\n               \t   this.ShowSysMsg(httpResText);\n               \t   return;\n               }\n            }\n        }\n        catch (error){\n            \n        }\n    },\n    OnConnectHttpFail:function(serverUrl, readyState, status){\n        \n    },\n\tOnPack_ShiMing:function(serverPack){\n\t    console.log(\"OnPack_ShiMing:\",serverPack);\n\t    if(serverPack.realName && serverPack.realNumber){\n\t    \tapp.HeroManager().SetHeroProperty(\"realName\",serverPack.realName);\n\t    \tapp.HeroManager().SetHeroProperty(\"realNumber\",serverPack.realNumber);\n            this.WaitForConfirm(\"UISHIMING_SUCCESS\", [], [], this.ShareDefine.ConfirmOK);\n        }else{\n            this.WaitForConfirm(\"UISHIMING_FAIL\", [], [], this.ShareDefine.ConfirmOK);\n        }\n\t},\n\t\n\tisCardNo:function(card)  \n\t{  \n\t\tvar reg = /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/;  \n\t\tif(reg.test(card) === false){  \n\t\t\treturn  false;  \n\t\t}  \n\t\treturn true;\n\t},\n\tisChn:function(str){ \n\t\tvar reg = /^[\\u4E00-\\u9FA5]+$/; \n\t\tif(!reg.test(str)){ \n\t\t\treturn false; \n\t\t}\n\t\treturn true; \n\t},\n\n\tOnConFirm:function(clickType, msgID, backArgList){\n\n\t\tif(msgID == \"UISHIMING_SUCCESS\"){\n\t\t\tthis.btn_tijiao.active = false;\n            this.layout.active = false;\n            this.sp_tag.active = true;\n\t\t}\n\t\telse if(msgID == \"UISHIMING_FAIL\"){\n\t\t\tthis.EditBoxName.string = \"\";\n\t\t\tthis.EditBoxIDCard.string = \"\";\n\t\t}\n\t}\n\n});\n"]}