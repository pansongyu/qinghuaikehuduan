{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\ui/assets\\script\\ui\\FormManager.js"],"names":["app","require","FormManager","BaseClass","extend","Init","JS_Name","SysDataManager","SceneInfo","GetTableDict","HeroManager","ShareDefine","SysNotifyManager","loadFormDict","showFormDict","createingFormDict","formWndShowInfo","defaultFormNameList","isCloseFunButton","InitData","Log","formPath2RealPath","formPath","indexOf","formPath2formName","split","length","CreateForm","formName","that","ControlManager","CreateLoadPromise","then","prefab","hasOwnProperty","formNode","cc","instantiate","formComponent","getComponent","ErrLog","OnCreate","catch","error","stack","ShowForm","argList","bluebird","resolve","shift","name","Client","OnEvent","CloseFormReal","isDestory","CloseForm","CloseAllClubForm","ShowOrCloseForm","unshift","apply","GetFormComponentByFormName","IsFormShow","GetFormWndShowInfo","SetIsCloseFunButton","GetIsCloseFunButton","AddShowingForm","RemoveShowingForm","ShowFunWnd","node","wndInfo","heroLv","GetHeroProperty","passMaxTowerLv","wndPath","conditionInfo","wndParentPath","conditionType","conditionValue","showType","wndNode","find","wndParent","isOpen","FormWnd_NotShow","active","FormWnd_EffectLock","DeleteWndEffect","AddWndEffect","CheckFunButtonIsOpen","isNotify","ShowSysMsg","AddDefaultFormName","InArray","push","GetDefaultFormNameList","ClearDefaultFormNameList","OnBeforeExitScene","sceneName","isInArray","value","arrayList","i","LoadSceneDefaultForm","bluebirdList","loadFormNameList","NoAddScene","BaseForm","GamePrefab","gamePrefab","is3DShow","LocalDataManager","GetConfigProperty","count","index","all","OnSwithSceneEnd","_isOrientationH","frameSize","view","getFrameSize","width","height","g_FormManager","exports","GetModel"],"mappings":"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","file":"FormManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["/*\r\n    场景管理器\r\n*/\r\n\r\nvar app = require('app');\r\n\r\nvar FormManager = app.BaseClass.extend({\r\n\r\n    //初始化\r\n    Init:function(){\r\n        this.JS_Name = \"FormManager\";\r\n\r\n        let SysDataManager = app.SysDataManager();\r\n        this.SceneInfo = app.SysDataManager().GetTableDict(\"SceneInfo\");\r\n\r\n        this.HeroManager = app.HeroManager();\r\n        this.ShareDefine = app.ShareDefine();\r\n        this.SysNotifyManager = app.SysNotifyManager();\r\n\r\n        //已经创建的界面字典\r\n        this.loadFormDict = {};\r\n\r\n        this.showFormDict = {};\r\n\r\n        //正在执行创建的界面\r\n        this.createingFormDict = {};\r\n\r\n        //界面控件显示条件字典\r\n        // {\r\n        //     formName:{\r\n        //         wndPath:{\"WndParentPath\":\"\",\"WndPath\":\"aaa/btn01\"}\r\n        //     }\r\n        // }\r\n        this.formWndShowInfo = {};\r\n\r\n        //切换场景默认需要显示的界面\r\n        this.defaultFormNameList = [];\r\n\r\n        //是否关闭功能控制\r\n        this.isCloseFunButton = false;\r\n\r\n        this.InitData();\r\n\r\n        this.Log(\"Init\");\r\n    },\r\n\r\n    InitData:function(){\r\n\r\n        // for(let index in this.FormWndShowInfo){\r\n        //     let formWndShowInfo = this.FormWndShowInfo[index];\r\n        //     let formName = formWndShowInfo[\"FormName\"];\r\n        //     let wndPath = formWndShowInfo[\"WndPath\"];\r\n\r\n        //     let wndPathNameList = wndPath.split(\"/\");\r\n\r\n        //     let wndParentPath = \"\";\r\n\r\n        //     if(wndPathNameList.length == 1){\r\n        //         wndParentPath = \"\";\r\n        //     }\r\n        //     else{\r\n        //         wndParentPath = wndPathNameList.join(\"/\");\r\n        //     }\r\n\r\n        //     let wndInfo = this.formWndShowInfo.SetDefault(formName, {});\r\n        //     if(wndInfo.hasOwnProperty(wndPath)){\r\n        //         this.ErrLog(\"formWndShowInfo(%s) have find(%s)\", formName, wndPath);\r\n        //         continue\r\n        //     }\r\n        //     wndInfo[wndPath] = {\r\n        //                         \"ConditionType\":formWndShowInfo[\"ConditionType\"],\r\n        //                         \"ConditionValue\":formWndShowInfo[\"ConditionValue\"],\r\n        //                         \"ShowType\":formWndShowInfo[\"ShowType\"],\r\n        //                         \"WndParentPath\":wndParentPath,\r\n        //                     };\r\n        // }\r\n    },\r\n    formPath2RealPath:function(formPath){\r\n        if(formPath.indexOf('/')<1){\r\n            return 'ui/'+formPath;\r\n        }\r\n        return formPath;\r\n    },\r\n    formPath2formName:function(formPath){\r\n        if(formPath.indexOf('/')>-1){\r\n            let split=formPath.split('/');\r\n            return split[(split.length)-1];\r\n        }else{\r\n            return formPath;\r\n        }\r\n    },\r\n\r\n    //----------------操作接口--------------------\r\n\r\n    //创建界面\r\n    CreateForm:function(formPath){\r\n        formPath =this.formPath2RealPath(formPath);\r\n        let formName=this.formPath2formName(formPath);\r\n        // let formPath = \"\";\r\n\r\n        // let promise = null;\r\n        // for(let idx in this.folder){\r\n        //     formPath = this.folder[idx].folderPath + formName;\r\n        //     promise = app.ControlManager().CreateLoadPromise(formPath);\r\n        // }\r\n\r\n        let that = this;\r\n        return app.ControlManager().CreateLoadPromise(formPath)\r\n        .then(function(prefab){\r\n            if(that.loadFormDict.hasOwnProperty(formPath)){\r\n                that.Log(\"CreateForm(%s)重复创建界面\", formPath);\r\n                return that.loadFormDict[formPath];\r\n            }\r\n\r\n            let formNode = cc.instantiate(prefab);\r\n            let formComponent = formNode.getComponent(formName);\r\n            if(!formComponent){\r\n                that.ErrLog(\"CreateForm(%s) not find Component\", formName);\r\n                return\r\n            }\r\n            formComponent.OnCreate(formName);\r\n            that.loadFormDict[formPath] = formNode;\r\n            return formComponent\r\n            \r\n        })\r\n        .catch(function(error){\r\n            that.ErrLog(\"CreateForm(%s) error:%s\", formName, error.stack);\r\n        })\r\n    },\r\n    //显示界面\r\n    ShowForm:function(...argList){\r\n        if(!argList.length){\r\n            this.ErrLog(\"ShowForm Need FormName\");\r\n            return app.bluebird.resolve(null);\r\n        }\r\n        let formPath = argList.shift();\r\n        // console.error(\"formPath: \", formPath);\r\n        formPath =this.formPath2RealPath(formPath);\r\n        let formName=this.formPath2formName(formPath);\r\n        //如果已经加载过的界面,则设置界面显示\r\n        if(this.loadFormDict.hasOwnProperty(formPath)){\r\n            let formNode = this.loadFormDict[formPath];\r\n            if(!formNode){\r\n                this.ErrLog(\"ShowForm Error:formName %s\",formName);\r\n                return;\r\n            }\r\n            if(formNode.name!=\"\"){\r\n                let formComponent = formNode.getComponent(formName);\r\n                formComponent.ShowForm(argList);\r\n                return app.bluebird.resolve(formComponent);\r\n            }else{\r\n                delete this.loadFormDict[formPath];\r\n            }\r\n        }\r\n\r\n        //如果已经在创建中\r\n        if(this.createingFormDict.hasOwnProperty(formPath)){\r\n            this.ErrLog(\"ShowForm createingFormDict have find(%s)\",formName);\r\n            return app.bluebird.resolve(null);\r\n        }\r\n\r\n        this.createingFormDict[formPath] = 1;\r\n\r\n        let that = this;\r\n\r\n        app.Client.OnEvent(\"ModalLayer\", \"CreateForm\");\r\n\r\n        return this.CreateForm(formPath)\r\n                    .then(function(formComponent){\r\n\r\n                        delete that.createingFormDict[formPath];\r\n\r\n                        if(formComponent){\r\n                            formComponent.ShowForm(argList);\r\n                        }\r\n                        else{\r\n                            that.ErrLog(\"CreateForm(%s) fail\", formPath);\r\n                        }\r\n                        \r\n                        app.Client.OnEvent(\"ModalLayer\", \"CreateFormEnd\");\r\n\r\n                        return formComponent\r\n                    })\r\n                    .catch(function(error){\r\n                        that.ErrLog(\"ShowForm error:%s\", error.stack);\r\n                        app.Client.OnEvent(\"ModalLayer\", \"CreateFormEnd\");\r\n                    })\r\n\r\n    },\r\n    CloseFormReal:function(formPath,isDestory=false){\r\n        this.CloseForm(formPath,isDestory);\r\n        delete this.loadFormDict[formPath];\r\n    },\r\n    //关闭界面\r\n    CloseForm:function(formPath,isDestory=false){\r\n        formPath =this.formPath2RealPath(formPath);\r\n        let formName=this.formPath2formName(formPath);\r\n        if(!this.loadFormDict.hasOwnProperty(formPath)){\r\n            this.Log(\"CloseForm(%s) not load\", formPath);\r\n            return\r\n        }\r\n        let formNode = this.loadFormDict[formPath];\r\n        if(!formNode){\r\n            this.ErrLog(\"CloseForm Error:formName %s\",formPath);\r\n            return;\r\n        }\r\n        if(formNode.name==\"\"){\r\n            delete this.loadFormDict[formPath];\r\n            return;\r\n        }\r\n        try {\r\n            let formComponent = formNode.getComponent(formName);\r\n            if(formComponent){\r\n                formComponent.CloseForm(isDestory);\r\n            }\r\n            else{\r\n                this.ErrLog(\"CloseForm Error:formName %s,nodeName %s\",formName,formNode.name);\r\n            }\r\n        } catch(error) {\r\n            this.ErrLog(\"CloseForm Error:formName %s,nodeName %s formPath %s\",formName,formNode.name,formPath);\r\n        }\r\n    },\r\n\r\n    //关闭所有亲友圈相关界面\r\n    CloseAllClubForm:function(){\r\n        for (let formPath in this.loadFormDict) {\r\n            if (formPath.indexOf(\"club\") != -1) {\r\n                this.CloseForm(formPath);\r\n            }\r\n        }\r\n    },\r\n\r\n    //开启和关闭界面\r\n    ShowOrCloseForm:function(...argList){\r\n        if(!argList.length){\r\n            this.ErrLog(\"ShowOrCloseForm Need FormName\");\r\n            return false\r\n        }\r\n        let formPath = argList.shift();\r\n        formPath =this.formPath2RealPath(formPath);\r\n        let formName=this.formPath2formName(formPath);\r\n        if(!this.loadFormDict.hasOwnProperty(formPath)){\r\n            argList.unshift(formPath)\r\n            //调用更新界面函数\r\n            this.ShowForm.apply(this, argList);\r\n            return true\r\n        }\r\n        let formNode = this.loadFormDict[formPath];\r\n        let formComponent = formNode.getComponent(formName);\r\n        formComponent.ShowOrCloseForm(argList);        \r\n    },\r\n    //获取界面字典里的指定名字对象的同名脚本\r\n    GetFormComponentByFormName:function(formPath){\r\n        formPath =this.formPath2RealPath(formPath);\r\n        let formName=this.formPath2formName(formPath);\r\n        if(!this.loadFormDict.hasOwnProperty(formPath)){\r\n            this.Log(\"GetFormComponentByFormName(%s) not load\", formPath);\r\n            return\r\n        }\r\n        return this.loadFormDict[formPath].getComponent(formName);\r\n    },\r\n\r\n    //界面是否显示中\r\n    IsFormShow:function(formPath){\r\n        formPath =this.formPath2RealPath(formPath);\r\n        let formName=this.formPath2formName(formPath);\r\n        if(!this.loadFormDict.hasOwnProperty(formPath)){\r\n            this.Log(\"IsFormShow(%s) not load\", formPath);\r\n            return false\r\n        }\r\n        return this.loadFormDict[formPath].getComponent(formName).IsFormShow();\r\n    },\r\n\r\n    //获取界面控件显示条件字典\r\n    GetFormWndShowInfo:function(formPath){\r\n        formPath =this.formPath2RealPath(formPath);\r\n        let formName=this.formPath2formName(formPath);\r\n        if(this.isCloseFunButton){\r\n            return {}\r\n        }\r\n\r\n        if(!this.formWndShowInfo.hasOwnProperty(formPath)){\r\n            this.Log(\"GetFormWndShowInfo not find:%s\", formPath);\r\n            return {}\r\n        }\r\n        return this.formWndShowInfo[formPath];\r\n    },\r\n\r\n\r\n\r\n    SetIsCloseFunButton:function(){\r\n        this.isCloseFunButton = !this.isCloseFunButton\r\n    },\r\n\r\n    GetIsCloseFunButton:function(){\r\n        return this.isCloseFunButton\r\n    },\r\n    \r\n    AddShowingForm:function(formPath, formComponent){\r\n        formPath =this.formPath2RealPath(formPath);\r\n        this.showFormDict[formPath] = formComponent;\r\n    },\r\n\r\n    RemoveShowingForm:function(formPath){\r\n        formPath =this.formPath2RealPath(formPath);\r\n        delete this.showFormDict[formPath];\r\n    },\r\n\r\n    //显示界面控件功能函数\r\n    ShowFunWnd:function(formPath){\r\n        formPath =this.formPath2RealPath(formPath);\r\n        formName=this.formPath2formName(formPath);\r\n        let formComponent = this.GetFormComponentByFormName(formName);\r\n        if(!formComponent){\r\n            this.ErrLog(\"ShowFunWnd(%s) not find\");\r\n            return\r\n        }\r\n        let node = formComponent.node;\r\n\r\n        let wndInfo = this.GetFormWndShowInfo(formPath);\r\n        let heroLv = this.HeroManager.GetHeroProperty(\"lv\");\r\n        let passMaxTowerLv = 0;\r\n\r\n        for(let wndPath in wndInfo){\r\n\r\n            let conditionInfo = wndInfo[wndPath];\r\n\r\n            let wndParentPath = conditionInfo[\"WndParentPath\"];\r\n            let conditionType = conditionInfo[\"ConditionType\"];\r\n            let conditionValue = conditionInfo[\"ConditionValue\"];\r\n            let showType = conditionInfo[\"ShowType\"];\r\n\r\n            let wndNode = cc.find(wndPath, node);\r\n            if(!wndNode){\r\n                this.ErrLog(\"ShowFunWnd not find:%s\", wndPath);\r\n                continue\r\n            }\r\n\r\n            let wndParent = \"\";\r\n            if(!wndParentPath){\r\n                wndParent = node;\r\n            }\r\n            else{\r\n                wndParent = cc.find(wndParentPath, node);\r\n                if(!wndParent){\r\n                    this.ErrLog(\"ShowFunWnd(%s) not find\", wndParentPath);\r\n                    continue\r\n                }\r\n            }\r\n\r\n            let isOpen = false;\r\n\r\n            if(conditionType == \"HeroLv\"){\r\n                if(heroLv >= conditionValue){\r\n                    isOpen = true;\r\n                }\r\n                else{\r\n                    isOpen = false;\r\n                }\r\n            }\r\n            else if(conditionType == \"PassMaxTowerLv\"){\r\n                if(passMaxTowerLv >= conditionValue){\r\n                    isOpen = true;\r\n                }\r\n                else{\r\n                    isOpen = false;\r\n                }\r\n            }\r\n            else{\r\n                isOpen = false\r\n            }\r\n            \r\n            if(isOpen){\r\n\r\n                if(showType == this.ShareDefine.FormWnd_NotShow){\r\n                    wndNode.active = true;\r\n                }\r\n                else if(showType == this.ShareDefine.FormWnd_EffectLock){\r\n                    formComponent.DeleteWndEffect(wndPath, \"FunLock\");\r\n                }\r\n                else{\r\n                    this.ErrLog(\"wndPath(%s) showType:%s error\", wndPath, showType);\r\n                }\r\n            }\r\n            else{\r\n                if(showType == this.ShareDefine.FormWnd_NotShow){\r\n                    wndNode.active = false;\r\n                }\r\n                else if(showType == this.ShareDefine.FormWnd_EffectLock){\r\n                    formComponent.AddWndEffect(wndPath, \"FunLock\", \"Lock\");\r\n                }\r\n                else{\r\n                    this.ErrLog(\"wndPath(%s) showType:%s error\", wndPath, showType);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    CheckFunButtonIsOpen:function(formPath, wndPath, isNotify=true){\r\n        formPath =this.formPath2RealPath(formPath);\r\n        let formName=this.formPath2formName(formPath);\r\n        let wndInfo = this.GetFormWndShowInfo(formPath);\r\n        if(!wndInfo.hasOwnProperty(wndPath)){\r\n            return true\r\n        }\r\n        let conditionType = wndInfo[wndPath][\"ConditionType\"];\r\n        let conditionValue = wndInfo[wndPath][\"ConditionValue\"];\r\n\r\n        let heroLv = this.HeroManager.GetHeroProperty(\"lv\");\r\n        let passMaxTowerLv = 0;\r\n\r\n        if(conditionType == \"PassMaxTowerLv\"){\r\n            if(passMaxTowerLv >= conditionValue){\r\n                return true\r\n            }\r\n            if(isNotify){\r\n                this.SysNotifyManager.ShowSysMsg(\"FunBtnNotOpen_PassMaxTowerLv\", [conditionValue-1]);\r\n            }\r\n            return false\r\n        }\r\n        else if(conditionType == \"HeroLv\"){\r\n            if(heroLv >= conditionValue){\r\n                return true\r\n            }\r\n            if(isNotify){\r\n                this.SysNotifyManager.ShowSysMsg(\"FunBtnNotOpen_HeroLv\", [conditionValue]);\r\n            }\r\n            return false\r\n        }\r\n        else{\r\n            this.ErrLog(\"CheckFunButtonIsOpen(%s) conditionType:%s error\", wndPath, conditionType);\r\n            return false\r\n        }\r\n    },\r\n\r\n    //增加默认显示的界面\r\n    AddDefaultFormName:function(formPath){\r\n        formPath=this.formPath2RealPath(formPath);\r\n        if(this.defaultFormNameList.InArray(formPath)){\r\n            return\r\n        }\r\n        this.defaultFormNameList.push(formPath);\r\n    },\r\n\r\n    GetDefaultFormNameList:function(){\r\n        return this.defaultFormNameList;\r\n    },\r\n\r\n    ClearDefaultFormNameList:function(){\r\n        this.defaultFormNameList = [];\r\n    },\r\n    //------------------回调函数--------------------------\r\n\r\n    //开始切换场景\r\n    OnBeforeExitScene:function(sceneName,isDestory=true){\r\n        this.Log(\"OnBeforeExitScene(%s)\", sceneName);\r\n        //关闭所有界面\r\n        for(let formPath in this.loadFormDict){\r\n            this.CloseForm(formPath,isDestory);\r\n        }\r\n    },\r\n    isInArray:function(value,arrayList){\r\n        let length=arrayList.length;\r\n        for(let i=0;i<length;i++){\r\n            if(value==arrayList[i]){\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n    LoadSceneDefaultForm:function(sceneName){\r\n\r\n        this.Log(\"LoadSceneDefaultForm(%s)\", sceneName);\r\n\r\n        let bluebirdList = [];\r\n\r\n        let loadFormNameList = [];\r\n        let NoAddScene=['clubScene','fightScene','launchScene','loginScene','mainScene']; //四个基础场景不用添加uimore，uimark\r\n        let BaseForm=['UIMark','UIVoice','UIMore'];\r\n        if(this.isInArray(sceneName,NoAddScene)==false){\r\n            //添加游戏预制品\r\n            let GamePrefab=this.SceneInfo[sceneName].gamePrefab;\r\n\r\n            //3D切换\r\n            let is3DShow=app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"is3DShow\");\r\n            if(is3DShow==0 && GamePrefab=='game/XYMJ/ui/UIXYMJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/XYMJ/ui/UIXYMJ2DPlay';\r\n            }\r\n            if(is3DShow==0 && GamePrefab=='game/PTMJ/ui/UIPTMJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/PTMJ/ui/UIPTMJ2DPlay';\r\n            }\r\n            if(is3DShow==0 && GamePrefab=='game/PT13MJ/ui/UIPT13MJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/PT13MJ/ui/UIPT13MJ2DPlay';\r\n            }\r\n            if(is3DShow==0 && GamePrefab=='game/ZJMJ/ui/UIZJMJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/ZJMJ/ui/UIZJMJ2DPlay';\r\n            }\r\n            if(is3DShow==0 && GamePrefab=='game/WZMJ/ui/UIWZMJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/WZMJ/ui/UIWZMJ2DPlay';\r\n                 BaseForm=[];\r\n            }\r\n            if(is3DShow==0 && GamePrefab=='game/YCMJ/ui/UIYCMJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/YCMJ/ui/UIYCMJ2DPlay';\r\n                 BaseForm=[];\r\n            }\r\n\r\n            if(GamePrefab==0){\r\n                this.ErrLog(\"LoadSceneDefaultForm sceneName(%s)  not GamePrefabhave find: (%s)\",sceneName,GamePrefab);\r\n            }\r\n            BaseForm.unshift(GamePrefab);\r\n            //添加三个必须预制品\r\n            for(let i=0;i<BaseForm.length;i++){\r\n                let formName=BaseForm[i];\r\n                //如果界面已经创建\r\n                if(this.loadFormDict.hasOwnProperty(formName)){\r\n                    continue\r\n                }\r\n                //如果界面已经在创建中\r\n                if(this.createingFormDict.hasOwnProperty(formName)){\r\n                    continue\r\n                }\r\n\r\n                loadFormNameList.push(formName);\r\n                bluebirdList.push(this.CreateForm(formName));\r\n            }\r\n        }\r\n        let count = this.defaultFormNameList.length;\r\n        for(let index=0; index<count; index++){\r\n            let formName = this.defaultFormNameList[index];\r\n\r\n            if(loadFormNameList.InArray(formName)){\r\n                continue\r\n            }\r\n            loadFormNameList.push(formName);\r\n            bluebirdList.push(this.CreateForm(formName));\r\n        }\r\n\r\n        //如果是主场景UIMain默认加载\r\n        // if(sceneName == \"mainScene\" && !loadFormNameList.InArray(\"UINewMain\")){\r\n        //     bluebirdList.push(this.CreateForm(\"UINewMain\"));\r\n        // }\r\n\r\n        //如果存在需要加载的界面资源\r\n        if(bluebirdList.length){\r\n\r\n            app.Client.OnEvent(\"ModalLayer\", \"CreateForm\");\r\n\r\n            return app.bluebird.all(bluebirdList)\r\n                .then(function(){\r\n                    app.Client.OnEvent(\"ModalLayer\", \"CreateFormEnd\");\r\n                })\r\n        }\r\n    },\r\n\r\n    //切换完场景\r\n    OnSwithSceneEnd:function(sceneName){\r\n\r\n        this.Log(\"OnSwithSceneEnd(%s)\", sceneName);\r\n\r\n        let BaseForm=['UIMark','UIVoice','UIMore'];\r\n        let NoAddScene=['clubScene','fightScene','launchScene','loginScene','mainScene']; //四个基础场景不用添加uimore，uimark\r\n        if(this.isInArray(sceneName,NoAddScene)==false){\r\n            //添加游戏预制品\r\n            let GamePrefab=this.SceneInfo[sceneName].gamePrefab;\r\n            //3D切换\r\n            let is3DShow=app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"is3DShow\");\r\n            if(is3DShow==0 && GamePrefab=='game/XYMJ/ui/UIXYMJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/XYMJ/ui/UIXYMJ2DPlay';\r\n            }\r\n            if(is3DShow==0 && GamePrefab=='game/PTMJ/ui/UIPTMJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/PTMJ/ui/UIPTMJ2DPlay';\r\n            }\r\n            if(is3DShow==0 && GamePrefab=='game/PT13MJ/ui/UIPT13MJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/PT13MJ/ui/UIPT13MJ2DPlay';\r\n            }\r\n            if(is3DShow==0 && GamePrefab=='game/ZJMJ/ui/UIZJMJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/ZJMJ/ui/UIZJMJ2DPlay';\r\n            }\r\n            if(is3DShow==0 && GamePrefab=='game/WZMJ/ui/UIWZMJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/WZMJ/ui/UIWZMJ2DPlay';\r\n                 BaseForm=[];\r\n            }\r\n            if(is3DShow==0 && GamePrefab=='game/YCMJ/ui/UIYCMJPlay'){\r\n                 //2D场景需要切换\r\n                 GamePrefab='game/YCMJ/ui/UIYCMJ2DPlay';\r\n                 BaseForm=[];\r\n            }\r\n            if(GamePrefab==0){\r\n                this.ErrLog(\"LoadSceneDefaultForm sceneName(%s)  not GamePrefabhave find: (%s)\",sceneName,GamePrefab);\r\n            }\r\n            BaseForm.unshift(GamePrefab);\r\n            //显示三个必须预制品\r\n            for(let i=0;i<BaseForm.length;i++){\r\n                this.ShowForm(BaseForm[i]);\r\n            }\r\n        }\r\n    },\r\n    _isOrientationH:function(){\r\n        let frameSize = cc.view.getFrameSize();\r\n        return frameSize.width > frameSize.height;\r\n    },\r\n});\r\n\r\n\r\nvar g_FormManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n    if(!g_FormManager){\r\n        g_FormManager = new FormManager();\r\n    }\r\n    return g_FormManager;\r\n}\r\n"]}