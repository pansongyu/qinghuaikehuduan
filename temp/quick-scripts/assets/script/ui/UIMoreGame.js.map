{"version":3,"sources":["UIMoreGame.js"],"names":["app","require","SubgameManager","cc","Class","extends","properties","RightNode","Node","pafabItem","btn_tuijian","btn_majiang","btn_poker","OnCreateInit","gametypeConfig","SysDataManager","GetTableDict","gameListConfig","RegEvent","ShowAllGameByType","OnShow","clubData","unionData","FormManager","ShowForm","curShowType","active","getChildByName","DestroyAllChildren","appName","GetAppName","allGameId","Client","GetAllGameId","Type","id","indexOf","gameName","ShareDefine","GametTypeID2PinYin","gameItem","instantiate","name","sys","isNative","isSubgameDownLoad","needUpdateSubgame","success","console","log","imgName","addChild","OnClick","btnName","btnNode","startsWith","replace","clubId","cityId","clubDataTemp","roomKey","gameIndex","enableGameType","CloseForm","GetFormComponentByFormName","RemoveCloseFormArr","ErrLog"],"mappings":"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","file":"UIMoreGame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["var app = require(\"app\");\nvar SubgameManager = require('SubgameManager');\ncc.Class({\n    extends: require(\"BaseForm\"),\n\n    properties: {\n        RightNode:cc.Node,\n        pafabItem:cc.Node,\n        btn_tuijian:cc.Node,\n        btn_majiang:cc.Node,\n        btn_poker:cc.Node,\n    },\n    OnCreateInit: function () {\n        this.gametypeConfig = app.SysDataManager().GetTableDict(\"gametype\");\n        this.gameListConfig = app.SysDataManager().GetTableDict(\"gameList\");\n        this.RegEvent(\"OnUpdateGameEnd\", this.ShowAllGameByType, this);\n    },\n    //-----------------显示函数------------------\n    OnShow: function (clubData = null, unionData = null) {\n        this.clubData = clubData;\n        this.unionData = unionData;\n        this.FormManager.ShowForm('UITop', \"UIMoreGame\");\n        this.curShowType = 0;//0是推荐，1是麻将，2是扑克\n        this.ShowAllGameByType();\n        this.pafabItem.active = false;\n    },\n    ShowAllGameByType:function(){\n        if (this.curShowType == 0) {\n            this.btn_tuijian.getChildByName(\"icon\").active = true;\n            this.btn_majiang.getChildByName(\"icon\").active = false;\n            this.btn_poker.getChildByName(\"icon\").active = false;\n        }else if (this.curShowType == 1) {\n            this.btn_tuijian.getChildByName(\"icon\").active = false;\n            this.btn_majiang.getChildByName(\"icon\").active = true;\n            this.btn_poker.getChildByName(\"icon\").active = false;\n        }else if (this.curShowType == 2) {\n            this.btn_tuijian.getChildByName(\"icon\").active = false;\n            this.btn_majiang.getChildByName(\"icon\").active = false;\n            this.btn_poker.getChildByName(\"icon\").active = true;\n        }\n        \n        //this.RightNode.removeAllChildren();\n        this.DestroyAllChildren(this.RightNode);\n        let appName=this.GetAppName();\n        let allGameId = app.Client.GetAllGameId(true);\n        for (var id in this.gametypeConfig) {\n            let Type = this.gametypeConfig[id][\"Type\"];\n            // if (this.curShowType == 0) {\n            if (allGameId.indexOf(id) < 0) continue;\n            // }\n            if (this.curShowType != 0 && Type != this.curShowType) continue;\n            //未开发的游戏不显示在真机上\n            // if(cc.sys.isNative){\n            //     //读取gamelist表，只显示已开放的游戏,备注:gameList的id需要加1\n            //     let gameId = parseInt(id) + 1;\n            //     let isOpen = this.gameListConfig[gameId].isOpen;\n            //     if (isOpen == 0) {\n            //         console.log(\"游戏：\"+id+\"未开放\");\n            //         continue;\n            //     }else{\n            //         console.log(\"游戏：\"+id+\"开放\");\n            //     }\n            // }\n            let gameName = app.ShareDefine().GametTypeID2PinYin[id];\n            let gameItem = cc.instantiate(this.pafabItem);\n            gameItem.name = \"btn_\" + gameName;\n            if(cc.sys.isNative){\n                if (SubgameManager.isSubgameDownLoad(gameName)) {\n                    gameItem.getChildByName(\"img_xiazai\").active = false;\n                    //已下载，判断是否需要更新\n                    SubgameManager.needUpdateSubgame(gameName, (success) => {\n                        if (success) {\n                            //子游戏需要更新;\n                            gameItem.getChildByName(\"img_gengxin\").active = true;\n                        } else {\n                            //子游戏不需要更新;\n                            gameItem.getChildByName(\"img_gengxin\").active = false;\n                        }\n                    }, () => {\n                        console.log(\"子游戏更新失败\");\n                        gameItem.getChildByName(\"img_gengxin\").active = false;\n                    });\n                }else{\n                    gameItem.getChildByName(\"img_xiazai\").active = true;\n                    gameItem.getChildByName(\"img_gengxin\").active = false;\n                }\n            }\n            let imgName = this.gametypeConfig[id][\"imgUrl\"];\n            if(appName==\"baodao\"){\n                if(gameName==\"nn\" || gameName==\"fqpls\"){\n                    //NN跟fqpls\n                    imgName=imgName+\"_baodao\";\n                }\n            }\n            // let imagePath = \"texture/newmain/allgame/\" + imgName;\n            // //加载图片精灵\n            // cc.loader.loadRes(imagePath, cc.SpriteFrame, function (error, spriteFrame) {\n            //     if(error){\n            //         console.log(\"加载图片精灵失败  \" + imagePath);\n            //         return\n            //     }\n            //     gameItem.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n            // });\n            gameItem.active = true;\n            this.RightNode.addChild(gameItem);\n        }\n    },\n    OnClick:function(btnName, btnNode){\n        if('btn_tuijian' == btnName){\n            this.curShowType = 0;\n            this.ShowAllGameByType();\n        }else if('btn_majiang' == btnName){\n            this.curShowType = 1;\n            this.ShowAllGameByType();\n        }else if('btn_poker' == btnName){\n            this.curShowType = 2;\n            this.ShowAllGameByType();\n        }else if(btnName.startsWith(\"btn_\")){\n            let gameName = btnName.replace('btn_','');\n            let clubId = 0;\n            let cityId = 0;\n            if (this.clubData) {\n                clubId = this.clubData.clubId;\n                cityId = this.clubData.cityId;\n            }\n            if (cc.sys.isNative) {\n                app.FormManager().ShowForm(\"UIDownLoadGame\", gameName,0,null,0,0,false,clubId,this.unionData);\n            }else{\n                let clubDataTemp = null;\n                if (this.clubData) {\n                    clubDataTemp = {};\n                    clubDataTemp.clubId = this.clubData.clubId;\n                    clubDataTemp.cityId = cityId;\n                    clubDataTemp.roomKey = '0';\n                    clubDataTemp.gameIndex = 0;//用来判断保存还是创建\n                    clubDataTemp.enableGameType = '';//不禁用的按钮\n                }\n                app.FormManager().CloseForm('UIMoreGame');\n                app.FormManager().CloseForm('UITop');\n                app.FormManager().GetFormComponentByFormName(\"UITop\").RemoveCloseFormArr(\"UIMoreGame\");\n                app.FormManager().ShowForm('UICreatRoom',{\"gameList\":app.Client.GetAllGameId()},gameName,clubDataTemp,this.unionData);\n            }\n            \n        }\n        else{\n            this.ErrLog(\"OnClick(%s) not find\",btnName);\n        }\n        \n    },\n});"]}