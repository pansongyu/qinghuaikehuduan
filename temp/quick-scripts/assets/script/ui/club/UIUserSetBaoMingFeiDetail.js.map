{"version":3,"sources":["UIUserSetBaoMingFeiDetail.js"],"names":["app","require","cc","Class","extends","properties","OnCreateInit","roomScrollView","node","getChildByName","getComponent","ScrollView","on","GetNextPage","RegEvent","Event_ClubFixedShareChangeMulti","OnShow","data","type","isShowSelf","curPage","shareFixedValue","shareValue","active","GetScorePercentList","isRefresh","sendPack","clubId","opClubId","pid","opPid","pageNum","self","NetManager","SendPack","serverPack","UpdateScrollView","SysNotifyManager","ShowSysMsg","content","scrollToTop","DestroyAllChildren","demo","i","length","isExist","j","children","configId","child","instantiate","configInfo","Label","string","configName","size","changeFlag","EditBox","value","toString","allowValue","addChild","GetAllRoomListCfg","list","temp","scorePercentStr","scorePercent","parseFloat","push","event","OnClick","btnName","btnNode","CloseForm","promotionCalcActiveItemList","FormManager","ShowForm","ErrLog"],"mappings":"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","file":"UIUserSetBaoMingFeiDetail.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\ui\\club","sourcesContent":["var app = require(\"app\");\ncc.Class({\n    extends: require(\"BaseForm\"),\n\n    properties: {\n\n    },\n\n    OnCreateInit: function () {\n        let roomScrollView = this.node.getChildByName(\"mark\").getComponent(cc.ScrollView);\n        roomScrollView.node.on('scroll-to-bottom',this.GetNextPage,this);\n\n        this.RegEvent(\"OnClubFixedShareChangeMulti\", this.Event_ClubFixedShareChangeMulti, this);\n    },\n    OnShow: function (data, type, isShowSelf=false) {\n        this.data = data;\n        this.isShowSelf = isShowSelf;\n        this.curPage = 1;\n        this.type = type;\n        if (type == 1) {\n            this.shareFixedValue=data.shareFixedValue;\n            this.shareValue=0;\n        }else if (type == 0) {\n            this.shareValue=data.shareValue;\n            this.shareFixedValue=0;\n        }\n        if (this.isShowSelf) {\n            this.node.getChildByName(\"btn_reservedValue\").active = false;\n            this.node.getChildByName(\"top\").getChildByName(\"tip_pl\").active = false;\n        }else{\n            if (type == 1) {\n                this.node.getChildByName(\"btn_reservedValue\").active = true;\n            }\n            else{\n                this.node.getChildByName(\"btn_reservedValue\").active = false;\n            }\n            this.node.getChildByName(\"top\").getChildByName(\"tip_pl\").active = true;\n        }\n        this.GetScorePercentList(true);\n    },\n    GetNextPage:function(){\n        // this.curPage++;\n        // this.GetScorePercentList(false);\n    },\n    GetScorePercentList:function(isRefresh){\n        let sendPack = {};\n        sendPack.clubId = this.data.opClubId;\n        sendPack.pid = this.data.opPid;\n        sendPack.pageNum = this.curPage;\n        sendPack.type = this.type;\n        let self = this;\n        if (this.isShowSelf) {\n            app.NetManager().SendPack(\"club.CClubPromotionShareChangeListSelfInfo\",sendPack, function(serverPack){\n                self.UpdateScrollView(serverPack, isRefresh);\n            }, function(){\n                app.SysNotifyManager().ShowSysMsg(\"获取房间活跃计算列表失败\",[],3);\n            });\n        }else{\n            app.NetManager().SendPack(\"club.CClubPromotionShareChangeList\",sendPack, function(serverPack){\n                self.UpdateScrollView(serverPack, isRefresh);\n            }, function(){\n                app.SysNotifyManager().ShowSysMsg(\"获取房间活跃计算列表失败\",[],3);\n            });\n        }\n    },\n    UpdateScrollView:function(serverPack, isRefresh){\n        let roomScrollView = this.node.getChildByName(\"mark\");\n        let content = roomScrollView.getChildByName(\"layout\");\n        if (isRefresh) {\n            roomScrollView.getComponent(cc.ScrollView).scrollToTop();\n            //content.removeAllChildren();\n            this.DestroyAllChildren(content);\n        }\n        let demo = this.node.getChildByName(\"demo\");\n        demo.active = false;\n        for (let i = 0; i < serverPack.length; i++) {\n            //先判断下是否已经存在\n            let isExist = false;\n            for (let j = 0; j < content.children.length; j++) {\n                if (content.children[j].configId == serverPack[i].configId) {\n                    isExist = true;\n                    break;\n                }\n            }\n            if (isExist) continue;\n            let child = cc.instantiate(demo);\n            child.configId = serverPack[i].configId;\n            child.configInfo = serverPack[i];\n            child.getChildByName(\"lb_roomName\").getComponent(cc.Label).string = serverPack[i].configName;\n            child.getChildByName(\"lb_roomCount\").getComponent(cc.Label).string = serverPack[i].size;\n            if (this.isShowSelf) {\n                child.getChildByName(\"scorePercentEditBox\").active = false;\n            }else{\n                child.getChildByName(\"scorePercentEditBox\").active = true;\n                if(serverPack[i].changeFlag==true){\n                    child.getChildByName(\"scorePercentEditBox\").getComponent(cc.EditBox).string = serverPack[i].value.toString();\n                }else{\n                    if (this.type == 1) {\n                        child.getChildByName(\"scorePercentEditBox\").getComponent(cc.EditBox).string = this.shareFixedValue;\n                    }else if (this.type == 0) {\n                        child.getChildByName(\"scorePercentEditBox\").getComponent(cc.EditBox).string = this.shareValue;\n                    }\n                }\n            }\n            \n            //可分配\n            if (serverPack[i].type == 0) {\n                child.getChildByName(\"lb_allowValue\").getComponent(cc.Label).string = serverPack[i].allowValue + \"%\";\n            }else{\n                child.getChildByName(\"lb_allowValue\").getComponent(cc.Label).string = serverPack[i].allowValue;\n            }\n            child.active = true;\n            content.addChild(child);\n        }\n    },\n    GetAllRoomListCfg:function(){\n        let roomScrollView = this.node.getChildByName(\"mark\");\n        let content = roomScrollView.getChildByName(\"layout\");\n        let list = [];\n        for (let i = 0; i < content.children.length; i++) {\n            let temp = {};\n            temp.configId = content.children[i].configId;\n            let scorePercentStr = content.children[i].getChildByName(\"scorePercentEditBox\").getComponent(cc.EditBox).string;\n            if (content.children[i].configInfo.scorePercent == parseFloat(scorePercentStr)) {\n                //没有修改不用上传\n                continue;\n            }\n            if (parseFloat(scorePercentStr) != null && parseFloat(scorePercentStr) >= 0) {\n                temp.value = parseFloat(scorePercentStr);\n                list.push(temp);\n            }else{\n                app.SysNotifyManager().ShowSysMsg(\"活跃计算值请输入大于等于0的数字\",[],3);\n                return [];\n            }\n        }\n        return list;\n    },\n    Event_ClubFixedShareChangeMulti:function(event){\n        this.UpdateScrollView(event, true);\n    },\n    OnClick:function(btnName, btnNode){\n        if(btnName == \"btn_save\"){\n            if (this.isShowSelf) {\n                this.CloseForm();\n                return;\n            }\n            let sendPack = {};\n            sendPack.clubId = this.data.opClubId;\n            sendPack.pid = this.data.opPid;\n            sendPack.type = this.type;\n            sendPack.promotionCalcActiveItemList = this.GetAllRoomListCfg();\n            if (sendPack.promotionCalcActiveItemList.length == 0) {\n                return;\n            }\n            let self = this;\n            app.NetManager().SendPack(\"club.CClubPromotionShareChangeBatch\",sendPack, function(serverPack){\n                app.SysNotifyManager().ShowSysMsg(\"保存成功\",[],3);\n                self.CloseForm();\n            }, function(){\n                app.SysNotifyManager().ShowSysMsg(\"保存失败\",[],3);\n            });\n        }else if (btnName == \"btn_reservedValue\") {\n            let sendPack = {};\n            sendPack.clubId = this.data.opClubId;\n            sendPack.pid = this.data.opPid;\n            let promotionCalcActiveItemList = this.GetAllRoomListCfg();\n            let self = this;\n            app.NetManager().SendPack(\"club.CClubReservedValueInfo\",sendPack, function(serverPack){\n                serverPack.promotionCalcActiveItemList = promotionCalcActiveItemList;\n                serverPack.clubId = self.data.opClubId;\n                serverPack.pid = self.data.opPid;\n                serverPack.type = self.type;\n                app.FormManager().ShowForm(\"ui/club/UIUserSetReservedBaoMingFei\",serverPack);\n            }, function(){\n                \n            });\n        }else if(btnName == \"btn_cancel\"){\n            this.CloseForm();\n        }else if(btnName == \"btn_close\"){\n            this.CloseForm();\n        }else{\n            this.ErrLog(\"OnClick(%s) not find\", btnName);\n        }\n    },\n\n});\n"]}