{"version":3,"sources":["UIClubCreate.js"],"names":["app","require","cc","Class","extends","properties","demo","Node","clubname","EditBox","OnCreateInit","selectCityConfig","SysDataManager","GetTableDict","OnShow","selcetId","ShowAllCity","cityIdList","cityScrollView","node","getChildByName","content","getComponent","ScrollView","scrollToTop","DestroyAllChildren","cityToggle","active","i","length","child","instantiate","cityInfo","Label","string","Name","Toggle","isChecked","cityId","addChild","IfChinese","str","reg","test","Creater","that","name","ShowSysMsg","allSelectCityData","HeroManager","GetCurSelectCityData","selectCityId","children","childTemp","NetManager","SendPack","serverPack","CloseForm","FormManager","GetFormComponentByFormName","RemoveCloseFormArr","clubDatas","ClubManager","AddClubData","SetLastClubData","id","clubsign","ShowForm","CloseClubFrom","error","Msg","SysNotifyManager","OnClick","btnName","btnNode"],"mappings":"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","file":"UIClubCreate.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\ui\\club","sourcesContent":["var app = require(\"app\");\ncc.Class({\n    extends: require(\"BaseForm\"),\n\n    properties: {\n        demo:cc.Node,\n\n        clubname:cc.EditBox,\n    },\n    OnCreateInit: function () {\n        this.selectCityConfig = app.SysDataManager().GetTableDict(\"selectCity\");\n    },\n    //-----------------显示函数------------------\n    OnShow: function (selcetId) {\n        this.ShowAllCity([selcetId]);\n    },\n    ShowAllCity:function(cityIdList){\n        let cityScrollView = this.node.getChildByName(\"cityScrollView\");\n        let content = cityScrollView.getChildByName(\"view\").getChildByName(\"content\");\n        cityScrollView.getComponent(cc.ScrollView).scrollToTop();\n        this.DestroyAllChildren(content);\n        let cityToggle = this.node.getChildByName(\"cityToggle\");\n        cityToggle.active = false;\n        for (let i = 0; i < cityIdList.length; i++) {\n            let child = cc.instantiate(cityToggle);\n            let cityInfo = this.selectCityConfig[cityIdList[i]];\n            child.getChildByName(\"lb_cityName\").getComponent(cc.Label).string = cityInfo.Name;\n            if (i == 0) {\n                child.getComponent(cc.Toggle).isChecked = true;\n            }else{\n                child.getComponent(cc.Toggle).isChecked = false;\n            }\n            child.cityId = cityIdList[i];\n            child.active = true;\n            content.addChild(child);\n        }\n    },\n    IfChinese(str){\n        var reg = /^[\\u4E00-\\u9FA5]+$/;\n        if(reg.test(str)){\n            return true;\n        } else {\n            return false;\n        }\n    },\n    Creater:function(){\n        let that=this;\n        let name=this.clubname.string;\n        if(name==''){\n            this.ShowSysMsg(\"请输入亲友圈名称\");\n            return;\n        }\n        if(this.IfChinese(name)==false){\n            this.ShowSysMsg(\"只能输入中文名称\");\n            return;\n        }\n        let cityScrollView = this.node.getChildByName(\"cityScrollView\");\n        let content = cityScrollView.getChildByName(\"view\").getChildByName(\"content\");\n        let allSelectCityData = app.HeroManager().GetCurSelectCityData();\n        let selectCityId = allSelectCityData[0]['selcetId'];\n        for (let i = 0; i < content.children.length; i++) {\n            let childTemp = content.children[i];\n            if (childTemp.getComponent(cc.Toggle).isChecked) {\n                selectCityId = childTemp.cityId;\n                break;\n            }\n        }\n        // if (selectCityId == 0) {\n        //     this.ShowSysMsg(\"请选择一个城市\");\n        //     return;\n        // }\n        app.NetManager().SendPack('club.CClubCreate',{'clubName':name,'cityId':selectCityId},function(serverPack){\n            that.ShowSysMsg(\"亲友圈创建成功\");\n            that.CloseForm();\n            if (app.FormManager().GetFormComponentByFormName(\"UITop\")) {\n                app.FormManager().GetFormComponentByFormName(\"UITop\").RemoveCloseFormArr(\"ui/club/UIClubList\");\n            }\n            app.FormManager().CloseForm(\"UITop\");\n            \n            app.FormManager().CloseForm(\"ui/club/UIClubList\");\n            app.FormManager().CloseForm(\"ui/club/UIClubNone\");\n            //同步最新数据，打开亲友圈界面\n            let clubDatas = app.ClubManager().AddClubData(serverPack);\n            app.ClubManager().SetLastClubData(serverPack.id, serverPack.clubsign, serverPack.name,0,0);\n            if(clubDatas.length == 0){\n                app.FormManager().ShowForm(\"ui/club/UIClubNone\");\n            }else{\n                // let clubMoban = cc.sys.localStorage.getItem('club_moban');\n                // if(clubMoban == 1){\n                //     app.FormManager().ShowForm(\"ui/club/UIClub\");\n                // }else{\n                // app.FormManager().CloseForm(\"ui/club/UIClubMain\");\n                // app.FormManager().ShowForm(\"ui/club/UIClubMain\");\n                // }\n                app.ClubManager().CloseClubFrom();\n            }\n        },function(error){\n            if (error.Msg == \"FAMILY_CITY_ID_ERROR\") {\n                app.SysNotifyManager().ShowSysMsg(\"城市选择错误，请重新选择\");\n            }else{\n                app.SysNotifyManager().ShowSysMsg(error.Msg);\n            }\n        });\n\n    },\n    OnClick:function(btnName, btnNode){\n        if('btn_create' == btnName){\n            this.Creater();\n        }else if('btn_close' == btnName){\n            this.CloseForm();\n        }\n        \n    },\n});"]}