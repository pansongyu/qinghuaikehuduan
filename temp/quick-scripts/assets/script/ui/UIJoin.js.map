{"version":3,"sources":["UIJoin.js"],"names":["app","require","cc","Class","extends","properties","sp_shurukuang","Node","OnCreateInit","labelString","GameManager","RegEvent","Event_GetFamilyInfo","Event_CodeError","event","codeInfo","ShareDefine","CLUB_NotClubJoinRoomErr","SysNotifyManager","ShowSysMsg","codeData","JSON","parse","Result","Msg","SetWaitForConfirm","ConfirmYN","clubName","clubsign","OnShow","ResetNumber","children","idx","length","sp_bg","getChildByName","getComponent","Label","string","OnClickForm","OnClick","btnName","btnNode","ErrLog","Click_Btn_Clear","Click_btn_close","Click_BtnNumber","OnClick_Close","node","GetWndNode","pop","num","Math","floor","substring","push","roomKey","join","lb_num","data","toString","self","NetManager","SendPack","console","warn","EnterFunction","arg","log","cfg","selectNode","find","active","onShow","error","gameType","name","GametTypeID2PinYin","Client","JoinRoomCheckSubGame","undefined","msgID","type","msgArg","cbArg","ConfirmManager","SetWaitForConfirmForm","OnConFirm","bind","ShowConfirm","clickType","backArgList","ClubManager","SendReqJoinClub"],"mappings":"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","file":"UIJoin.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["/*\n UIJoin 登陆界面\n*/\nvar app = require(\"app\");\ncc.Class({\n    extends: require(\"BaseForm\"),\n\n    properties: {\n        sp_shurukuang: cc.Node,\n    },\n    OnCreateInit: function () {\n        this.labelString = [];\n        this.GameManager = app.GameManager();\n        // this.RegEvent(\"EnterRoomNeedJoinFamily\", this.Event_EnterRoomNeedJoinFamily, this);\n        this.RegEvent(\"GetFamilyInfo\", this.Event_GetFamilyInfo, this);\n        this.RegEvent(\"CodeError\", this.Event_CodeError, this);\n    },\n    //事件回调\n    Event_CodeError: function (event) {\n        let codeInfo = event;\n        if (codeInfo[\"Code\"] == this.ShareDefine.CLUB_NotClubJoinRoomErr) {\n            app.SysNotifyManager().ShowSysMsg('CLUB_NotClubJoinRoomErr');\n        } else if (codeInfo[\"Code\"] == 304) {\n            app.SysNotifyManager().ShowSysMsg('该房间已经开始游戏了', [], 3);\n            // app.SysNotifyManager().ShowSysMsg(codeInfo[\"Result\"][\"Msg\"].toString());\n        } else if (codeInfo[\"Code\"] == 6018) {\n            let codeData = JSON.parse(codeInfo.Result.Msg);\n            this.SetWaitForConfirm(\"MSG_NOT_CLUBMEMBER\", app.ShareDefine().ConfirmYN, [codeData.clubName], [codeData.clubsign]);\n        } else if (codeInfo[\"Code\"] == 6121) {\n            app.SysNotifyManager().ShowSysMsg('该房间为联盟房间，请通过亲友圈加入', [], 4);\n        }\n    },\n\n    Event_GetFamilyInfo: function () {\n\n        //加入房主工会成功,再次发送进入房间\n        // if(this.labelString.length == 6){\n        // \tlet roomKey = this.labelString.join(\"\");\n        // \tthis.GameManager.SendEnterRoom(roomKey);\n        // }\n        // else{\n        // \tthis.ErrLog(\"Event_GetFamilyInfo labelString error\", this.labelString);\n        // }\n    },\n\n    OnShow: function () {\n        this.ResetNumber();\n    },\n\n    ResetNumber: function () {\n        let children = this.sp_shurukuang.children;\n        for (let idx = 0; idx < children.length; idx++) {\n            let sp_bg = children[idx];\n            sp_bg.getChildByName(\"lb_num\").getComponent(cc.Label).string = \"\";\n        }\n        this.labelString = [];\n    },\n\n    OnClickForm: function () {\n        //this.CloseForm();\n    },\n    //---------点击函数---------------------\n    OnClick: function (btnName, btnNode) {\n        if (!btnName) {\n            this.ErrLog(\"UIJoin Buttn OnClick(%s) not find btnName\", btnName);\n        }\n        if (btnName === \"btn_clear\") {\n            this.Click_Btn_Clear();\n        } else if (btnName === \"btn_close\") {\n            this.Click_btn_close();\n        } else if (btnName === \"btn_reset\") {\n            this.ResetNumber();\n        } else {\n            this.Click_BtnNumber(btnName);\n        }\n    },\n\n    Click_btn_close: function () {\n        this.labelString = [];\n        this.OnClick_Close();\n    },\n\n    Click_Btn_Clear: function () {\n        if (this.labelString.length == 0) {\n            return\n        }\n        let node = this.GetWndNode(\"sp_shuru/shurukuang/sp_bg\" + this.labelString.length + \"/lb_num\");\n        node.getComponent(cc.Label).string = \"\";\n        this.labelString.pop();\n    },\n\n    Click_BtnNumber: function (btnName) {\n        if (this.labelString.length >= 6)\n            return;\n        let num = Math.floor(btnName.substring(btnName.length - 1));\n        this.labelString.push(num);\n        let roomKey = this.labelString.join(\"\");\n\n        let children = this.sp_shurukuang.children;\n        for (let idx = 0; idx < children.length; idx++) {\n            let sp_bg = children[idx];\n            let lb_num = sp_bg.getChildByName(\"lb_num\").getComponent(cc.Label);\n            if (lb_num.string == \"\") {\n                let data = this.labelString[this.labelString.length - 1];\n                lb_num.string = data.toString();\n                break;\n            }\n        }\n        if (this.labelString.length == 6) {\n            let self = this;\n            app.NetManager().SendPack(\"room.CBaseGetGameType\", {\"roomKey\": roomKey}, function (event) {\n                console.warn('join event:', event);\n                let EnterFunction = null;\n                //钓解选座位\n                if (event == 87) {\n                    EnterFunction = () => {\n                        app.NetManager().SendPack(\"room.CBaseEnterRoom\", {\n                            \"roomKey\": roomKey,\n                            \"posID\": -1\n                        }, (arg) => {\n                            console.log('进入房间参数：', arg);\n                            if (arg && arg.cfg) {\n                                if (arg.roomKey == null) arg.roomKey = roomKey;\n                                let selectNode = cc.find('UIDXSelectJoinChair', self.node);\n                                selectNode.active = true;\n                                selectNode.getComponent('UIDXSelectJoinChair').onShow(arg, ()=>{\n                                    self.OnClick_Close();\n                                });\n                                //\n                            }\n                        }, (event) => {\n                            console.error(\"进入房间失败...\", event);\n                        });\n                    }\n                }\n                let gameType = event;\n                let name = app.ShareDefine().GametTypeID2PinYin[gameType];\n                app.Client.JoinRoomCheckSubGame(name, roomKey, undefined, EnterFunction);\n                self.ResetNumber();\n            }, function (event) {\n                self.ResetNumber();\n            });\n        }\n    },\n    /**\n     * 2次确认点击回调\n     * @param curEventType\n     * @param curArgList\n     */\n    SetWaitForConfirm: function (msgID, type, msgArg = [], cbArg = []) {\n        let ConfirmManager = app.ConfirmManager();\n        ConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, cbArg);\n        ConfirmManager.ShowConfirm(type, msgID, msgArg);\n    },\n    OnConFirm: function (clickType, msgID, backArgList) {\n        if (clickType != \"Sure\") {\n            return;\n        }\n        if ('MSG_NOT_CLUBMEMBER' == msgID) {\n            let clubsign = backArgList[0];\n            app.ClubManager().SendReqJoinClub(clubsign);\n        }\n    },\n});\n"]}