{"version":3,"sources":["TalkingDataManager.js"],"names":["app","require","TalkingDataManager","BaseClass","extend","Init","JS_Name","ShareDefine","Client","RegEvent","OnEvent_PlayerLoginOK","OnEvent_HeroProperty","sdk","window","TDGA","OnReload","Log","accountInfo","HeroAccountManager","GetAccountInfo","heroInfo","HeroManager","GetHeroInfo","heroID","GetHeroID","RecordAccount","event","argDict","property","RecordHeroLv","accountID","accountType","heroLv","channel","GetClientConfigProperty","Account","setLevel","RecordStartPay","orderID","apptype","appID","appPrice","onChargeRequest","join","RecordEndPay","onChargeSuccess","RecordDiamondReward","diamond","reason","onReward","RecordStartTowerLv","towerLv","onMissionBegin","RecordEndTowerLv","onMissionCompleted","RecordEndFailTowerLv","onMissionFailed","g_TalkingDataManager","exports","GetModel"],"mappings":"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","file":"TalkingDataManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\sdk","sourcesContent":["/*\n TalkingDataManager.js 统计数据管理器\n */\nvar app = require('app');\n\nvar TalkingDataManager = app.BaseClass.extend({\n\n\tInit:function(){\n\t\tthis.JS_Name = \"TalkingDataManager\";\n\n\t\tthis.ShareDefine = app.ShareDefine();\n\n\t\tapp.Client.RegEvent(\"PlayerLoginOK\", this.OnEvent_PlayerLoginOK, this);\n\t\tapp.Client.RegEvent(\"HeroProperty\", this.OnEvent_HeroProperty, this);\n\n\t\t//如果存在全局sdk对象\n\t\tthis.sdk = window.TDGA;\n\n\t\tthis.OnReload();\n\t\tthis.Log(\"Init\");\n\t},\n\n\tOnReload:function(){\n\n\t},\n\n\tOnEvent_PlayerLoginOK:function(){\n\t\tlet accountInfo = app.HeroAccountManager().GetAccountInfo();\n\t\tlet heroInfo = app.HeroManager().GetHeroInfo();\n\t\tlet heroID = app.HeroManager().GetHeroID();\n\t\tthis.RecordAccount(accountInfo[\"AccountID\"], accountInfo[\"AccountType\"], heroID, heroInfo[\"lv\"]);\n\t},\n\n\tOnEvent_HeroProperty:function(event){\n\t\tlet argDict = event;\n\t\tlet property = argDict[\"Property\"];\n\t\tif(property == \"lv\"){\n\t\t\tthis.RecordHeroLv(argDict[\"Value\"]);\n\t\t}\n\n\t},\n\n\t//记录登录的玩家账号数据\n\tRecordAccount:function(accountID, accountType, heroID, heroLv){\n\t\tif(!this.sdk){\n\t\t\treturn\n\t\t}\n\n\t\tlet channel = app.Client.GetClientConfigProperty(\"Channel\");\n\n\t\tthis.sdk.Account({\n\t\t\t\t\t\t\t//必须使用heroID作为唯一ID,因为orderServer没有accountID数据\n\t\t\t\t\t\t\t\"accountId\":heroID,\n\t\t\t\t\t\t\t\"level\":heroLv,\n\t\t\t\t\t\t\t\"gameServer\":channel,\n\t\t\t\t\t\t\t\"accountType \":accountType,\n\t\t\t\t\t\t\t\"age\":1,\n\t\t\t\t\t\t\t\"accountName\":accountID,\n\t\t\t\t\t\t\t\"gender\":1,\n\t\t\t\t\t\t})\n\t},\n\n\t//记录玩家等级\n\tRecordHeroLv:function(heroLv){\n\t\tif(!this.sdk){\n\t\t\treturn\n\t\t}\n\t\tthis.sdk.Account.setLevel(heroLv);\n\t},\n\n\t//记录发起付费\n\tRecordStartPay:function(orderID, apptype, appID, appPrice){\n\t\tif(!this.sdk){\n\t\t\treturn\n\t\t}\n\t\tlet channel = app.Client.GetClientConfigProperty(\"Channel\");\n\n\t\tthis.sdk.onChargeRequest({\n\t\t\t\t\t\t\t\t\t\"orderId\":orderID,\n\t\t\t\t\t\t\t\t\t\"iapId\" : [apptype, appID].join(\"_\"),\n\t\t\t\t\t\t\t\t\t\"appID\": appID,\n\t\t\t\t\t\t\t\t\t\"currencyType\":\"CNY\",\n\t\t\t\t\t\t\t\t\t\"virtualCurrencyAmount\":appPrice,\n\t\t\t\t\t\t\t\t\t\"paymentType\": channel,\n\t\t\t\t\t\t\t\t});\n\t},\n\n\tRecordEndPay:function(orderID, apptype, appID, appPrice){\n\t\tif(!this.sdk){\n\t\t\treturn\n\t\t}\n\t\tlet channel = app.Client.GetClientConfigProperty(\"Channel\");\n\n\t\tthis.sdk.onChargeSuccess({\n\t\t\t\"orderId\":orderID,\n\t\t\t\"iapId\" : [apptype, appID].join(\"_\"),\n\t\t\t\"appID\": appID,\n\t\t\t\"currencyType\":\"CNY\",\n\t\t\t\"virtualCurrencyAmount\":appPrice,\n\t\t\t\"paymentType\": channel,\n\t\t});\n\t},\n\n\t//记录赠送获得的钻石\n\tRecordDiamondReward:function(diamond, reason){\n\t\tif(!this.sdk){\n\t\t\treturn\n\t\t}\n\t\tthis.sdk.onReward(diamond, reason);\n\t},\n\n\t//记录塔层开始\n\tRecordStartTowerLv:function(towerLv){\n\t\tif(!this.sdk){\n\t\t\treturn\n\t\t}\n\t\tthis.sdk.onMissionBegin(towerLv);\n\t},\n\t//记录塔层通关结束\n\tRecordEndTowerLv:function(towerLv){\n\t\tif(!this.sdk){\n\t\t\treturn\n\t\t}\n\t\tthis.sdk.onMissionCompleted(towerLv);\n\t},\n\n\tRecordEndFailTowerLv:function(towerLv){\n\t\tif(!this.sdk){\n\t\t\treturn\n\t\t}\n\t\tthis.sdk.onMissionFailed(towerLv, \"FightBossFail\");\n\t},\n\n\n});\n\nvar g_TalkingDataManager = null;\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n\tif(!g_TalkingDataManager){\n\t\tg_TalkingDataManager = new TalkingDataManager();\n\t}\n\treturn g_TalkingDataManager;\n}"]}