{"version":3,"sources":["NativeManager.js"],"names":["app","require","NativeManager","BaseClass","extend","Init","OCClassName","JavaClassName","JavaArgTypeDict","ComTool","JS_Name","CallToNative","funName","argList","returnType","cc","sys","isNative","ErrLog","subGameName","push","IsAndroid","CallToJava","IsIOS","CallToOC","os","javaFunName","javaFunArgList","javaFunSign","count","length","index","argInfo","console","log","Name","Value","hasOwnProperty","value","argType","Object","prototype","toString","call","slice","javaType","returnValueType","unshift","SysLog","JSON","stringify","jsb","reflection","callStaticMethod","apply","error","stack","ocFunName","ocFunArgList","funString","name","splice","g_NativeManager","exports","GetModel"],"mappings":"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","file":"NativeManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\sdk","sourcesContent":["/*\n * \tNativeManager.js\n * \t移动端接口管理器\n *\n *\tauthor:hongdian\n *\tdate:2014-10-28\n *\tversion:1.0\n *\n * 修改时间 修改人 修改内容:\n *\n * change: \"2014-10-28 20:24\" hongdian 同步C++\n *\n */\n\nvar app = require('app');\n/**\n * 类构造\n */\nvar NativeManager = app.BaseClass.extend({\n\n\tInit:function(){\n\t\tthis.OCClassName = \"NativeMgr\";\n\t\tthis.JavaClassName = \"org/cocos2dx/javascript/NativeMgr\";\n\t\tthis.JavaArgTypeDict = {\"Number\":\"I\", \"String\":\"Ljava/lang/String;\", \"Boolean\":\"Z\", \"Float\":\"F\"};\n\t\tthis.ComTool = app.ComTool();\n\t\tthis.JS_Name = \"NativeManager\";\n\t},\n\n\t//调用native平台接口\n\t//funName:函数名\n\t//参数顺序列表argList=[{\"Name\":\"Title\", \"Value\":\"xx\"},{\"Name\":\"Description\", \"Value\":\"xx\"},{\"Name\":\"URL\", \"Value\":\"xx\"}]\n\t//returnType 返回值类型\n\tCallToNative:function(funName, argList, returnType){\n\t\tif(!cc.sys.isNative){\n\t\t\tthis.ErrLog(\"CallToNative(%s) not native\", funName);\n\t\t\treturn\n\t\t}\n\t\t//加入子游戏名字，以便回调到各个小游戏，大厅统一用hall\n\t\tlet subGameName = {\"Name\":\"subGameName\",\"Value\":\"hall\"};\n\t\targList.push(subGameName);\n\t\tif(this.ComTool.IsAndroid()){\n\t\t\treturn this.CallToJava(funName, argList, returnType);\n\t\t}\n\t\telse if(this.ComTool.IsIOS()){\n\t\t\tif(funName==\"getVersion\" || funName==\"checkVersion\"){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn this.CallToOC(funName, argList, returnType);\n\t\t}\n\t\telse{\n\t\t\tthis.ErrLog(\"CallToNative:%s error\", cc.sys.os);\n\t\t}\n\t},\n\n\t/**\n\t * 调用java接口\n\t * javaFunName MyAPIManager.java 对应函数名\n\t * argList argList 函数接受的参数列表\n\t * returnType returnType 函数返回值类型\n\t */\n\tCallToJava:function(javaFunName, argList, returnType){\n\t\t//jsb.reflection.callStaticMethod('org/cocos2dx/javascript/SDKManager',\n\t\t//'OnWeChatShare','(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V',\"当当猫\",\"当当猫分享\",\"www.ddmh5.com\",\"0\");\n\n\t\tlet javaFunArgList = [];\n\n\t\tlet javaFunSign = \"(\";\n\n\t\tlet count = argList.length;\n\t\tfor(let index=0; index<count; index++){\n\t\t\tlet argInfo = argList[index];\n\t\t\tconsole.log(\"argInfo Name == \" + argInfo.Name);\n\t\t\tconsole.log(\"argInfo Value == \" + argInfo.Value);\n\t\t\tif(!argInfo.hasOwnProperty(\"Value\")){\n\t\t\t\tthis.ErrLog(\"CallToJava argInfo error\", argInfo);\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlet value = argInfo[\"Value\"];\n\t\t\tlet argType = Object.prototype.toString.call(value).slice(\"[object \".length, -1);\n\t\t\tlet javaType = this.JavaArgTypeDict[argType];\n\t\t\tif(!javaType){\n\t\t\t\tthis.ErrLog(\"CallToJava(%s, %j) error\", javaFunName, argList);\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tjavaFunSign += javaType;\n\n\t\t\tjavaFunArgList.push(value);\n\t\t}\n\n\t\tlet returnValueType = this.JavaArgTypeDict[returnType];\n\t\t//如果有返回值\n\t\tif(returnValueType){\n\t\t\tjavaFunSign += \")\" + returnValueType;\n\t\t}\n\t\telse{\n\t\t\tjavaFunSign += \")V\";\n\t\t}\n\t\tjavaFunArgList.unshift(this.JavaClassName, javaFunName, javaFunSign);\n\n\n\t\ttry{\n\t\t\tthis.SysLog(\"javaFunArgList CallToJava(%s)\", JSON.stringify(javaFunArgList));\n\t\t\treturn jsb.reflection.callStaticMethod.apply(this, javaFunArgList);\n\t\t}\n\t\tcatch (error){\n\t\t\tthis.ErrLog(\"CallToJava(%s,%s,%s) error:%s\", javaFunName, JSON.stringify(argList), returnType, error.stack);\n\t\t}\n\n\t},\n\n\t/**\n\t * 调用oc接口\n\t * javaFunName MyAPIManager.java 对应函数名\n\t * argList argList 函数接受的参数列表\n\t * returnType returnType 函数返回值类型\n\t */\n\tCallToOC:function(ocFunName, argList){\n\t\t//jsb.reflection.callStaticMethod(this.OCClassName,''OnWeChatShareWithTitle: Description: URL:Type:','红中麻将','红中麻将分享','www.ddmh5.com',\"0\");\n\n\t\tlet ocFunArgList = [];\n\t\tocFunArgList.push(this.OCClassName);\n\n\t\tlet funString = ocFunName;\n\t\tlet count = argList.length;\n\t\tfor(let index=0; index < count; index++){\n\t\t\tlet argInfo = argList[index];\n\t\t\tlet name = argInfo[\"Name\"];\n\t\t\tlet value = argInfo[\"Value\"];\n\n\t\t\tif(!name){\n\t\t\t\tthis.ErrLog(\"CallToOC(%s) argInfo error\", ocFunName, argInfo);\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif(index){\n\t\t\t\tfunString += name + \":\";\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfunString += \"With\" + name + \":\";\n\t\t\t}\n\n\t\t\tocFunArgList.push(value);\n\t\t}\n\t\t//插入函数签名\n\t\tocFunArgList.splice(1, 0, funString);\n\n\t\ttry{\n\t\t\tconsole.log(\"javaFunArgList CallToOC(%s)\", JSON.stringify(ocFunArgList));\n\t\t\treturn jsb.reflection.callStaticMethod.apply(this, ocFunArgList);\n\t\t}\n\t\tcatch (error){\n\t\t\tthis.ErrLog(\"CallToOC(%s,%s) error:%s\", ocFunName, JSON.stringify(argList), error.stack);\n\t\t}\n\n\t},\n})\n\nvar g_NativeManager = null\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n\tif(!g_NativeManager){\n\t\tg_NativeManager = new NativeManager();\n\t}\n\treturn g_NativeManager;\n}"]}