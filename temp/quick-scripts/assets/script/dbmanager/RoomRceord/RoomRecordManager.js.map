{"version":3,"sources":["RoomRecordManager.js"],"names":["app","require","RoomRecordManager","BaseClass","extend","Init","JS_Name","NetManager","ComTool","RegNetPack","OnPack_RoomAllRecord","OnPack_RoomRecordDetail","OnReload","roomAllRecord","roomAllRecordDetail","serverPack","count","length","i","roomRecord","roomID","allRecordRoomIDArray","Object","keys","localAllRecordRoomIDArray","Client","OnEvent","roomRecordDetail","records","key","ErrLog","GetRoomAllRecord","GetRoomRecord","hasOwnProperty","GetRoomRecordDetail","SendRoomRecordDetail","SendPack","RequestRoomAllRecord","g_RoomRecordManager","exports","GetModel"],"mappings":"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","file":"RoomRecordManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\RoomRceord","sourcesContent":["\nvar app = require('app');\n\nvar RoomRecordManager = app.BaseClass.extend({\n\n    Init:function () {\n        this.JS_Name = \"RoomRecordManager\";\n\n        this.NetManager = app.NetManager();\n        this.ComTool = app.ComTool();\n\n        this.NetManager.RegNetPack(\"hzmj.C2114RoomAllRecord\", this.OnPack_RoomAllRecord, this);\n        this.NetManager.RegNetPack(\"hzmj.C2115RoomRecordDetail\", this.OnPack_RoomRecordDetail, this);\n\n    },\n    OnReload:function(){\n        //客户端玩家参与所有对局记录本地缓存\n        // roomID:{\n        //     0:Object,\n        //     endSec:1490862765,\n        //     fastCnt:{\n        //                 0:0,\n        //                 1:0,\n        //                 2:0,\n        //                 3:0\n        //             },\n        //     huCnt:{\n        //                 0:0,\n        //                 1:0,\n        //                 2:0,\n        //                 3:0\n        //             },\n        //     players:{\n        //                 0:{\n        //                     icon:0,\n        //                     iconUrl:\"http://wx.qlogo.cn/mmopen/ajNVdqHZLLDDPzIfvLZSbDPunaD2ZuTLtibZ9BXmvOmE7AFeyUQQme04YNpT7Pmx2Y92UJnQkFrIbeMMGrRgebg/0\",\n        //                     name:\"游客_10739\",\n        //                     pid:1008600000001211\n        //                      },\n        //                 1:Object,\n        //                 2:Object,\n        //                 3:Object\n        //     },\n        //     point:{\n        //                 0:0\n        //                 1:0\n        //                 2:0\n        //                 3:0\n        //             },\n        //     roomID:1008600000000008,\n        //     setCnt:4\n        // }\n        this.roomAllRecord = {};\n        //客户端玩家参与所有对局的小局记录本地缓存\n        this.roomAllRecordDetail = {};\n    },\n    //-------------事件回调函数---------------\n    OnPack_RoomAllRecord:function (serverPack) {\n        let count = serverPack.length;\n        let roomAllRecord = {};\n        for(let i = 0; i < count; i++){\n            let roomRecord = serverPack[i];\n            let roomID = roomRecord[\"roomID\"];\n            roomAllRecord[roomID] = roomRecord;\n        }\n\n        let allRecordRoomIDArray = Object.keys(roomAllRecord);\n\n        //获取本地缓存数据key列表\n        let localAllRecordRoomIDArray = Object.keys(this.roomAllRecord);\n\n        if(allRecordRoomIDArray.length != localAllRecordRoomIDArray.length){\n            this.roomAllRecord = roomAllRecord;\n            app.Client.OnEvent(\"RoomAllRecord\", {});\n        }\n\n    },\n    OnPack_RoomRecordDetail:function (serverPack) {\n        let roomRecordDetail = {};\n        let records = serverPack[\"records\"];\n        let count = records.length;\n        let roomID = 0;\n        for(let i = 0; i < count; i++){\n            let roomRecord = records[i];\n            roomID = roomRecord[\"roomID\"];\n            let key = roomRecord[\"setID\"];\n            roomRecordDetail[key] = roomRecord;\n        }\n\n        if(!roomID){\n            this.ErrLog(\"OnPack_RoomRecordDetail\");\n            return\n        }\n        this.roomAllRecordDetail[roomID] = roomRecordDetail;\n\n        app.Client.OnEvent(\"RoomRecordDetail\", {\"roomID\":roomID});\n    },\n    //----------获取函数---------------\n    //获取客户端玩家参与的所有对局记录\n    GetRoomAllRecord:function () {\n        return this.roomAllRecord;\n    },\n\n    GetRoomRecord:function (roomID) {\n        if(this.roomAllRecord.hasOwnProperty(roomID)){\n            return this.roomAllRecord[roomID];\n        }\n        else{\n            this.ErrLog(\"GetRoomRecord not find roomID:%s\", roomID);\n        }\n    },\n\n    //获取客户端玩家参与指定局的小局记录\n    GetRoomRecordDetail:function (roomID) {\n        if(this.roomAllRecordDetail.hasOwnProperty(roomID)){\n            return this.roomAllRecordDetail[roomID];\n        }\n        else{\n            this.SendRoomRecordDetail(roomID);\n            return {}\n        }\n    },\n\n    //-------------发送请求封包-----------------\n    //请求对局记录小局信息\n    SendRoomRecordDetail:function(roomID){\n        this.NetManager.SendPack(\"hzmj.C2115RoomRecordDetail\", {\"roomID\":roomID});\n    },\n    //请求客户端玩家参与的所有对局记录\n    RequestRoomAllRecord:function(){\n        this.NetManager.SendPack(\"hzmj.C2114RoomAllRecord\", {});\n    },\n});\n\nvar g_RoomRecordManager = null;\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n    if(!g_RoomRecordManager){\n        g_RoomRecordManager = new RoomRecordManager();\n    }\n    return g_RoomRecordManager;\n}\n"]}