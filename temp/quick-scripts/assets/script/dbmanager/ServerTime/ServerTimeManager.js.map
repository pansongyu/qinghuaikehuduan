{"version":3,"sources":["ServerTimeManager.js"],"names":["app","require","ServerTimeManager","BaseClass","extend","Init","JS_Name","ShareDefine","ComTool","Reload","Log","syncServerDataTimeTick","serverIntMsTime","serverDataTime","Date","logInGameTick","serverStartTime","InitLoginData","serverPack","SetServerTime","SetServerStartTime","curServerTick","curDate","nowTick","getTime","setTime","startTime","GetServerTimeData","getType","curNowTime","GetServerTimeByTimeTick","GetServerWeek","getDay","GetServerHours","getHours","GetServerMinSec","getMinutes","GetServerSec","getSeconds","GetServerYear","getFullYear","GetServerMonth","getMonth","GetServerDay","getDate","GetServerDate","GetServerDateString","year","StringAddNumSuffix","month","day","hour","min","second","join","GetServerTimeByTimeString","timeString","dateList","split","length","ErrLog","parse","getTimezoneOffset","tick","nowDate","GetDateTickToTimeStr","myDate","dateString","GetServerTimeTickByTime","sec","setHours","Math","floor","GetServerStartTime","TickToStr","showType","type","dayTick","dayNum","parseInt","hourNum","Second","intervalMinSec","intervalSec","showStr","ShowDayHour","StringReplace","ShowHourMinSec","ShowMinSec","ShowSec","ShowSecondSec","DayHourMinuteSecond","GetPassTimeStr","passTick","isNaN","passSec","BeforeSec_Str","value","i18n","t","GetCDTimeString","endTick","serverTimeTick","remainTick","GetMictimeString","GetCDTimeStringBySec","endSec","GetMictimeStringBySec","mictimek","GetRemainTimeStr","timeTick","g_ServerTimeManager","exports","GetModel"],"mappings":";;;;;;AAAA;;;;;;;;;;;;;;;AAeA,IAAIA,MAAMC,QAAQ,KAAR,CAAV;;AAEA;;;AAGA,IAAIC,oBAAoBF,IAAIG,SAAJ,CAAcC,MAAd,CAAqB;;AAE5C;;;AAGAC,OAAK,gBAAU;AACd,OAAKC,OAAL,GAAe,mBAAf;;AAEA,OAAKC,WAAL,GAAmBP,IAAIO,WAAJ,EAAnB;AACA,OAAKC,OAAL,GAAeR,IAAIQ,OAAJ,EAAf;;AAEA,OAAKC,MAAL;;AAEA,OAAKC,GAAL,CAAS,6BAAT;AACA,EAd2C;;AAgB5C;;;AAGAD,SAAO,kBAAU;AAChB;AACA,OAAKE,sBAAL,GAA8B,CAA9B;AACA;AACA,OAAKC,eAAL,GAAuB,CAAvB;AACA;AACA,OAAKC,cAAL,GAAsB,IAAIC,IAAJ,EAAtB;AACA;AACA,OAAKC,aAAL,GAAqB,CAArB;AACA;AACA,OAAKC,eAAL,GAAuB,CAAvB;AACA,EA9B2C;;AAgC5C;AACA;;;AAGAC,gBAAc,uBAASC,UAAT,EAAoB;AACjC,OAAKC,aAAL,CAAmBD,WAAW,MAAX,CAAnB;AACA,OAAKE,kBAAL,CAAwBF,WAAW,iBAAX,CAAxB;AACA,EAvC2C;;AA0C5C;;;AAGA;;;AAGAC,gBAAc,uBAASE,aAAT,EAAuB;;AAEpC,MAAIC,UAAU,IAAIR,IAAJ,EAAd;AACA,MAAIS,UAAUD,QAAQE,OAAR,EAAd;;AAEA,OAAKZ,eAAL,GAAuBS,aAAvB;AACA,OAAKR,cAAL,CAAoBY,OAApB,CAA4B,KAAKb,eAAjC;AACA,OAAKD,sBAAL,GAA8BY,OAA9B;;AAEA,SAAO,KAAKV,cAAZ;AAEA,EA3D2C;;AA6D5C;;;AAGAO,qBAAmB,4BAASM,SAAT,EAAmB;AACrC,OAAKV,eAAL,GAAuBU,SAAvB;AACA,EAlE2C;;AAoE5C;AACA;;;AAGAC,oBAAkB,2BAASC,OAAT,EAAiB;AAClC,MAAI,CAAC,KAAKhB,eAAV,EAA0B;AACzB,UAAO,CAAP;AACA;;AAED,MAAIiB,aAAa,IAAIf,IAAJ,GAAWU,OAAX,EAAjB;;AAEA,MAAIF,UAAU,KAAKQ,uBAAL,CAA6B,KAAKlB,eAAL,GAAuBiB,UAAvB,GAAoC,KAAKlB,sBAAtE,CAAd;;AAEA;AACA,MAAIiB,WAAW,KAAKrB,WAAL,CAAiBwB,aAAhC,EAA8C;AAC7C,UAAOT,QAAQU,MAAR,EAAP;AACA;AACD;AAHA,OAIK,IAAGJ,WAAW,KAAKrB,WAAL,CAAiB0B,cAA/B,EAA8C;;AAElD,WAAOX,QAAQY,QAAR,EAAP;AACA;AACD;AAJK,QAKA,IAAGN,WAAW,KAAKrB,WAAL,CAAiB4B,eAA/B,EAA+C;;AAEnD,YAAOb,QAAQc,UAAR,EAAP;AACA;AACD;AAJK,SAKA,IAAGR,WAAW,KAAKrB,WAAL,CAAiB8B,YAA/B,EAA4C;;AAEhD,aAAOf,QAAQgB,UAAR,EAAP;AACA;AACD;AAJK,UAKA,IAAGV,WAAW,KAAKrB,WAAL,CAAiBgC,aAA/B,EAA6C;;AAEjD,cAAOjB,QAAQkB,WAAR,EAAP;AACA;AACD;AAJK,WAKA,IAAGZ,WAAW,KAAKrB,WAAL,CAAiBkC,cAA/B,EAA8C;;AAElD,eAAOnB,QAAQoB,QAAR,EAAP;AACA;AACD;AAJK,YAKA,IAAGd,WAAW,KAAKrB,WAAL,CAAiBoC,YAA/B,EAA4C;;AAEhD,gBAAOrB,QAAQsB,OAAR,EAAP;AACA,SAHI,MAKA,IAAGhB,WAAW,KAAKrB,WAAL,CAAiBsC,aAA/B,EAA6C;;AAEjD,gBAAOvB,OAAP;AACA,SAHI,MAIA,IAAGM,WAAW,KAAKrB,WAAL,CAAiBuC,mBAA/B,EAAmD;;AAEvD,aAAIC,OAAO,KAAKvC,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoC1B,QAAQkB,WAAR,EAApC,EAA2D,CAA3D,CAAX;AACA,aAAIS,QAAQ,KAAKzC,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoC1B,QAAQoB,QAAR,KAAqB,CAAzD,EAA4D,CAA5D,CAAZ;AACA,aAAIQ,MAAM,KAAK1C,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoC1B,QAAQsB,OAAR,EAApC,EAAuD,CAAvD,CAAV;AACA,aAAIO,OAAO,KAAK3C,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoC1B,QAAQY,QAAR,EAApC,EAAwD,CAAxD,CAAX;AACA,aAAIkB,MAAM,KAAK5C,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoC1B,QAAQc,UAAR,EAApC,EAA0D,CAA1D,CAAV;AACA,aAAIiB,SAAS,KAAK7C,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoC1B,QAAQgB,UAAR,EAApC,EAA0D,CAA1D,CAAb;;AAEA;AACA,gBAAO,CAACS,IAAD,EAAOE,KAAP,EAAcC,GAAd,EAAmBC,IAAnB,EAAyBC,GAAzB,EAA8BC,MAA9B,EAAsCC,IAAtC,CAA2C,EAA3C,CAAP;AACA;AACD;AAZK,aAaD;;AAEH,iBAAO,KAAK1C,eAAL,IAAwBiB,aAAa,KAAKlB,sBAA1C,CAAP;AACA;AAGD,EA3I2C;;AA6I5C;;;AAGA4C,4BAA0B,mCAASC,UAAT,EAAoB;AAC7C,MAAIC,WAAWD,WAAWE,KAAX,CAAiB,GAAjB,CAAf;AACA,MAAGD,SAASE,MAAT,IAAmB,CAAtB,EAAwB;AACvB,QAAKC,MAAL,CAAY,8CAAZ,EAA4DH,QAA5D;AACA,UAAO,CAAP;AACA;AACD,SAAO3C,KAAK+C,KAAL,CAAW,CAACJ,SAAS,CAAT,CAAD,EAAcA,SAAS,CAAT,CAAd,EAA2BA,SAAS,CAAT,CAA3B,EAAwCH,IAAxC,CAA6C,GAA7C,CAAX,IAAgE,IAAIxC,IAAJ,GAAWgD,iBAAX,KAAiC,EAAjC,GAAsC,IAAtG,GAA6G,IAAI,EAAJ,GAAS,EAAT,GAAc,IAAlI;AACA,EAvJ2C;;AAyJ5C;;;AAGAhC,0BAAwB,iCAASiC,IAAT,EAAc;AACrC;AACA,MAAIC,UAAU,IAAIlD,IAAJ,EAAd;;AAEA;AACA,MAAIe,aAAakC,OAAOC,QAAQF,iBAAR,KAA8B,EAA9B,GAAmC,IAA1C,GAAiD,IAAI,EAAJ,GAAS,EAAT,GAAc,IAAhF;;AAEA;AACA,SAAO,IAAIhD,IAAJ,CAASe,UAAT,CAAP;AACA,EArK2C;;AAuK5C;;;;AAIAoC,uBAAqB,8BAASF,IAAT,EAAc;;AAElC,MAAIG,SAAS,KAAKpC,uBAAL,CAA6BiC,IAA7B,CAAb;;AAEA,MAAIhB,OAAOmB,OAAO1B,WAAP,EAAX;AACA,MAAIS,QAAQiB,OAAOxB,QAAP,KAAoB,CAAhC;AACA,MAAIQ,MAAMgB,OAAOtB,OAAP,EAAV;;AAEA,MAAIuB,aAAa,CAAC,KAAK3D,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoCD,IAApC,EAA0C,CAA1C,CAAD,EAA+C,KAAKvC,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoCC,KAApC,EAA2C,CAA3C,CAA/C,EAA8F,KAAKzC,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoCE,GAApC,EAAyC,CAAzC,CAA9F,EAA2II,IAA3I,CAAgJ,GAAhJ,CAAjB;;AAEA,SAAOa,UAAP;AACA,EAtL2C;;AAwL5C;;;AAGAC,0BAAwB,iCAASjB,IAAT,EAAeC,GAAf,EAAoBiB,GAApB,EAAwB;;AAE/C,MAAG,CAACjB,GAAJ,EAAQ;AACPA,SAAM,CAAN;AACA;;AAED,MAAG,CAACiB,GAAJ,EAAQ;AACPA,SAAM,CAAN;AACA;AACD,MAAI/C,UAAU,KAAKK,iBAAL,CAAuB,KAAKpB,WAAL,CAAiBsC,aAAxC,CAAd;AACA;AACAvB,UAAQgD,QAAR,CAAiBnB,IAAjB,EAAuBC,GAAvB,EAA4BiB,GAA5B,EAAiC,CAAjC;AACA;;AAEA,SAAOE,KAAKC,KAAL,CAAWlD,QAAQE,OAAR,EAAX,IAAgC,IAAIV,IAAJ,GAAWgD,iBAAX,KAAiC,EAAjC,GAAsC,IAAtE,GAA6E,IAAI,EAAJ,GAAS,EAAT,GAAc,IAAlG;AACA,EA1M2C;;AA4M5C;;;AAGAW,qBAAmB,4BAAS7C,OAAT,EAAiB;;AAEnC,MAAIN,UAAU,KAAKQ,uBAAL,CAA6B,KAAKd,eAAlC,CAAd;;AAEA;;AAEA;AACA,MAAIY,WAAW,KAAKrB,WAAL,CAAiBwB,aAAhC,EAA8C;AAC7C,UAAOT,QAAQU,MAAR,EAAP;AACA;AACD;AAHA,OAIK,IAAGJ,WAAW,KAAKrB,WAAL,CAAiB0B,cAA/B,EAA8C;;AAElD,WAAOX,QAAQY,QAAR,EAAP;AACA;AACD;AAJK,QAKA,IAAGN,WAAW,KAAKrB,WAAL,CAAiB4B,eAA/B,EAA+C;;AAEnD,YAAOb,QAAQc,UAAR,EAAP;AACA;AACD;AAJK,SAKA,IAAGR,WAAW,KAAKrB,WAAL,CAAiB8B,YAA/B,EAA4C;;AAEhD,aAAOf,QAAQgB,UAAR,EAAP;AACA;AACD;AAJK,UAKA,IAAGV,WAAW,KAAKrB,WAAL,CAAiBgC,aAA/B,EAA6C;;AAEjD,cAAOjB,QAAQkB,WAAR,EAAP;AACA;AACD;AAJK,WAKA,IAAGZ,WAAW,KAAKrB,WAAL,CAAiBkC,cAA/B,EAA8C;;AAElD,eAAOnB,QAAQoB,QAAR,EAAP;AACA;AACD;AAJK,YAKA,IAAGd,WAAW,KAAKrB,WAAL,CAAiBoC,YAA/B,EAA4C;;AAEhD,gBAAOrB,QAAQsB,OAAR,EAAP;AACA,SAHI,MAKA,IAAGhB,WAAW,KAAKrB,WAAL,CAAiBsC,aAA/B,EAA6C;;AAEjD,gBAAOvB,OAAP;AACA;AACD;AAJK,aAKD;;AAEH,iBAAO,KAAKN,eAAZ;AACA;AAED,EAlQ2C;;AAoQ5C;;AAEA;;;AAGA0D,YAAY,mBAASX,IAAT,EAAeY,QAAf,EAAwBC,IAAxB,EAA6B;;AAExC,MAAGb,OAAO,CAAV,EAAY;AACXA,UAAO,CAAP;AACA;;AAED,MAAIc,UAAU,KAAG,IAAH,GAAQ,IAAtB;AACA,MAAIC,SAASC,SAAShB,OAAMc,OAAf,CAAb;AACA,MAAIG,UAAU,CAAd;AACA,MAAG,CAACJ,IAAJ,EAAS;AACRI,aAAUD,SAAS,CAAChB,OAAOA,OAAMc,OAAb,GAAuBC,SAAOD,OAA/B,KAA0C,OAAK,IAA/C,CAAT,CAAV;AACA,GAFD,MAEK;AACJG,aAAUD,SAAShB,QAAO,OAAK,IAAZ,CAAT,CAAV;AACA;AACD,MAAIkB,SAASF,SAAShB,OAAO,IAAhB,CAAb;AACA,MAAImB,iBAAkBnB,OAAOiB,WAAW,OAAK,IAAhB,CAA7B;AACA,MAAG,CAACJ,IAAJ,EAAS;AACRM,oBAAkBnB,OAAOe,SAAOD,OAAd,GAAwBG,WAAW,OAAK,IAAhB,CAA1C;AACA;AACD,MAAI5B,MAAM2B,SAASG,kBAAkB,KAAK,IAAvB,CAAT,CAAV;AACA,MAAIC,cAAeD,iBAAiB9B,OAAO,KAAG,IAAV,CAApC;AACA,MAAIiB,MAAMU,SAASI,cAAc,IAAvB,CAAV;AACAH,YAAU,KAAKxE,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoCgC,OAApC,EAA6C,CAA7C,CAAV;AACA5B,QAAM,KAAK5C,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoCI,GAApC,EAAyC,CAAzC,CAAN;AACAiB,QAAM,KAAK7D,OAAL,CAAawC,kBAAb,CAAgC,EAAhC,EAAoCqB,GAApC,EAAyC,CAAzC,CAAN;;AAEA,MAAIe,UAAU,EAAd;AACA,MAAIT,YAAY,KAAKpE,WAAL,CAAiB8E,WAAjC,EAA6C;AAC5C,OAAGP,MAAH,EAAU;AACTM,cAAU,KAAK5E,OAAL,CAAa8E,aAAb,CAA2B,WAA3B,EAAwC,CAACR,MAAD,EAASE,OAAT,CAAxC,CAAV;AACA,IAFD,MAGI;AACHI,cAAU,KAAK5E,OAAL,CAAa8E,aAAb,CAA2B,aAA3B,EAA0C,CAACN,OAAD,EAAU5B,GAAV,EAAeiB,GAAf,CAA1C,CAAV;AACA;AACD,GAPD,MAQK,IAAIM,YAAY,KAAKpE,WAAL,CAAiBgF,cAAjC,EAAgD;AACpDH,aAAU,KAAK5E,OAAL,CAAa8E,aAAb,CAA2B,aAA3B,EAA0C,CAACN,OAAD,EAAU5B,GAAV,EAAeiB,GAAf,CAA1C,CAAV;AACA,GAFI,MAGA,IAAGM,YAAY,KAAKpE,WAAL,CAAiBiF,UAAhC,EAA2C;AAC/CJ,aAAU,KAAK5E,OAAL,CAAa8E,aAAb,CAA2B,SAA3B,EAAsC,CAAClC,GAAD,EAAMiB,GAAN,CAAtC,CAAV;AACA,GAFI,MAGA,IAAGM,YAAY,KAAKpE,WAAL,CAAiBkF,OAAhC,EAAwC;AAC5CL,aAAU,KAAK5E,OAAL,CAAa8E,aAAb,CAA2B,KAA3B,EAAkC,CAACjB,GAAD,CAAlC,CAAV;AACA,GAFI,MAGA,IAAGM,YAAY,KAAKpE,WAAL,CAAiBmF,aAAhC,EAA8C;AACzCN,aAAU,KAAK5E,OAAL,CAAa8E,aAAb,CAA2B,KAA3B,EAAkC,CAACL,MAAD,CAAlC,CAAV;AACT,GAFI,MAGA,IAAIN,YAAY,KAAKpE,WAAL,CAAiBoF,mBAAjC,EAAqD;AACzD,OAAGb,MAAH,EAAU;AACTM,cAAU,KAAK5E,OAAL,CAAa8E,aAAb,CAA2B,iBAA3B,EAA8C,CAACR,MAAD,EAASE,OAAT,EAAkB5B,GAAlB,EAAuBiB,GAAvB,CAA9C,CAAV;AACA,IAFD,MAGI;AACHe,cAAU,KAAK5E,OAAL,CAAa8E,aAAb,CAA2B,aAA3B,EAA0C,CAACN,OAAD,EAAU5B,GAAV,EAAeiB,GAAf,CAA1C,CAAV;AACA;AACD;AACD;AACO;AACP;AAVK,OAWD;AACHe,cAAU,KAAK5E,OAAL,CAAa8E,aAAb,CAA2B,aAA3B,EAA0C,CAACN,OAAD,EAAU5B,GAAV,EAAeiB,GAAf,CAA1C,CAAV;AACA;AACD,SAAOe,OAAP;AACA,EAvU2C;;AAyU5C;;;;;;AAMAQ,iBAAe,wBAASC,QAAT,EAAkB;;AAEhC,MAAGC,MAAMD,QAAN,CAAH,EAAmB;AAClBjC,UAAO,oCAAP,EAA6CmC,OAA7C;AACA,UAAO,GAAP;AACA;AACD,MAAGF,YAAY,CAAf,EAAiB;AAChB,UAAO,KAAKrF,OAAL,CAAa8E,aAAb,CAA2B,KAAKU,aAAhC,EAA+C,CAAC,CAAD,CAA/C,CAAP;AACA;;AAED;AACA,MAAIC,QAAQ1B,KAAKC,KAAL,CAAWqB,WAAS,QAApB,CAAZ;AACA,MAAGI,KAAH,EAAS;AACR,UAAOjG,IAAIkG,IAAJ,CAASC,CAAT,CAAW,eAAX,EAA4B,EAAC,SAAQF,KAAT,EAA5B,CAAP;AACA;AACD;AACAA,UAAQ1B,KAAKC,KAAL,CAAWqB,WAAS,OAApB,CAAR;AACA,MAAGI,KAAH,EAAS;AACR,UAAOjG,IAAIkG,IAAJ,CAASC,CAAT,CAAW,gBAAX,EAA6B,EAAC,SAAQF,KAAT,EAA7B,CAAP;AACA;;AAED;AACAA,UAAQ1B,KAAKC,KAAL,CAAWqB,WAAS,KAApB,CAAR;AACA,MAAGI,KAAH,EAAS;AACR,UAAOjG,IAAIkG,IAAJ,CAASC,CAAT,CAAW,kBAAX,EAA+B,EAAC,SAAQF,KAAT,EAA/B,CAAP;AACA;;AAED;AACA,SAAOjG,IAAIkG,IAAJ,CAASC,CAAT,CAAW,eAAX,EAA4B,EAAC,SAAQ5B,KAAKC,KAAL,CAAWqB,WAAS,IAApB,CAAT,EAA5B,CAAP;AACA,EA5W2C;;AA8W5C;AACAO,kBAAgB,yBAASC,OAAT,EAAkB1B,QAAlB,EAA2B;AAC1C,MAAI2B,iBAAiB,KAAK3E,iBAAL,EAArB;AACA,MAAI4E,aAAaF,UAAUC,cAA3B;AACA,MAAGC,cAAc,CAAjB,EAAmB;AAClB,UAAO,UAAP;AACA;;AAED;AACA,MAAG,CAAC5B,QAAJ,EAAa;AACZA,cAAW,KAAKpE,WAAL,CAAiBgF,cAA5B;AACA;;AAED,SAAO,KAAKb,SAAL,CAAe6B,UAAf,EAA2B5B,QAA3B,CAAP;AACA,EA5X2C;AA6X7C;AACC6B,mBAAiB,0BAASH,OAAT,EAAkB1B,QAAlB,EAA2B;AAC3C,MAAI2B,iBAAiB,KAAK3E,iBAAL,EAArB;AACA,MAAI4E,aAAaD,iBAAiBD,OAAlC;AACA,MAAGE,cAAc,CAAjB,EAAmB;AAClB,UAAO,UAAP;AACA;;AAED;AACA,MAAG,CAAC5B,QAAJ,EAAa;AACZA,cAAW,KAAKpE,WAAL,CAAiBgF,cAA5B;AACA;;AAED,SAAO,KAAKb,SAAL,CAAe6B,UAAf,EAA2B5B,QAA3B,EAAoC,CAApC,CAAP;AACA,EA3Y2C;AA4Y5C;AACA8B,uBAAqB,8BAASC,MAAT,EAAiB/B,QAAjB,EAA0B;AAC9C,SAAO,KAAKyB,eAAL,CAAqBM,SAAO,IAA5B,EAAkC/B,QAAlC,CAAP;AACA,EA/Y2C;AAgZ5C;AACAgC,wBAAsB,+BAASC,QAAT,EAAmBjC,QAAnB,EAA4B;AACjD,SAAO,KAAK6B,gBAAL,CAAsBI,WAAS,IAA/B,EAAqCjC,QAArC,CAAP;AACA,EAnZ2C;;AAsZ5C;;;;;;AAMAkC,mBAAiB,0BAASC,QAAT,EAAkB;AAClC,MAAIR,iBAAiB,KAAK3E,iBAAL,EAArB;AACA,MAAI4E,aAAaO,WAAWR,cAA5B;;AAEA,MAAGC,cAAc,CAAjB,EAAmB;AAClB,UAAO,CAAP;AACA;;AAED;AACA,MAAIN,QAAQ1B,KAAKC,KAAL,CAAW+B,aAAW,QAAtB,CAAZ;AACA,MAAGN,KAAH,EAAS;AACR,UAAOjG,IAAIkG,IAAJ,CAASC,CAAT,CAAW,WAAX,EAAwB,EAAC,SAAQF,KAAT,EAAxB,CAAP;AACA;AACD;AACAA,UAAQ1B,KAAKC,KAAL,CAAW+B,aAAW,OAAtB,CAAR;AACA,MAAGN,KAAH,EAAS;AACR,UAAOjG,IAAIkG,IAAJ,CAASC,CAAT,CAAW,YAAX,EAAyB,EAAC,SAAQF,KAAT,EAAzB,CAAP;AACA;;AAED;AACAA,UAAQ1B,KAAKC,KAAL,CAAW+B,aAAW,KAAtB,CAAR;AACA,MAAGN,KAAH,EAAS;AACR,UAAOjG,IAAIkG,IAAJ,CAASC,CAAT,CAAW,WAAX,EAAwB,EAAC,SAAQF,KAAT,EAAxB,CAAP;AACA;;AAED;AACA,SAAOjG,IAAIkG,IAAJ,CAASC,CAAT,CAAW,WAAX,EAAwB,EAAC,SAAQ5B,KAAKC,KAAL,CAAW+B,aAAW,IAAtB,CAAT,EAAxB,CAAP;AACA;;AAvb2C,CAArB,CAAxB;;AA2bA,IAAIQ,sBAAsB,IAA1B;;AAEA;;;;AAIAC,QAAQC,QAAR,GAAmB,YAAU;AAC5B,KAAI,CAACF,mBAAL,EACCA,sBAAsB,IAAI7G,iBAAJ,EAAtB;;AAED,QAAO6G,mBAAP;AAEA,CAND","file":"ServerTimeManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\dbmanager\\ServerTime","sourcesContent":["/*\n *  ----------------------------------------------------------------------------------------------------\n *  @copyright: Copyright (c) 2004, 2010 Xiamen DDM Network Technology Co.,Ltd., All rights reserved.\n *  ----------------------------------------------------------------------------------------------------\n *  @package ServerTimeManager\n *  @todo: 服务器时间同步\n *  \n *  @author hongdian\n *  @date 2014-10-30 16:04\n *  @version 1.0\n *  \n *  修改时间 修改人 修改内容\n *  -------------------------------------------------------------------------------\n *  \n */\nvar app = require('app');\n\n/**\n * 构造\n */\nvar ServerTimeManager = app.BaseClass.extend({\n\t\n\t/**\n\t * 初始化\n\t */\n\tInit:function(){\n\t\tthis.JS_Name = \"ServerTimeManager\";\n\n\t\tthis.ShareDefine = app.ShareDefine();\n\t\tthis.ComTool = app.ComTool();\n\n\t\tthis.Reload();\n\n\t\tthis.Log(\"create ServerTimeManager.js\");\n\t},\n\n\t/**\n\t * 重登\n\t */\n\tReload:function(){\n\t\t//收到服务器时间的客户端tick\n\t\tthis.syncServerDataTimeTick = 0;\n\t\t//收到的服务器时间豪秒形式值\n\t\tthis.serverIntMsTime = 0;\n\t\t//收到服务器时间的 Date时间形式\n\t\tthis.serverDataTime = new Date();\n\t\t//收到账号服务器登陆token的客户端tick\n\t\tthis.logInGameTick = 0;\n\t\t//收到服务器首次开服时间\n\t\tthis.serverStartTime = 0;\n\t},\n\n\t//--------------收包---------------------\n\t/**\n\t * 接收封包\n\t */\n\tInitLoginData:function(serverPack){\n\t\tthis.SetServerTime(serverPack[\"time\"]);\n\t\tthis.SetServerStartTime(serverPack[\"startServerTime\"]);\n\t},\n\t\n\n\t//---------------设置接口------------------------\n\n\n\t/**\n\t * 设置服务器时间\n\t */\n\tSetServerTime:function(curServerTick){\n\n\t\tlet curDate = new Date();\n\t\tlet nowTick = curDate.getTime();\n\n\t\tthis.serverIntMsTime = curServerTick;\n\t\tthis.serverDataTime.setTime(this.serverIntMsTime);\n\t\tthis.syncServerDataTimeTick = nowTick;\n\n\t\treturn this.serverDataTime\n\n\t},\n\n\t/**\n\t * 设置服务器首次开服时间\n\t */\n\tSetServerStartTime:function(startTime){\n\t\tthis.serverStartTime = startTime;\n\t},\n\n\t//-------------获取接口---------------------------\n\t/**\n\t * 获取服务器时间类型\n\t */\n\tGetServerTimeData:function(getType){\n\t\tif (!this.serverIntMsTime){\n\t\t\treturn 0;\n\t\t}\n\n\t\tlet curNowTime = new Date().getTime();\n\n\t\tlet curDate = this.GetServerTimeByTimeTick(this.serverIntMsTime + curNowTime - this.syncServerDataTimeTick);\n\n\t\t// 星期（0为周日）\n\t\tif (getType == this.ShareDefine.GetServerWeek){\n\t\t\treturn curDate.getDay();\n\t\t}\n\t\t// 小时（0到23）\n\t\telse if(getType == this.ShareDefine.GetServerHours){\n\n\t\t\treturn curDate.getHours();\n\t\t}\n\t\t// 分钟（0到59）\n\t\telse if(getType == this.ShareDefine.GetServerMinSec){\n\n\t\t\treturn curDate.getMinutes();\n\t\t}\n\t\t// 秒（0到59）\n\t\telse if(getType == this.ShareDefine.GetServerSec){\n\n\t\t\treturn curDate.getSeconds();\n\t\t}\n\t\t// 年\n\t\telse if(getType == this.ShareDefine.GetServerYear){\n\n\t\t\treturn curDate.getFullYear();\n\t\t}\n\t\t// 月（0表示一月，11表示十二月）\n\t\telse if(getType == this.ShareDefine.GetServerMonth){\n\n\t\t\treturn curDate.getMonth();\n\t\t}\n\t\t// 日（1到31）\n\t\telse if(getType == this.ShareDefine.GetServerDay){\n\n\t\t\treturn curDate.getDate();\n\t\t}\n\n\t\telse if(getType == this.ShareDefine.GetServerDate){\n\n\t\t\treturn curDate;\n\t\t}\n\t\telse if(getType == this.ShareDefine.GetServerDateString){\n\n\t\t\tlet year = this.ComTool.StringAddNumSuffix(\"\", curDate.getFullYear(), 4);\n\t\t\tlet month = this.ComTool.StringAddNumSuffix(\"\", curDate.getMonth() + 1, 2);\n\t\t\tlet day = this.ComTool.StringAddNumSuffix(\"\", curDate.getDate(), 2);\n\t\t\tlet hour = this.ComTool.StringAddNumSuffix(\"\", curDate.getHours(), 2);\n\t\t\tlet min = this.ComTool.StringAddNumSuffix(\"\", curDate.getMinutes(), 2);\n\t\t\tlet second = this.ComTool.StringAddNumSuffix(\"\", curDate.getSeconds(), 2);\n\n\t\t\t//20160101231701\n\t\t\treturn [year, month, day, hour, min, second].join(\"\");\n\t\t}\n\t\t// 服务器当前毫秒数(不需要转化为本地时间,只是一个整数值,与其他服务器时间整数值比较大小用)\n\t\telse{\n\n\t\t\treturn this.serverIntMsTime + (curNowTime - this.syncServerDataTimeTick)\n\t\t}\n\n\n\t},\n\n\t/**\n\t * 更加时间字符串获取服务器时间毫秒值 2016-1-18 -> 1454234400000\n\t */\n\tGetServerTimeByTimeString:function(timeString){\n\t\tlet dateList = timeString.split(\"-\");\n\t\tif(dateList.length != 3){\n\t\t\tthis.ErrLog(\"GetServerTimeByTimeString dateList(%s) error\", dateList);\n\t\t\treturn 0\n\t\t}\n\t\treturn Date.parse([dateList[1], dateList[2], dateList[0]].join(\"/\")) - new Date().getTimezoneOffset() * 60 * 1000 - 8 * 60 * 60 * 1000;\n\t},\n\n\t/**\n\t * 通过毫秒整数获取服务器对应时间对象 1454234400000 - > Date()\n\t */\n\tGetServerTimeByTimeTick:function(tick){\n\t\t//创建一个本地时间对象\n\t\tlet nowDate = new Date();\n\n\t\t//计算服务器对应的时间tick 需要加上时区查\n\t\tlet curNowTime = tick + nowDate.getTimezoneOffset() * 60 * 1000 + 8 * 60 * 60 * 1000;\n\n\t\t//加上时区查后生成的时间对象才是和服务器时间同步的对象\n\t\treturn new Date(curNowTime);\n\t},\n\n\t/**\n\t * 获取当前时间字符串格式\n\t * @returns {String} 2014-11-06\n\t */\n\tGetDateTickToTimeStr:function(tick){\n\n\t\tvar myDate = this.GetServerTimeByTimeTick(tick);\n\n\t\tvar year = myDate.getFullYear();\n\t\tvar month = myDate.getMonth() + 1;\n\t\tvar day = myDate.getDate();\n\n\t\tvar dateString = [this.ComTool.StringAddNumSuffix(\"\", year, 4), this.ComTool.StringAddNumSuffix(\"\", month, 2), this.ComTool.StringAddNumSuffix(\"\", day, 2)].join(\"-\");\n\n\t\treturn dateString\n\t},\n\n\t/**\n\t * 获取指定点数对应的服务器时间tick值\n\t */\n\tGetServerTimeTickByTime:function(hour, min, sec){\n\n\t\tif(!min){\n\t\t\tmin = 0;\n\t\t}\n\n\t\tif(!sec){\n\t\t\tsec = 0;\n\t\t}\n\t\tlet curDate = this.GetServerTimeData(this.ShareDefine.GetServerDate);\n\t\t//设置为0点时间\n\t\tcurDate.setHours(hour, min, sec, 0);\n\t\t//this.Log(\"GetServerTimeTickByTime {1}-{2}-{3} {4}:{5}:{6},{7}\", curDate.getFullYear(), curDate.getMonth(), curDate.getDate(), curDate.getHours(),curDate.getMinutes(),curDate.getSeconds(), curDate.getDay());\n\n\t\treturn Math.floor(curDate.getTime()) - new Date().getTimezoneOffset() * 60 * 1000 - 8 * 60 * 60 * 1000;\n\t},\n\n\t/**\n\t * 获取服务器首次开服时间\n\t */\n\tGetServerStartTime:function(getType){\n\n\t\tlet curDate = this.GetServerTimeByTimeTick(this.serverStartTime);\n\n\t\t//this.Log(\"{1}-{2}-{3} {4}:{5}:{6},{7}\", curDate.getFullYear(), curDate.getMonth(), curDate.getDate(), curDate.getHours(),curDate.getMinutes(),curDate.getSeconds(), curDate.getDay());\n\n\t\t// 星期（0为周日）\n\t\tif (getType == this.ShareDefine.GetServerWeek){\n\t\t\treturn curDate.getDay();\n\t\t}\n\t\t// 小时（0到23）\n\t\telse if(getType == this.ShareDefine.GetServerHours){\n\n\t\t\treturn curDate.getHours();\n\t\t}\n\t\t// 分钟（0到59）\n\t\telse if(getType == this.ShareDefine.GetServerMinSec){\n\n\t\t\treturn curDate.getMinutes();\n\t\t}\n\t\t// 秒（0到59）\n\t\telse if(getType == this.ShareDefine.GetServerSec){\n\n\t\t\treturn curDate.getSeconds();\n\t\t}\n\t\t// 年\n\t\telse if(getType == this.ShareDefine.GetServerYear){\n\n\t\t\treturn curDate.getFullYear();\n\t\t}\n\t\t// 月（0表示一月，11表示十二月）\n\t\telse if(getType == this.ShareDefine.GetServerMonth){\n\n\t\t\treturn curDate.getMonth();\n\t\t}\n\t\t// 日（1到31）\n\t\telse if(getType == this.ShareDefine.GetServerDay){\n\n\t\t\treturn curDate.getDate();\n\t\t}\n\n\t\telse if(getType == this.ShareDefine.GetServerDate){\n\n\t\t\treturn curDate;\n\t\t}\n\t\t// 服务器当前毫秒数(不需要转化为本地时间,只是一个整数值,与其他服务器时间整数值比较大小用)\n\t\telse{\n\n\t\t\treturn this.serverStartTime;\n\t\t}\n\n\t},\n\n\t//-------------------操作接口----------------------------\n\n\t/**\n\t * 转换tick为时分秒字符串\n\t */\n\tTickToStr : function(tick, showType,type){\n\n\t\tif(tick < 0){\n\t\t\ttick = 0;\n\t\t}\n\n\t\tlet dayTick = 24*3600*1000;\n\t\tlet dayNum = parseInt(tick /dayTick);\n\t\tlet hourNum = 0;\n\t\tif(!type){\n\t\t\thourNum = parseInt((tick - tick /dayTick - dayNum*dayTick)/ (3600*1000));\n\t\t}else{\n\t\t\thourNum = parseInt(tick/ (3600*1000));\n\t\t}\n\t\tlet Second = parseInt(tick / 1000);\n\t\tlet intervalMinSec = (tick - hourNum * (3600*1000));\n\t\tif(!type){\n\t\t\tintervalMinSec = (tick - dayNum*dayTick - hourNum * (3600*1000));\n\t\t}\n\t\tlet min = parseInt(intervalMinSec / (60 * 1000))\n\t\tlet intervalSec = (intervalMinSec - min * (60*1000))\n\t\tlet sec = parseInt(intervalSec / 1000)\n\t\thourNum = this.ComTool.StringAddNumSuffix(\"\", hourNum, 2);\n\t\tmin = this.ComTool.StringAddNumSuffix(\"\", min, 2);\n\t\tsec = this.ComTool.StringAddNumSuffix(\"\", sec, 2);\n\n\t\tlet showStr = \"\";\n\t\tif (showType == this.ShareDefine.ShowDayHour){\n\t\t\tif(dayNum){\n\t\t\t\tshowStr = this.ComTool.StringReplace(\"{1}天{2}小时\", [dayNum, hourNum]);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tshowStr = this.ComTool.StringReplace(\"{1}:{2}:{3}\", [hourNum, min, sec]);\n\t\t\t}\n\t\t}\n\t\telse if (showType == this.ShareDefine.ShowHourMinSec){\n\t\t\tshowStr = this.ComTool.StringReplace(\"{1}:{2}:{3}\", [hourNum, min, sec]);\n\t\t}\n\t\telse if(showType == this.ShareDefine.ShowMinSec){\n\t\t\tshowStr = this.ComTool.StringReplace(\"{1}:{2}\", [min, sec]);\n\t\t}\n\t\telse if(showType == this.ShareDefine.ShowSec){\n\t\t\tshowStr = this.ComTool.StringReplace(\"{1}\", [sec]);\n\t\t}\n\t\telse if(showType == this.ShareDefine.ShowSecondSec){\n            showStr = this.ComTool.StringReplace(\"{1}\", [Second]);\n\t\t}\n\t\telse if (showType == this.ShareDefine.DayHourMinuteSecond){\n\t\t\tif(dayNum){\n\t\t\t\tshowStr = this.ComTool.StringReplace(\"{1}天{2}:{3}:{4}\", [dayNum, hourNum, min, sec]);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tshowStr = this.ComTool.StringReplace(\"{1}:{2}:{3}\", [hourNum, min, sec]);\n\t\t\t}\n\t\t}\n\t\t// else if(showType == this.ShareDefine.YearMonthDayHourMinuteSecond){\n         //    showStr = this.ComTool.StringReplace(\"{1}/{2}/{3} {4}:{5}:{6}\", [Year, Month, Day, Hour, Minute,Second]);\n\t\t// }\n\t\telse{\n\t\t\tshowStr = this.ComTool.StringReplace(\"{1}:{2}:{3}\", [hourNum, min, sec]);\n\t\t}\n\t\treturn showStr\n\t},\n\n\t/**\n\t * 获取已过时间的字符串\n\t * @param {Number} passSec 已过去秒数\n\t * @returns {String} 优先顺序：几天前、几小时前、几分钟前、几秒前\n\t * @remarks {}\n\t */\n\tGetPassTimeStr:function(passTick){\n\n\t\tif(isNaN(passTick)){\n\t\t\tErrLog(\"GetPassTimeStr passSec(%s) is NaN \", passSec);\n\t\t\treturn \"0\";\n\t\t}\n\t\tif(passTick <= 0){\n\t\t\treturn this.ComTool.StringReplace(this.BeforeSec_Str, [1]);\n\t\t}\n\n\t\t// 几天前 24*60*60*1000 = 86400000\n\t\tlet value = Math.floor(passTick/86400000);\n\t\tif(value){\n\t\t\treturn app.i18n.t(\"BeforeDay_Str\", {\"Value\":value});\n\t\t}\n\t\t// 几小时前 60*60*1000 = 3600000\n\t\tvalue = Math.floor(passTick/3600000);\n\t\tif(value){\n\t\t\treturn app.i18n.t(\"BeforeHour_Str\", {\"Value\":value});\n\t\t}\n\n\t\t// 几分钟前 60*1000\n\t\tvalue = Math.floor(passTick/60000);\n\t\tif(value){\n\t\t\treturn app.i18n.t(\"BeforeMinute_Str\", {\"Value\":value});\n\t\t}\n\n\t\t// 几秒前\n\t\treturn app.i18n.t(\"BeforeSec_Str\", {\"Value\":Math.floor(passTick/1000)});\n\t},\n\n\t//获取结束tick相对服务器时间的倒计时\n\tGetCDTimeString:function(endTick, showType){\n\t\tlet serverTimeTick = this.GetServerTimeData();\n\t\tlet remainTick = endTick - serverTimeTick;\n\t\tif(remainTick <= 0){\n\t\t\treturn \"00:00:00\";\n\t\t}\n\n\t\t//默认没传的话返回00:00:00格式\n\t\tif(!showType){\n\t\t\tshowType = this.ShareDefine.ShowHourMinSec;\n\t\t}\n\n\t\treturn this.TickToStr(remainTick, showType);\n\t},\n//获取结束tick相对服务器时间的正计时\n\tGetMictimeString:function(endTick, showType){\n\t\tlet serverTimeTick = this.GetServerTimeData();\n\t\tlet remainTick = serverTimeTick - endTick;\n\t\tif(remainTick <= 0){\n\t\t\treturn \"00:00:00\";\n\t\t}\n\n\t\t//默认没传的话返回00:00:00格式\n\t\tif(!showType){\n\t\t\tshowType = this.ShareDefine.ShowHourMinSec;\n\t\t}\n\n\t\treturn this.TickToStr(remainTick, showType,1);\n\t},\n\t//获取结束sec相对的服务器倒计时\n\tGetCDTimeStringBySec:function(endSec, showType){\n\t\treturn this.GetCDTimeString(endSec*1000, showType);\n\t},\n\t//根据获取时间戳相对服务器正计时\n\tGetMictimeStringBySec:function(mictimek, showType){\n\t\treturn this.GetMictimeString(mictimek*1000, showType);\n\t},\n\n\n\t/**\n\t * 获取毫秒数相对当前服务器时间剩余多少时间到期\n\t * @param {Number} timeTick 毫秒数\n\t * @returns {String} 优先顺序：剩余几天、剩余几时、剩余几分、剩余几秒,已过期\n\t * @remarks {}\n\t */\n\tGetRemainTimeStr:function(timeTick){\n\t\tlet serverTimeTick = this.GetServerTimeData();\n\t\tlet remainTick = timeTick - serverTimeTick;\n\n\t\tif(remainTick <= 0){\n\t\t\treturn 0;\n\t\t}\n\n\t\t// 几天前 24*60*60*1000 = 86400000\n\t\tlet value = Math.floor(remainTick/86400000);\n\t\tif(value){\n\t\t\treturn app.i18n.t(\"RemainDay\", {\"Value\":value});\n\t\t}\n\t\t// 几小时前 60*60*1000 = 3600000\n\t\tvalue = Math.floor(remainTick/3600000);\n\t\tif(value){\n\t\t\treturn app.i18n.t(\"RemainHour\", {\"Value\":value});\n\t\t}\n\n\t\t// 几分钟前 60*1000\n\t\tvalue = Math.floor(remainTick/60000);\n\t\tif(value){\n\t\t\treturn app.i18n.t(\"RemainMin\", {\"Value\":value});\n\t\t}\n\n\t\t// 几秒前\n\t\treturn app.i18n.t(\"RemainSec\", {\"Value\":Math.floor(remainTick/1000)});\n\t},\n\n})\n\nvar g_ServerTimeManager = null;\n\n/**\n * 获取单例\n * @returns {ServerTimeManager}\n */\nexports.GetModel = function(){\n\tif (!g_ServerTimeManager)\n\t\tg_ServerTimeManager = new ServerTimeManager()\n\n\treturn g_ServerTimeManager\n\t\n}\n"]}