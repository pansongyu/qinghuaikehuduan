{"version":3,"sources":["SceneEffectLayer.js"],"names":["app","require","cc","Class","extends","properties","OnCreate","sceneType","JS_Name","join","effectDict","EffectManager","node","on","Event_EffectAnimationEnd","event","modelComponent","detail","DeleteSceneEffect","AddSceneEffect","effectName","effectRes","repeatCount","userData","that","CreateEffectByEffectRes","then","effectComponent","OnCreateEffectEnd","catch","error","ErrLog","stack","hasOwnProperty","Log","AddModelToParent","animationState","ShowEffect","wrapMode","WrapMode","Default","Loop","GetModelProperty","DeleteEffect","OnBeforeExitScene","DeleteEffectByDict"],"mappings":";;;;;;AAAA;;;AAGA,IAAIA,MAAMC,QAAQ,KAAR,CAAV;;AAEAC,GAAGC,KAAH,CAAS;AACRC,UAASH,QAAQ,eAAR,CADD;;AAGRI,aAAY,EAHJ;;AAMRC,WAAU,kBAAUC,SAAV,EAAqB;AAC9B,OAAKC,OAAL,GAAe,CAACD,SAAD,EAAY,kBAAZ,EAAgCE,IAAhC,CAAqC,GAArC,CAAf;;AAEA;AACA,OAAKC,UAAL,GAAkB,EAAlB;;AAEA,OAAKC,aAAL,GAAqBX,IAAIW,aAAJ,EAArB;;AAEA,OAAKC,IAAL,CAAUC,EAAV,CAAa,oBAAb,EAAmC,KAAKC,wBAAxC,EAAkE,IAAlE;AACA,EAfO;;AAiBR;AACAA,2BAAyB,kCAASC,KAAT,EAAe;AACvC,MAAIC,iBAAiBD,MAAME,MAAN,CAAa,OAAb,CAArB;AACA;AACA;AACA,OAAKC,iBAAL,CAAuBF,cAAvB;AACA,EAvBO;;AAyBR;;AAEA;AACAG,iBAAe,wBAASC,UAAT,EAAqBC,SAArB,EAA0D;AAAA,MAA1BC,WAA0B,uEAAd,CAAc;AAAA,MAAXC,QAAW,uEAAF,CAAE;;;AAExE,MAAIC,OAAO,IAAX;;AAEA,SAAO,KAAKb,aAAL,CAAmBc,uBAAnB,CAA2CL,UAA3C,EAAuDC,SAAvD,EAAkEE,QAAlE,EACHG,IADG,CACE,UAASC,eAAT,EAAyB;AAC9B,UAAOH,KAAKI,iBAAL,CAAuBR,UAAvB,EAAmCO,eAAnC,EAAoDL,WAApD,CAAP;AACA,GAHG,EAIHO,KAJG,CAIG,UAASC,KAAT,EAAe;AACrBN,QAAKO,MAAL,CAAY,8BAAZ,EAA4CX,UAA5C,EAAwDC,SAAxD,EAAmEE,QAAnE,EAA6EO,MAAME,KAAnF;AACA,GANG,CAAP;AAOA,EAvCO;;AAyCR;AACAJ,oBAAkB,2BAASR,UAAT,EAAqBO,eAArB,EAAsCL,WAAtC,EAAkD;AACnE,MAAG,CAACK,eAAJ,EAAoB;AACnB,QAAKI,MAAL,CAAY,4BAAZ,EAA0CX,UAA1C;AACA;AACA;;AAED,MAAG,KAAKV,UAAL,CAAgBuB,cAAhB,CAA+Bb,UAA/B,CAAH,EAA8C;AAC7C,QAAKc,GAAL,CAAS,2CAAT,EAAsDd,UAAtD;AACA;AACA;;AAEDO,kBAAgBQ,gBAAhB,CAAiC,KAAKvB,IAAtC,EAA4C,KAAKA,IAAjD;;AAEA,MAAIwB,iBAAiBT,gBAAgBU,UAAhB,EAArB;AACA,MAAG,CAACD,cAAJ,EAAmB;AAClB,QAAKL,MAAL,CAAY,mCAAZ;AACA;AACA;AACD;AACA,MAAGT,WAAH,EAAe;AACdc,kBAAeE,QAAf,GAA2BpC,GAAGqC,QAAH,CAAYC,OAAvC;AACAJ,kBAAed,WAAf,GAA6BA,WAA7B;AACA,GAHD,MAII;AACH;AACAc,kBAAeE,QAAf,GAA2BpC,GAAGqC,QAAH,CAAYE,IAAvC;AACA;;AAED,OAAK/B,UAAL,CAAgBU,UAAhB,IAA8BO,eAA9B;;AAEA,SAAOA,eAAP;AACA,EAzEO;;AA2ER;AACAT,oBAAkB,2BAASF,cAAT,EAAwB;AACzC,MAAII,aAAaJ,eAAe0B,gBAAf,CAAgC,YAAhC,CAAjB;AACA,SAAO,KAAKhC,UAAL,CAAgBU,UAAhB,CAAP;AACA,OAAKT,aAAL,CAAmBgC,YAAnB,CAAgC3B,cAAhC;AACA,EAhFO;;AAkFR;AACA4B,oBAAkB,6BAAU;AAC3B,OAAKjC,aAAL,CAAmBkC,kBAAnB,CAAsC,KAAKnC,UAA3C;AACA,OAAKA,UAAL,GAAkB,EAAlB;AACA;AAtFO,CAAT","file":"SceneEffectLayer.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\scene\\Layer","sourcesContent":["/*\n 场景特效层\n */\nvar app = require(\"app\");\n\ncc.Class({\n\textends: require(\"BaseComponent\"),\n\n\tproperties: {\n\t},\n\n\tOnCreate: function (sceneType) {\n\t\tthis.JS_Name = [sceneType, \"SceneEffectLayer\"].join(\"_\");\n\n\t\t//场景特效字典\n\t\tthis.effectDict = {};\n\n\t\tthis.EffectManager = app.EffectManager();\n\n\t\tthis.node.on(\"EffectAnimationEnd\", this.Event_EffectAnimationEnd, this);\n\t},\n\n\t//--------回调函数-----------------\n\tEvent_EffectAnimationEnd:function(event){\n\t\tlet modelComponent = event.detail[\"Model\"];\n\t\t//let animationName = event.detail[\"AnimationName\"];\n\t\t//特效播放结束删除掉\n\t\tthis.DeleteSceneEffect(modelComponent);\n\t},\n\n\t//------------特效相关-----------------------\n\n\t//创建场景特效\n\tAddSceneEffect:function(effectName, effectRes, repeatCount=0, userData=0){\n\n\t\tlet that = this;\n\n\t\treturn this.EffectManager.CreateEffectByEffectRes(effectName, effectRes, userData)\n\t\t\t\t\t.then(function(effectComponent){\n\t\t\t\t\t\treturn that.OnCreateEffectEnd(effectName, effectComponent, repeatCount);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function(error){\n\t\t\t\t\t\tthat.ErrLog(\"AddSceneEffect(%s, %s,%s):%s\", effectName, effectRes, userData, error.stack);\n\t\t\t\t\t})\n\t},\n\n\t//创建特效成功回调\n\tOnCreateEffectEnd:function(effectName, effectComponent, repeatCount){\n\t\tif(!effectComponent){\n\t\t\tthis.ErrLog(\"OnCreateEffectEnd(%s) fail\", effectName);\n\t\t\treturn\n\t\t}\n\n\t\tif(this.effectDict.hasOwnProperty(effectName)){\n\t\t\tthis.Log(\"OnCreateEffectEnd effectDict have find:%s\", effectName);\n\t\t\treturn\n\t\t}\n\n\t\teffectComponent.AddModelToParent(this.node, this.node);\n\n\t\tlet animationState = effectComponent.ShowEffect();\n\t\tif(!animationState){\n\t\t\tthis.ErrLog(\"OnCreateEffectEnd ShowEffect fail\");\n\t\t\treturn\n\t\t}\n\t\t//如果是0代表循环播放\n\t\tif(repeatCount){\n\t\t\tanimationState.wrapMode  = cc.WrapMode.Default;\n\t\t\tanimationState.repeatCount = repeatCount;\n\t\t}\n\t\telse{\n\t\t\t//需要注意的是，修改wrapMode时，会重置time以及repeatCount\n\t\t\tanimationState.wrapMode  = cc.WrapMode.Loop;\n\t\t}\n\n\t\tthis.effectDict[effectName] = effectComponent;\n\n\t\treturn effectComponent\n\t},\n\n\t//删除特效\n\tDeleteSceneEffect:function(modelComponent){\n\t\tlet effectName = modelComponent.GetModelProperty(\"EffectName\");\n\t\tdelete this.effectDict[effectName];\n\t\tthis.EffectManager.DeleteEffect(modelComponent);\n\t},\n\n\t//场景准备退出前\n\tOnBeforeExitScene:function(){\n\t\tthis.EffectManager.DeleteEffectByDict(this.effectDict);\n\t\tthis.effectDict = {};\n\t},\n});\n"]}