{"version":3,"sources":["SoundManager.js"],"names":["app","require","SoundManager","BaseClass","extend","Init","JS_Name","SysDataManager","LocalDataManager","Sound","GetTableDict","volume","loadSoundNameList","Log","PlayBackMusic","soundName","filePath","backVolume","GetConfigProperty","bluebird","resolve","soundInfo","ErrLog","InArray","WarnLog","push","that","isLoop","promisefunc","reject","cc","loader","loadRes","AudioClip","error","clip","Remove","StopAllSound","soundID","audioEngine","play","PlaySound","spSound","spVolume","PauseAllSound","pauseAll","PauseSound","audioID","pause","ResumeAllSound","resumeAll","ResumeSound","resume","stopAll","StopSoundByAudioID","stop","ClearSound","uncache","url","raw","ClearAllSound","uncacheAll","g_SoundManager","exports","GetModel"],"mappings":"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","file":"SoundManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\sound","sourcesContent":["/*\n 声音管理器\n */\nvar app = require('app');\n\nvar SoundManager = app.BaseClass.extend({\n\n\tInit:function(){\n\t\tthis.JS_Name = \"SoundManager\";\n\n\t\tthis.SysDataManager = app.SysDataManager();\n\t\tthis.LocalDataManager = app.LocalDataManager();\n\t\tthis.Sound = this.SysDataManager.GetTableDict(\"Sound\");\n\t\t//音量\n\t\tthis.volume = 1;\n\n\t\tthis.loadSoundNameList = [];\n\t\tthis.Log(\"Init\");\n\t},\n\n\n\t//播放背景音乐\n\tPlayBackMusic:function(soundName, filePath = \"\"){\n\t\t// let backMusic = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"BackMusic\");\n\t\tlet backVolume = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"BackVolume\");\n\t\t//如果关闭音效\n\t\tif(!backVolume){\n\t\t\treturn app.bluebird.resolve(0)\n\t\t}\n\t\tif (filePath == \"\") {\n\t\t\tlet soundInfo = this.Sound[soundName];\n\t\t\tif(!soundInfo){\n\t\t\t\tthis.ErrLog(\"PlayBackMusic(%s) not find\", soundName);\n\t\t\t\treturn app.bluebird.resolve(0)\n\t\t\t}\n\t\t\tfilePath = soundInfo[\"SoundPath\"];\n\t\t}else{\n\t\t\tfilePath = filePath;\n\t\t}\n\n\t\tif(this.loadSoundNameList.InArray(soundName)){\n\t\t\tthis.WarnLog(\"PlayBackMusic loadSoundNameList(%s) have find\", soundName);\n\t\t\treturn app.bluebird.resolve(0)\n\t\t}\n\n\t\tthis.loadSoundNameList.push(soundName);\n\t\tvar that = this;\n\n\t\tlet isLoop = true;\n\t\tlet promisefunc = function(resolve, reject){\n\t\t\tcc.loader.loadRes(filePath, cc.AudioClip, function(error, clip){\n\n\t\t\t\tif(error && error != true){\n\t\t\t\t\treject(error);\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthat.loadSoundNameList.Remove(soundName);\n\t\t\t\tthat.StopAllSound();\n\t\t\t\tlet soundID = cc.audioEngine.play(clip, isLoop, backVolume);\n\t\t\t\tresolve(soundID);\n\t\t\t})};\n\t\treturn new app.bluebird(promisefunc);\n\t},\n\n\t//播放音效(返回audioID)\n\tPlaySound:function(soundName, filePath = \"\", isLoop = false){\n\n\t\tlet spSound = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"SpSound\");\n\t\tlet spVolume = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"SpVolume\");\n\t\t//如果关闭音效\n\t\tif(!spSound){\n\t\t\treturn app.bluebird.resolve(0)\n\t\t}\n\t\tif (filePath == \"\") {\n\t\t\tlet soundInfo = this.Sound[soundName];\n\t\t\tif(!soundInfo){\n\t\t\t\tthis.ErrLog(\"PlaySound(%s) not find\", soundName);\n\t\t\t\treturn app.bluebird.resolve(0)\n\t\t\t}\n\t\t\tfilePath = soundInfo[\"SoundPath\"];\n\t\t}else{\n\t\t\tfilePath = filePath;\n\t\t}\n\t\tif(!isLoop){\n\t\t\tisLoop = false;\n\t\t}\n\n\t\tif(this.loadSoundNameList.InArray(soundName)){\n\t\t\tthis.WarnLog(\"loadSoundNameList(%s) have find\", soundName);\n\t\t\treturn app.bluebird.resolve(0)\n\t\t}\n\n\t\tthis.loadSoundNameList.push(soundName);\n\t\tvar that = this;\n\n\t\tlet promisefunc = function(resolve, reject){\n\t\t\t\t\t\t\t\t\t\t\t\t\tcc.loader.loadRes(filePath, cc.AudioClip, function(error, clip){\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(error && error != true){\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.loadSoundNameList.Remove(soundName);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet soundID = cc.audioEngine.play(clip, isLoop, spVolume)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tresolve(soundID);\n\t\t\t\t\t\t\t\t\t\t\t\t\t})};\n\t\treturn new app.bluebird(promisefunc);\n\t},\n\n\t//暂停所有音效\n\tPauseAllSound:function(){\n\t\tcc.audioEngine.pauseAll();\n\t},\n\t//暂停正在播放音频。\n    PauseSound:function (audioID) {\n        cc.audioEngine.pause(audioID);\n    },\n\t//恢复所有暂停的音效\n\tResumeAllSound:function(){\n\t\tcc.audioEngine.resumeAll();\n\t},\n\t//恢复播放指定的音频。\n    ResumeSound:function (audioID) {\n        cc.audioEngine.resume(audioID);\n    },\n\t//停止所有正在播放的音效\n\tStopAllSound:function(){\n\t\tcc.audioEngine.stopAll();\n\t},\n\n\tStopSoundByAudioID:function(audioID){\n\t\tcc.audioEngine.stop(audioID);\n\t},\n\n\t//清除音效加载的资源\n\tClearSound:function(soundName){\n\n\t\tlet soundInfo = this.Sound[soundName];\n\t\tif(!soundInfo){\n\t\t\tthis.ErrLog(\"ClearSound(%s) not find\", soundName);\n\t\t\treturn\n\t\t}\n\t\tcc.audioEngine.uncache(cc.url.raw(soundInfo[\"SoundPath\"]));\n\t},\n\n\tClearAllSound:function(){\n\t\tcc.audioEngine.uncacheAll();\n\t},\n\n\n});\n\n\nvar g_SoundManager = null;\n\n/**\n * 绑定模块外部方法\n */\nexports.GetModel = function(){\n\tif(!g_SoundManager){\n\t\tg_SoundManager = new SoundManager();\n\t}\n\treturn g_SoundManager;\n}"]}